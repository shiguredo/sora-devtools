import{r as un,u as mn,a as gn,j as s,b as v,C as le,R as O,F as h,d as Q,e as G,f as R,B as ze,T as pn,g as _,h as q,O as bt,P as ae,i as Je,k as j,l as f,I as We,m as de,D as qe,n as Ke,N as F,o as ie,p as fn,q as hn,s as Cn,t as xn}from"./react-BYLUL4Q7.js";import{S as tt,V as yt,L as Rt,N as Tt,b as ue}from"./shiguredo-Cgi7D4Df.js";import{c as Sn,r as jn,a as vn}from"./redux-C6rz65rc.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function n(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(i){if(i.ep)return;i.ep=!0;const a=n(i);fetch(i.href,a)}})();var ee={},nt;function bn(){if(nt)return ee;nt=1;var e=un();return ee.createRoot=e.createRoot,ee.hydrateRoot=e.hydrateRoot,ee}var yn=bn();const Nt="%[a-f0-9]{2}",ot=new RegExp("("+Nt+")|([^%]+?)","gi"),st=new RegExp("("+Nt+")+","gi");function Ce(e,t){try{return[decodeURIComponent(e.join(""))]}catch{}if(e.length===1)return e;t=t||1;const n=e.slice(0,t),o=e.slice(t);return Array.prototype.concat.call([],Ce(n),Ce(o))}function Rn(e){try{return decodeURIComponent(e)}catch{let t=e.match(ot)||[];for(let n=1;n<t.length;n++)e=Ce(t,n).join(""),t=e.match(ot)||[];return e}}function Tn(e){const t={"%FE%FF":"��","%FF%FE":"��"};let n=st.exec(e);for(;n;){try{t[n[0]]=decodeURIComponent(n[0])}catch{const i=Rn(n[0]);i!==n[0]&&(t[n[0]]=i)}n=st.exec(e)}t["%C2"]="�";const o=Object.keys(t);for(const i of o)e=e.replace(new RegExp(i,"g"),t[i]);return e}function Nn(e){if(typeof e!="string")throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof e+"`");try{return decodeURIComponent(e)}catch{return Tn(e)}}function kn(e,t){const n={};if(Array.isArray(t))for(const o of t){const i=Object.getOwnPropertyDescriptor(e,o);i?.enumerable&&Object.defineProperty(n,o,i)}else for(const o of Reflect.ownKeys(e)){const i=Object.getOwnPropertyDescriptor(e,o);if(i.enumerable){const a=e[o];t(o,a,e)&&Object.defineProperty(n,o,i)}}return n}function kt(e,t){if(!(typeof e=="string"&&typeof t=="string"))throw new TypeError("Expected the arguments to be of type `string`");if(e===""||t==="")return[];const n=e.indexOf(t);return n===-1?[]:[e.slice(0,n),e.slice(n+t.length)]}const In=e=>e==null,Mn=e=>encodeURIComponent(e).replaceAll(/[!'()*]/g,t=>`%${t.charCodeAt(0).toString(16).toUpperCase()}`),xe=Symbol("encodeFragmentIdentifier");function wn(e){switch(e.arrayFormat){case"index":return t=>(n,o)=>{const i=n.length;return o===void 0||e.skipNull&&o===null||e.skipEmptyString&&o===""?n:o===null?[...n,[P(t,e),"[",i,"]"].join("")]:[...n,[P(t,e),"[",P(i,e),"]=",P(o,e)].join("")]};case"bracket":return t=>(n,o)=>o===void 0||e.skipNull&&o===null||e.skipEmptyString&&o===""?n:o===null?[...n,[P(t,e),"[]"].join("")]:[...n,[P(t,e),"[]=",P(o,e)].join("")];case"colon-list-separator":return t=>(n,o)=>o===void 0||e.skipNull&&o===null||e.skipEmptyString&&o===""?n:o===null?[...n,[P(t,e),":list="].join("")]:[...n,[P(t,e),":list=",P(o,e)].join("")];case"comma":case"separator":case"bracket-separator":{const t=e.arrayFormat==="bracket-separator"?"[]=":"=";return n=>(o,i)=>i===void 0||e.skipNull&&i===null||e.skipEmptyString&&i===""?o:(i=i===null?"":i,o.length===0?[[P(n,e),t,P(i,e)].join("")]:[[o,P(i,e)].join(e.arrayFormatSeparator)])}default:return t=>(n,o)=>o===void 0||e.skipNull&&o===null||e.skipEmptyString&&o===""?n:o===null?[...n,P(t,e)]:[...n,[P(t,e),"=",P(o,e)].join("")]}}function Pn(e){let t;switch(e.arrayFormat){case"index":return(n,o,i)=>{if(t=/\[(\d*)]$/.exec(n),n=n.replace(/\[\d*]$/,""),!t){i[n]=o;return}i[n]===void 0&&(i[n]={}),i[n][t[1]]=o};case"bracket":return(n,o,i)=>{if(t=/(\[])$/.exec(n),n=n.replace(/\[]$/,""),!t){i[n]=o;return}if(i[n]===void 0){i[n]=[o];return}i[n]=[...i[n],o]};case"colon-list-separator":return(n,o,i)=>{if(t=/(:list)$/.exec(n),n=n.replace(/:list$/,""),!t){i[n]=o;return}if(i[n]===void 0){i[n]=[o];return}i[n]=[...i[n],o]};case"comma":case"separator":return(n,o,i)=>{const a=typeof o=="string"&&o.includes(e.arrayFormatSeparator),r=typeof o=="string"&&!a&&B(o,e).includes(e.arrayFormatSeparator);o=r?B(o,e):o;const c=a||r?o.split(e.arrayFormatSeparator).map(u=>B(u,e)):o===null?o:B(o,e);i[n]=c};case"bracket-separator":return(n,o,i)=>{const a=/(\[])$/.test(n);if(n=n.replace(/\[]$/,""),!a){i[n]=o&&B(o,e);return}const r=o===null?[]:B(o,e).split(e.arrayFormatSeparator);if(i[n]===void 0){i[n]=r;return}i[n]=[...i[n],...r]};default:return(n,o,i)=>{if(i[n]===void 0){i[n]=o;return}i[n]=[...[i[n]].flat(),o]}}}function It(e){if(typeof e!="string"||e.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function P(e,t){return t.encode?t.strict?Mn(e):encodeURIComponent(e):e}function B(e,t){return t.decode?Nn(e):e}function Mt(e){return Array.isArray(e)?e.sort():typeof e=="object"?Mt(Object.keys(e)).sort((t,n)=>Number(t)-Number(n)).map(t=>e[t]):e}function wt(e){const t=e.indexOf("#");return t!==-1&&(e=e.slice(0,t)),e}function An(e){let t="";const n=e.indexOf("#");return n!==-1&&(t=e.slice(n)),t}function at(e,t,n){return n==="string"&&typeof e=="string"?e:typeof n=="function"&&typeof e=="string"?n(e):t.parseBooleans&&e!==null&&(e.toLowerCase()==="true"||e.toLowerCase()==="false")?e.toLowerCase()==="true":n==="number"&&!Number.isNaN(Number(e))&&typeof e=="string"&&e.trim()!==""||t.parseNumbers&&!Number.isNaN(Number(e))&&typeof e=="string"&&e.trim()!==""?Number(e):e}function Ye(e){e=wt(e);const t=e.indexOf("?");return t===-1?"":e.slice(t+1)}function Ze(e,t){t={decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1,types:Object.create(null),...t},It(t.arrayFormatSeparator);const n=Pn(t),o=Object.create(null);if(typeof e!="string"||(e=e.trim().replace(/^[?#&]/,""),!e))return o;for(const i of e.split("&")){if(i==="")continue;const a=t.decode?i.replaceAll("+"," "):i;let[r,c]=kt(a,"=");r===void 0&&(r=a),c=c===void 0?null:["comma","separator","bracket-separator"].includes(t.arrayFormat)?c:B(c,t),n(B(r,t),c,o)}for(const[i,a]of Object.entries(o))if(typeof a=="object"&&a!==null&&t.types[i]!=="string")for(const[r,c]of Object.entries(a)){const u=t.types[i]?t.types[i].replace("[]",""):void 0;a[r]=at(c,t,u)}else typeof a=="object"&&a!==null&&t.types[i]==="string"?o[i]=Object.values(a).join(t.arrayFormatSeparator):o[i]=at(a,t,t.types[i]);return t.sort===!1?o:(t.sort===!0?Object.keys(o).sort():Object.keys(o).sort(t.sort)).reduce((i,a)=>{const r=o[a];return i[a]=r&&typeof r=="object"&&!Array.isArray(r)?Mt(r):r,i},Object.create(null))}function Pt(e,t){if(!e)return"";t={encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:",",...t},It(t.arrayFormatSeparator);const n=r=>t.skipNull&&In(e[r])||t.skipEmptyString&&e[r]==="",o=wn(t),i={};for(const[r,c]of Object.entries(e))n(r)||(i[r]=c);const a=Object.keys(i);return t.sort!==!1&&a.sort(t.sort),a.map(r=>{const c=e[r];return c===void 0?"":c===null?P(r,t):Array.isArray(c)?c.length===0&&t.arrayFormat==="bracket-separator"?P(r,t)+"[]":c.reduce(o(r),[]).join("&"):P(r,t)+"="+P(c,t)}).filter(r=>r.length>0).join("&")}function At(e,t){t={decode:!0,...t};let[n,o]=kt(e,"#");return n===void 0&&(n=e),{url:n?.split("?")?.[0]??"",query:Ze(Ye(e),t),...t&&t.parseFragmentIdentifier&&o?{fragmentIdentifier:B(o,t)}:{}}}function Dt(e,t){t={encode:!0,strict:!0,[xe]:!0,...t};const n=wt(e.url).split("?")[0]||"",o=Ye(e.url),i={...Ze(o,{sort:!1}),...e.query};let a=Pt(i,t);a&&=`?${a}`;let r=An(e.url);if(typeof e.fragmentIdentifier=="string"){const c=new URL(n);c.hash=e.fragmentIdentifier,r=t[xe]?c.hash:`#${e.fragmentIdentifier}`}return`${n}${a}${r}`}function Ft(e,t,n){n={parseFragmentIdentifier:!0,[xe]:!1,...n};const{url:o,query:i,fragmentIdentifier:a}=At(e,n);return Dt({url:o,query:kn(i,t),fragmentIdentifier:a},n)}function Dn(e,t,n){const o=Array.isArray(t)?i=>!t.includes(i):(i,a)=>!t(i,a);return Ft(e,o,n)}const Fn=Object.freeze(Object.defineProperty({__proto__:null,exclude:Dn,extract:Ye,parse:Ze,parseUrl:At,pick:Ft,stringify:Pt,stringifyUrl:Dt},Symbol.toStringTag,{value:"Module"})),Vn={description:`接続するチャネルの ID を指定します。
1-255 文字までの文字列を指定できます。`},On={description:"クライアントの役割を指定します。"},En={description:"マルチストリームを使用するかどうかを指定します。Sora は未指定の場合、マルチストリームを使用します。"},Hn={description:"サイマルキャストを使用するかどうかを指定します。"},Bn={description:"サイマルキャストで配信されている映像を受信する際のエンコードの初期値を指定します。"},Un={description:"スポットライトを使用するかどうかを指定します。"},Ln={description:"スポットライトでフォーカスする配信数の最大値を指定します。"},_n={description:"スポットライトでフォーカスした場合の映像を受信する際のエンコードの初期値を指定します。"},$n={description:"スポットライトでフォーカスが外れた場合の映像を受信する際のエンコードの初期値を指定します。"},Gn={description:"音声配信をするかどうかを指定します。"},zn={description:"音声のコーデックタイプを指定します。"},Jn={description:`音声のビットレートを指定します。
6 ~ 510 kbps の範囲で指定できます。`},Wn={description:"映像配信をするかどうかを指定します。"},qn={description:"映像のコーデックタイプを指定します。"},Kn={description:`映像のビットレートを指定します。
15,000 kbps までがサポート対象、それ以上のビットレートはサポート対象外です。`},Yn={description:"映像のコーデックタイプに VP9 を指定した場合の設定を指定します。"},Zn={description:"映像のコーデックタイプに H264 を指定した場合の設定を指定します。"},Qn={description:"映像のコーデックタイプに H265 を指定した場合の設定を指定します。"},Xn={description:"映像のコーデックタイプに AV1 を指定した場合の設定を指定します。"},eo={description:"一度接続に成功したあとに意図しない切断があった場合に再接続するかどうかを指定します。"},to={description:"接続時に任意のクライアント ID を指定できます。"},no={description:"認証するための判断材料としてのメタデータを指定します。"},oo={description:"複数接続時に同一の bundle_id を指定すると、同一 bundle_id の接続から音声や映像やメッセージングを受信しなくなります。"},so={description:"クライアントが参加や離脱したときに送られるシグナリング通知に含まれるメタデータを指定します。"},ao={description:"シグナリングをするURLを改行区切りで複数指定します。"},io={description:"転送フィルターを複数指定します。"},ro={description:"転送フィルターを指定します。"},co={description:"音声解析用の言語コードを指定します。"},lo={description:"メッセージング用の DataChannel を指定します。"},uo={description:"シグナリングを DataChannel 経由に切り替えるかどうかを指定します。"},mo={description:"シグナリングを DataChannel 経由に切り替えた際に、 WebSocket が閉じても、接続が切断しないようにするかどうかを指定します。"},go={description:`メディアタイプを指定します。
getUserMedia: デバイスのカメラ/マイクをメディアとして使用します。
getDisplayMedia: ディスプレイまたはその一部(ウィンドウ等)をメディアとして使用します。
fakeMedia: ダミーの映像と音声をメディアとして使用します
mediacaptureRegion: 現在開いているタブの一部をメディアとして使用します。`},po={description:"mediaType に fakeMedia を選択した際の音量を指定します。"},fo={description:"mediaType に mp4Media を選択した際に使用する MP4 ファイル (H.264 + Opus のみ対応) を指定します。"},ho={description:"MediaStreamTrack audio の contentHint を指定します。"},Co={description:"MediaTrackConstraints の autoGainControl を指定します。"},xo={description:"MediaTrackConstraints の noiseSuppression を指定します。"},So={description:"MediaTrackConstraints の echoCancellation を指定します。"},jo={description:"MediaTrackConstraints の echoCancellationType を指定します。"},vo={description:"shiguredo Media Processors のノイズ抑制を使用するかどうか指定します。"},bo={description:"MediaStreamTrack video の contentHint を指定します。"},yo={description:"解像度を指定します。任意の解像度を指定する場合は、幅と高さを x 区切りで指定します。 (例: 640x480)"},Ro={description:"映像の統計情報を映像に重ねて表示します。"},To={description:"MediaTrackConstraints の frameRate を指定します。"},No={description:"MediaTrackConstraints の aspectRatio を指定します。"},ko={description:"MediaTrackConstraints の resizeMode を指定します。"},Io={description:"shiguredo Media Processors の背景ぼかしを使用するかどうか指定します。"},Mo={description:"shiguredo Media Processors のライト調整を使用するかどうか指定します。"},wo={description:"音声入力を指定します。"},Po={description:"映像入力を指定します。"},Ao={description:"音声出力を指定します。"},Do={description:"画面に表示する際の解像度を指定します。任意の解像度を指定する場合は、幅と高さを x 区切りで指定します。 (例: 640x480)"},Fo={description:"Audio MediaStreamTrack を生成するかどうかを切り替えます。"},Vo={description:"Video MediaStreamTrack を生成するかどうかを切り替えます。"},Oo={description:"Audio MediaStreamTrack の enabled 属性を切り替えます。"},Eo={description:"video MediaStreamTrack の enabled 属性を切り替えます。"},Ho={description:"モバイルカメラのフロント/バックを切り替えます。"},Bo={description:"サイマルキャストで受信中の全てのストリームの rid を操作します。"},Uo={channelId:Vn,role:On,multistream:En,simulcast:Hn,simulcastRid:Bn,spotlight:Un,spotlightNumber:Ln,spotlightFocusRid:_n,spotlightUnfocusRid:$n,audio:Gn,audioCodecType:zn,audioBitRate:Jn,video:Wn,videoCodecType:qn,videoBitRate:Kn,videoVP9Params:Yn,videoH264Params:Zn,videoH265Params:Qn,videoAV1Params:Xn,reconnect:eo,clientId:to,metadata:no,bundleId:oo,signalingNotifyMetadata:so,signalingUrlCandidates:ao,forwardingFilters:io,forwardingFilter:ro,audioStreamingLanguageCode:co,dataChannels:lo,dataChannelSignaling:uo,ignoreDisconnectWebSocket:mo,mediaType:go,fakeVolume:po,mp4File:fo,audioContentHint:ho,autoGainControl:Co,noiseSuppression:xo,echoCancellation:So,echoCancellationType:jo,mediaProcessorsNoiseSuppression:vo,videoContentHint:bo,resolution:yo,mediaStats:Ro,frameRate:To,aspectRatio:No,resizeMode:ko,blurRadius:Io,lightAdjustment:Mo,audioInput:wo,videoInput:Po,audioOutput:Ao,displayResolution:Do,micDevice:Fo,cameraDevice:Vo,audioTrack:Oo,videoTrack:Eo,facingMode:Ho,changeAllRecvStream:Bo},Se=["","true","false"],je=["","true","false"],ve=["","true","false"],be=["","OPUS"],ye=["","8","16","24","32","64","96","128","256","384"],Re=["","VP8","VP9","AV1","H264","H265"],me=["","10","30","50","100","300","500","800","1000","1500","2000","2500","3000","5000","10000","15000","20000","30000","50000"],Te=["","true","false"],Ne=["","true","false"],ke=["","true","false"],Ie=["","browser","system"],Vt=["getUserMedia","getDisplayMedia","fakeMedia","mediacaptureRegion"],Me=["","1","2","3","4","5","6","7","8"],V=["","none","r0","r1","r2"],we=["","r0","r1","r2"],Pe=["","true","false"],Ae=["","true","false"],Lo=["log","notify","push","stats","timeline","signaling","messaging","codec"],De=["","speech","speech-recognition","music"],Fe=["","motion","detail","text"],Ve=["","4:3","16:9","21:9"],Oe=["","none","crop-and-scale"],Ee=["","weak","medium","strong"],He=["","weak","medium","strong"],Be=["sendrecv","sendonly","recvonly"],Ue=["","front","back"],_o=`
self.onmessage = (event) => {
  const data = event.data;
  if (data.type === "start") {
    const interval = data.interval;
    self.counter = 0;
    const intervalId = setInterval(() => {
      const message = { type: "update", counter: self.counter };
      self.postMessage(message);
      self.counter++;
    }, interval);
    self.intervalId = intervalId;
  } else if (data.type === "stop") {
    if (self.intervalId) {
      clearInterval(self.intervalId);
    }
    const message = { type: "stop" };
    self.postMessage(message);
  }
};
`,Ot=Uo;function Et(e){const t=new Date(e),n=t.getFullYear(),o=t.getMonth()+1,i=t.getDate(),a=t.getHours().toString().padStart(2,"0"),r=t.getMinutes().toString().padStart(2,"0"),c=t.getSeconds().toString().padStart(2,"0"),u=t.getMilliseconds().toString().padStart(3,"0");return`${n}-${o}-${i} ${a}:${r}:${c}.${u}`}function ge(e){return navigator.clipboard?navigator.clipboard.writeText(e):Promise.resolve()}function I(e,t){return typeof e=="string"?t.indexOf(e)>=0:!1}function $o(){const e=r=>{if(typeof r=="string")return r},t=r=>{if(typeof r=="string")return D(r)},n=(r,c)=>{if(I(r,c))return r},o=Fn.parse(location.search);let i;if(typeof o.signalingUrlCandidates=="string")try{i=JSON.parse(o.signalingUrlCandidates)}catch{}const a={apiUrl:e(o.apiUrl),audio:t(o.audio),audioBitRate:n(o.audioBitRate,ye),audioCodecType:n(o.audioCodecType,be),audioStreamingLanguageCode:e(o.audioStreamingLanguageCode),autoGainControl:n(o.autoGainControl,Te),bundleId:e(o.bundleId),channelId:e(o.channelId),clientId:e(o.clientId),googCpuOveruseDetection:t(o.googCpuOveruseDetection),debug:t(o.debug),debugType:n(o.debugType,Lo),displayResolution:e(o.displayResolution),echoCancellation:n(o.echoCancellation,ke),echoCancellationType:n(o.echoCancellationType,Ie),noiseSuppression:n(o.noiseSuppression,Ne),facingMode:n(o.facingMode,Ue),fakeVolume:e(o.fakeVolume),frameRate:e(o.frameRate),mediaStats:t(o.mediaStats),mediaType:n(o.mediaType,Vt),metadata:e(o.metadata),showStats:t(o.showStats),signalingNotifyMetadata:e(o.signalingNotifyMetadata),signalingUrlCandidates:Array.isArray(i)?i:void 0,forwardingFilter:e(o.forwardingFilter),simulcast:n(o.simulcast,je),simulcastRid:n(o.simulcastRid,we),spotlight:n(o.spotlight,ve),spotlightNumber:n(o.spotlightNumber,Me),spotlightFocusRid:n(o.spotlightFocusRid,V),spotlightUnfocusRid:n(o.spotlightUnfocusRid,V),resolution:e(o.resolution),video:t(o.video),videoBitRate:n(o.videoBitRate,me),videoCodecType:n(o.videoCodecType,Re),videoVP9Params:e(o.videoVP9Params),videoH264Params:e(o.videoH264Params),videoH265Params:e(o.videoH265Params),videoAV1Params:e(o.videoAV1Params),audioInput:e(o.audioInput),videoInput:e(o.videoInput),audioOutput:e(o.audioOutput),mute:t(o.mute),dataChannelSignaling:n(o.dataChannelSignaling,Pe),ignoreDisconnectWebSocket:n(o.ignoreDisconnectWebSocket,Ae),micDevice:t(o.micDevice),cameraDevice:t(o.cameraDevice),audioTrack:t(o.audioTrack),videoTrack:t(o.videoTrack),dataChannels:e(o.dataChannels),reconnect:t(o.reconnect),audioContentHint:n(o.audioContentHint,De),videoContentHint:n(o.videoContentHint,Fe),aspectRatio:n(o.aspectRatio,Ve),resizeMode:n(o.resizeMode,Oe),blurRadius:n(o.blurRadius,Ee),lightAdjustment:n(o.lightAdjustment,He),mediaProcessorsNoiseSuppression:t(o.mediaProcessorsNoiseSuppression),multistream:n(o.multistream,Se),role:n(o.role,Be)};return Object.keys(a).map(r=>{a[r]===void 0&&delete a[r]}),a}function Ht(e,t){if(e)return t.filter(i=>i!=="");const n=window.location.protocol==="https:"?"wss://":"ws://",o=window.location.port?`:${window.location.port}`:"";return`${n+window.location.hostname+o}/signaling`}const it=/^(\d+)x(\d+)$/;function pe(e){if(it.test(e)){const t=e.match(it);if(t)return{width:Number.parseInt(t[1],10),height:Number.parseInt(t[2],10)}}return{width:0,height:0}}function Qe(e){switch(e){case"4:3":return 4/3;case"16:9":return 16/9;case"21:9":return 20/9;default:return Number.NaN}}function Go(e){switch(e){case"weak":return 5;case"medium":return 10;case"strong":return 15;default:return 0}}function zo(e){switch(e){case"weak":return{adjustmentLevel:30,sharpnessLevel:0};case"medium":{const t="https://cdn.jsdelivr.net/npm/@shiguredo/light-adjustment@latest/dist";return{adjustmentLevel:50,sharpnessLevel:10,focusMask:new tt(t)}}case"strong":{const t="https://cdn.jsdelivr.net/npm/@shiguredo/light-adjustment@latest/dist";return{adjustmentLevel:70,sharpnessLevel:20,minIntensity:10,focusMask:new tt(t)}}default:return{}}}function Jo(e){const{audio:t,autoGainControl:n,noiseSuppression:o,echoCancellation:i,echoCancellationType:a,audioInput:r}=e;if(!t)return!1;if(!n&&!o&&!i&&!a&&!r)return t;const c={};r&&(c.deviceId={exact:r});const u=D(n);u!==void 0&&(c.autoGainControl=u);const m=D(o);m!==void 0&&(c.noiseSuppression=m);const g=D(i);return g!==void 0&&(c.echoCancellation=g),a&&(c.echoCancellationType=a),c}function Wo(e){const{video:t,frameRate:n,resolution:o,videoInput:i,aspectRatio:a,resizeMode:r,facingMode:c}=e;if(!t)return!1;if(!n&&!o&&!i&&!a&&!r&&!c)return t;const u={};if(n){const m=Number.parseInt(n,10);Number.isNaN(m)||(u.frameRate={min:m,max:m})}if(o){const{width:m,height:g}=pe(o);m>0&&g>0&&(u.width={exact:m},u.height={exact:g})}return i&&(u.deviceId={exact:i}),a&&(u.aspectRatio=Qe(a)),r&&(u.resizeMode=r),c==="front"?u.facingMode="user":c==="back"&&(u.facingMode={exact:"environment"}),u}function qo(e){const{audio:t,video:n,frameRate:o,resolution:i,volume:a,aspectRatio:r,resizeMode:c}=e,u=Number.parseInt(o,10),m=Number.isNaN(u)?30:u,g=pe(i),S=g.width||240,C=g.height||160,y=Math.floor(S/5),x={audio:t,video:n,frameRate:m,width:S,height:C,fontSize:y,volume:Number.parseFloat(a)};return n&&(r||c)&&(x.videoTrackConstraints={},r&&(x.videoTrackConstraints.aspectRatio=Qe(r)),c&&(x.videoTrackConstraints.resizeMode=c)),x}function rt(e){const{audio:t,autoGainControl:n,noiseSuppression:o,echoCancellation:i,echoCancellationType:a}=e;if(!t)return!1;if(!n&&!o&&!i&&!a)return!0;const r={},c=D(n);c!==void 0&&(r.autoGainControl=c);const u=D(o);u!==void 0&&(r.noiseSuppression=u);const m=D(i);return m!==void 0&&(r.echoCancellation=m),a&&(r.echoCancellationType=a),r}function ct(e){const{aspectRatio:t,frameRate:n,resizeMode:o,resolution:i}=e;if(!n&&!i&&!t&&!o)return!0;const a={};if(n){const r=Number.parseInt(n,10);Number.isNaN(r)||(a.frameRate=r)}if(i){const{width:r,height:c}=pe(i);r>0&&c>0&&(a.width=r,a.height=c)}return t&&(a.aspectRatio=Qe(t)),o&&(a.resizeMode=o),a}function Ko(e){const t=new MediaStream;let n=null;if(e.video){n=document.createElement("canvas"),n.getContext("2d"),n.width=e.width,n.height=e.height;const a=n.captureStream(e.frameRate).getTracks()[0];e.videoTrackConstraints&&a.applyConstraints(e.videoTrackConstraints),t.addTrack(a)}let o=null;if(e.audio){const i=window.AudioContext||window.webkitAudioContext,a=new i,r=a.createOscillator(),c="sine";r.type=c,o=a.createGain(),r.connect(o),r.start(0);const u=a.createMediaStreamDestination();o.connect(u);const m=u.stream.getTracks();t.addTrack(m[0]),o.gain.setValueAtTime(e.volume,0)}return{canvas:n,mediaStream:t,gainNode:o}}function Yo(e,t,n,o){if(e===null)return;const i=e.getContext("2d");if(!i)return;i.globalCompositeOperation="source-over",i.clearRect(0,0,e.width,e.height),i.fillStyle=`#${("0".repeat(6)+t.toString(16)).slice(-6)}`,i.fillRect(0,0,e.width,e.height),i.fillStyle=`#${("0".repeat(6)+(16777215-t).toString(16)).slice(-6)}`,i.font=`${n}px Arial`;const a=e.width/2-n/2,r=n/4*(o.length-1),c=e.height/2+n/2.5;i.fillText(o,a-r,c)}function D(e){if(e==="true")return!0;if(e==="false")return!1}function $(e,t){if(e){try{return JSON.parse(t)}catch{}return t}}async function Bt(){if(navigator.mediaDevices===void 0)return[];try{return await navigator.mediaDevices.enumerateDevices()}catch{}return[]}function T(e){return e==="preparing"||e==="connected"||e==="connecting"}function Ut(e){return{id:e.id,label:e.label,kind:e.kind,enabled:e.enabled,muted:e.muted,readyState:e.readyState,contentHint:e.contentHint,getConstraints:e.getConstraints(),getCapabilities:e.getCapabilities?e.getCapabilities():null,getSettings:e.getSettings()}}function Lt(e){const t={audio:e.audio,video:e.video};if(!(e.role==="recvonly"&&(e.multistream==="true"||e.multistream===""))){e.audioCodecType&&(t.audioCodecType=e.audioCodecType);const r=Number.parseInt(e.audioBitRate,10);r&&(t.audioBitRate=r),e.videoCodecType&&(t.videoCodecType=e.videoCodecType);const c=Number.parseInt(e.videoBitRate,10);c&&(t.videoBitRate=c),e.enabledVideoVP9Params&&(t.videoVP9Params=$(!0,e.videoVP9Params)),e.enabledVideoH264Params&&(t.videoH264Params=$(!0,e.videoH264Params)),e.enabledVideoH265Params&&(t.videoH265Params=$(!0,e.videoH265Params)),e.enabledVideoAV1Params&&(t.videoAV1Params=$(!0,e.videoAV1Params)),e.enabledAudioStreamingLanguageCode&&(t.audioStreamingLanguageCode=e.audioStreamingLanguageCode)}const o=D(e.multistream);o!==void 0&&(t.multistream=o);const i=D(e.spotlight);i!==void 0&&(t.spotlight=i,i===!0&&(e.spotlightNumber&&(t.spotlightNumber=Number.parseInt(e.spotlightNumber)),e.spotlightFocusRid&&(t.spotlightFocusRid=e.spotlightFocusRid),e.spotlightUnfocusRid&&(t.spotlightUnfocusRid=e.spotlightUnfocusRid)));const a=D(e.simulcast);if(a!==void 0&&(t.simulcast=a,a===!0&&e.simulcastRid&&(t.simulcastRid=e.simulcastRid)),e.enabledSignalingNotifyMetadata&&(t.signalingNotifyMetadata=$(!0,e.signalingNotifyMetadata)),e.enabledForwardingFilter&&(t.forwardingFilter=$(!0,e.forwardingFilter)),e.enabledBundleId&&(t.bundleId=e.bundleId),e.enabledClientId&&(t.clientId=e.clientId),e.enabledDataChannel){const r=D(e.dataChannelSignaling);r!==void 0&&(t.dataChannelSignaling=r);const c=D(e.ignoreDisconnectWebSocket);c!==void 0&&(t.ignoreDisconnectWebSocket=c)}if(e.dataChannels!==""){let r=[];try{r=JSON.parse(e.dataChannels)}catch{console.warn("Illegal format DataChannels")}Array.isArray(r)&&(t.dataChannels=r)}return t}const Zo="sora-devtools",Qo="2024.2.3",Xo="WebRTC SFU Sora DevTools",es="module",ts={type:"git",url:"git+https://github.com/shiguredo/sora-devtools.git"},ns="Shiguredo Inc.",os="Apache-2.0",ss={url:"https://discord.gg/shiguredo"},as="https://github.com/shiguredo/sora-devtools#readme",is={dev:"vite --port 3333",build:"vite build",dist:"pnpm run cleanup && pnpm install && vite build",fmt:"biome format --write ./src",lint:"biome lint ./src",fix:"biome check --apply ./src",test:"vitest run","e2e-test":"playwright test --project=chromium",cleanup:"git clean -ffdx --exclude .env"},rs={"@reduxjs/toolkit":"2.3.0","@shiguredo/light-adjustment":"2024.1.0","@shiguredo/mp4-media-stream":"2024.2.0","@shiguredo/noise-suppression":"2022.4.2","@shiguredo/virtual-background":"2023.2.0",bootstrap:"5.3.3","query-string":"9.1.1",react:"18.3.1","react-bootstrap":"2.10.6","react-dom":"18.3.1","react-draggable":"4.4.6","react-redux":"9.1.2",redux:"5.0.1","redux-logger":"3.0.6","redux-thunk":"3.1.0","sora-js-sdk":"2024.2.2"},cs={"@biomejs/biome":"1.9.4","@playwright/test":"1.49.0","@types/node":"22.10.1","@types/react":"18.3.12","@types/react-redux":"7.1.34","@types/redux-logger":"3.0.13","@vitejs/plugin-react":"4.3.4",dotenv:"16.4.5",jsdom:"25.0.1",typescript:"5.7.2",vite:"6.0.1",vitest:"2.1.6"},ls="pnpm@9.14.3",ds={node:">=20.18"},us={name:Zo,version:Qo,description:Xo,type:es,repository:ts,author:ns,license:os,bugs:ss,homepage:as,scripts:is,dependencies:rs,devDependencies:cs,packageManager:ls,engines:ds},lt={alertMessages:[],audio:!0,audioBitRate:"",audioCodecType:"",audioContentHint:"",audioInput:"",audioInputDevices:[],audioOutput:"",audioOutputDevices:[],autoGainControl:"",blurRadius:"",bundleId:"",enabledBundleId:!1,clientId:"",channelId:"sora",googCpuOveruseDetection:null,timelineMessages:[],debug:!1,debugFilterText:"",debugType:"timeline",dataChannelSignaling:"",dataChannels:"",dataChannelMessages:[],displayResolution:"",echoCancellation:"",echoCancellationType:"",enabledClientId:!1,enabledDataChannel:!1,enabledDataChannels:!1,enabledForwardingFilter:!1,enabledMetadata:!1,enabledSignalingNotifyMetadata:!1,enabledSignalingUrlCandidates:!1,enabledVideoVP9Params:!1,enabledVideoH264Params:!1,enabledVideoH265Params:!1,enabledVideoAV1Params:!1,audioStreamingLanguageCode:"",enabledAudioStreamingLanguageCode:!1,fakeVolume:"0",fakeContents:{worker:null,colorCode:0,gainNode:null},frameRate:"",soraContents:{connectionStatus:"initializing",reconnecting:!1,reconnectingTrials:0,sora:null,connectionId:null,clientId:null,sessionId:null,localMediaStream:null,remoteClients:[],prevStatsReport:[],statsReport:[],datachannels:[],turnUrl:null},ignoreDisconnectWebSocket:"",logMessages:[],mediaProcessorsNoiseSuppression:!1,mediaStats:!1,mediaType:"getUserMedia",metadata:"",multistream:"",mute:!1,noiseSuppression:"",notifyMessages:[],pushMessages:[],resolution:"",showStats:!1,simulcast:"",spotlight:"",signalingMessages:[],signalingNotifyMetadata:"",signalingUrlCandidates:[],forwardingFilter:"",simulcastRid:"",spotlightNumber:"",spotlightFocusRid:"",spotlightUnfocusRid:"",focusedSpotlightConnectionIds:{},video:!0,videoBitRate:"",videoCodecType:"",videoContentHint:"",videoInput:"",videoInputDevices:[],videoVP9Params:"",videoH264Params:"",videoH265Params:"",videoAV1Params:"",version:us.version,cameraDevice:!0,videoTrack:!0,micDevice:!0,audioTrack:!0,role:"sendrecv",reconnect:!1,apiUrl:null,aspectRatio:"",resizeMode:"",lightAdjustment:"",lightAdjustmentProcessor:null,noiseSuppressionProcessor:null,virtualBackgroundProcessor:null,facingMode:""},d=Sn({name:"soraDevtools",initialState:lt,reducers:{resetState:e=>{Object.assign(e,lt)},setAudio:(e,t)=>{e.audio=t.payload},setAudioInput:(e,t)=>{e.audioInput=t.payload},setAudioOutput:(e,t)=>{e.audioOutput=t.payload},setAudioBitRate:(e,t)=>{e.audioBitRate=t.payload},setAudioCodecType:(e,t)=>{e.audioCodecType=t.payload},setAudioContentHint:(e,t)=>{if(e.audioContentHint=t.payload,e.soraContents.localMediaStream)for(const n of e.soraContents.localMediaStream.getAudioTracks())n.contentHint=e.audioContentHint},setAutoGainControl:(e,t)=>{e.autoGainControl=t.payload},setClientId:(e,t)=>{e.clientId=t.payload},setChannelId:(e,t)=>{e.channelId=t.payload},setTimelineMessage:(e,t)=>{e.timelineMessages.push(t.payload)},setDataChannelSignaling:(e,t)=>{e.dataChannelSignaling=t.payload},setDataChannels:(e,t)=>{e.dataChannels=t.payload},setDataChannelMessage:(e,t)=>{e.dataChannelMessages.push(t.payload)},setGoogCpuOveruseDetection:(e,t)=>{e.googCpuOveruseDetection=t.payload},setDisplayResolution:(e,t)=>{e.displayResolution=t.payload},setEchoCancellation:(e,t)=>{e.echoCancellation=t.payload},setEchoCancellationType:(e,t)=>{e.echoCancellationType=t.payload},setEnabledClientId:(e,t)=>{e.enabledClientId=t.payload},setEnabledDataChannels:(e,t)=>{e.enabledDataChannels=t.payload},setEnabledDataChannel:(e,t)=>{e.enabledDataChannel=t.payload},setEnabledMetadata:(e,t)=>{e.enabledMetadata=t.payload},setIgnoreDisconnectWebSocket:(e,t)=>{e.ignoreDisconnectWebSocket=t.payload},setSignalingMessage:(e,t)=>{e.signalingMessages.push(t.payload)},setEnabledForwardingFilter:(e,t)=>{e.enabledForwardingFilter=t.payload},setEnabledSignalingNotifyMetadata:(e,t)=>{e.enabledSignalingNotifyMetadata=t.payload},setEnabledSignalingUrlCandidates:(e,t)=>{e.enabledSignalingUrlCandidates=t.payload},setEnabledVideoVP9Params:(e,t)=>{e.enabledVideoVP9Params=t.payload},setEnabledVideoH264Params:(e,t)=>{e.enabledVideoH264Params=t.payload},setEnabledVideoH265Params:(e,t)=>{e.enabledVideoH265Params=t.payload},setEnabledVideoAV1Params:(e,t)=>{e.enabledVideoAV1Params=t.payload},setFakeVolume:(e,t)=>{const n=Number.parseFloat(t.payload);Number.isNaN(n)?e.fakeVolume="0":n>1?e.fakeVolume="1":e.fakeVolume=String(n),e.fakeContents.gainNode&&e.fakeContents.gainNode.gain.setValueAtTime(Number.parseFloat(e.fakeVolume),0)},setFakeContentsGainNode:(e,t)=>{e.fakeContents.gainNode=t.payload},setInitialFakeContents:e=>{if(e.fakeContents.colorCode=Math.floor(Math.random()*16777215),URL.createObjectURL){const t=URL.createObjectURL(new Blob([_o],{type:"application/javascript"}));e.fakeContents.worker=new Worker(t)}},setFrameRate:(e,t)=>{e.frameRate=t.payload},setMute:(e,t)=>{e.mute=t.payload},setMediaStats:(e,t)=>{e.mediaStats=t.payload},setNoiseSuppression:(e,t)=>{e.noiseSuppression=t.payload},setMediaType:(e,t)=>{t.payload==="mediacaptureRegion"&&(typeof window>"u"||window.CropTarget===void 0)?e.mediaType="getUserMedia":e.mediaType=t.payload},setMetadata:(e,t)=>{e.metadata=t.payload},setResolution:(e,t)=>{e.resolution=t.payload},setSignalingNotifyMetadata:(e,t)=>{e.signalingNotifyMetadata=t.payload},setSignalingUrlCandidates:(e,t)=>{e.signalingUrlCandidates=t.payload},setForwardingFilter:(e,t)=>{e.forwardingFilter=t.payload},setSimulcastRid:(e,t)=>{e.simulcastRid=t.payload},setSpotlightNumber:(e,t)=>{e.spotlightNumber=t.payload},setSpotlightFocusRid:(e,t)=>{e.spotlightFocusRid=t.payload},setSpotlightUnfocusRid:(e,t)=>{e.spotlightUnfocusRid=t.payload},setVideo:(e,t)=>{e.video=t.payload},setVideoInput:(e,t)=>{e.videoInput=t.payload},setVideoBitRate:(e,t)=>{e.videoBitRate=t.payload},setVideoCodecType:(e,t)=>{e.videoCodecType=t.payload},setVideoContentHint:(e,t)=>{if(e.videoContentHint=t.payload,e.soraContents.localMediaStream)for(const n of e.soraContents.localMediaStream.getVideoTracks())n.contentHint=e.videoContentHint},setVideoVP9Params:(e,t)=>{e.videoVP9Params=t.payload},setVideoH264Params:(e,t)=>{e.videoH264Params=t.payload},setVideoH265Params:(e,t)=>{e.videoH265Params=t.payload},setVideoAV1Params:(e,t)=>{e.videoAV1Params=t.payload},setSora:(e,t)=>{e.soraContents.sora=t.payload,e.soraContents.sora||(e.soraContents.datachannels=[])},setSoraSessionId:(e,t)=>{e.soraContents.sessionId=t.payload},setSoraConnectionId:(e,t)=>{e.soraContents.connectionId=t.payload},setSoraClientId:(e,t)=>{e.soraContents.clientId=t.payload},setSoraTurnUrl:(e,t)=>{e.soraContents.turnUrl=t.payload},setSoraConnectionStatus:(e,t)=>{e.soraContents.connectionStatus=t.payload},setSoraReconnecting:(e,t)=>{e.soraContents.reconnecting=t.payload,e.soraContents.reconnecting===!1&&(e.soraContents.reconnectingTrials=0)},setSoraReconnectingTrials:(e,t)=>{e.soraContents.reconnectingTrials=t.payload},setSoraDataChannels:(e,t)=>{e.soraContents.datachannels.push(t.payload)},setLocalMediaStream:(e,t)=>{e.soraContents.localMediaStream&&e.soraContents.localMediaStream.getTracks().filter(n=>{n.stop()}),e.soraContents.localMediaStream=t.payload},setRemoteClient:(e,t)=>{e.soraContents.remoteClients.push(t.payload)},setSoraRemoteClientId:(e,t)=>{for(const n of e.soraContents.remoteClients)n.connectionId===t.payload.connectionId&&(n.clientId=t.payload.clientId)},setStatsReport:(e,t)=>{e.soraContents.prevStatsReport=e.soraContents.statsReport,e.soraContents.statsReport=t.payload},removeRemoteClient:(e,t)=>{const n=e.soraContents.remoteClients.filter(o=>o.connectionId!==t.payload);e.soraContents.remoteClients=n},removeAllRemoteClients:e=>{e.soraContents.remoteClients=[]},setAudioInputDevices:(e,t)=>{e.audioInputDevices=t.payload},setVideoInputDevices:(e,t)=>{e.videoInputDevices=t.payload},setAudioOutputDevices:(e,t)=>{e.audioOutputDevices=t.payload},setSoraInfoAlertMessage:(e,t)=>{const n={title:"Sora info",type:"info",message:t.payload,timestamp:new Date().getTime()};te(e.alertMessages,e.logMessages,n)},setSoraErrorAlertMessage:(e,t)=>{const n={title:"Sora error",type:"error",message:t.payload,timestamp:new Date().getTime()};te(e.alertMessages,e.logMessages,n)},setAPIInfoAlertMessage:(e,t)=>{const n={title:"API info",type:"info",message:t.payload,timestamp:new Date().getTime()};te(e.alertMessages,e.logMessages,n)},setAPIErrorAlertMessage:(e,t)=>{const n={title:"API error",type:"error",message:t.payload,timestamp:new Date().getTime()};te(e.alertMessages,e.logMessages,n)},deleteAlertMessage:(e,t)=>{const n=e.alertMessages.filter(o=>o.timestamp!==t.payload);e.alertMessages=n},setDebug:(e,t)=>{e.debug=t.payload},setDebugFilterText:(e,t)=>{e.debugFilterText=t.payload},setDebugType:(e,t)=>{e.debugFilterText="",e.debugType=t.payload},setLogMessages:(e,t)=>{e.logMessages.push({timestamp:new Date().getTime(),message:{title:t.payload.title,description:t.payload.description}})},setNotifyMessages:(e,t)=>{e.notifyMessages.push(t.payload)},setPushMessages:(e,t)=>{e.pushMessages.push(t.payload)},setFocusedSpotlightConnectionId:(e,t)=>{e.focusedSpotlightConnectionIds[t.payload]=!0},setUnFocusedSpotlightConnectionId:(e,t)=>{e.focusedSpotlightConnectionIds[t.payload]=!1},deleteFocusedSpotlightConnectionId:(e,t)=>{delete e.focusedSpotlightConnectionIds[t.payload]},setShowStats:(e,t)=>{e.showStats=t.payload},setCameraDevice:(e,t)=>{e.cameraDevice=t.payload},setMicDevice:(e,t)=>{e.micDevice=t.payload},setAudioTrack:(e,t)=>{if(e.audioTrack=t.payload,e.soraContents.localMediaStream)for(const n of e.soraContents.localMediaStream.getAudioTracks())n.enabled=e.audioTrack},setVideoTrack:(e,t)=>{if(e.videoTrack=t.payload,e.soraContents.localMediaStream)for(const n of e.soraContents.localMediaStream.getVideoTracks())n.enabled=e.videoTrack},setRole:(e,t)=>{e.role=t.payload},setMultistream:(e,t)=>{e.multistream=t.payload},setSimulcast:(e,t)=>{e.simulcast=t.payload},setSpotlight:(e,t)=>{e.spotlight=t.payload},setReconnect:(e,t)=>{e.reconnect=t.payload},setApiUrl:(e,t)=>{e.apiUrl=t.payload},clearDataChannelMessages:e=>{e.dataChannelMessages=[]},setAspectRatio:(e,t)=>{e.aspectRatio=t.payload},setResizeMode:(e,t)=>{e.resizeMode=t.payload},setLightAdjustment:(e,t)=>{if(t.payload!==""&&e.lightAdjustmentProcessor===null){const n=new Rt;e.lightAdjustmentProcessor=n}e.lightAdjustment=t.payload},setBlurRadius:(e,t)=>{if(t.payload!==""&&e.virtualBackgroundProcessor===null){const n="https://cdn.jsdelivr.net/npm/@shiguredo/virtual-background@latest/dist",o=new yt(n);e.virtualBackgroundProcessor=o}e.blurRadius=t.payload},setMediaProcessorsNoiseSuppression:(e,t)=>{if(t.payload&&e.noiseSuppressionProcessor===null){const n="https://cdn.jsdelivr.net/npm/@shiguredo/noise-suppression@latest/dist",o=new Tt(n);e.noiseSuppressionProcessor=o}e.mediaProcessorsNoiseSuppression=t.payload},setBundleId:(e,t)=>{e.bundleId=t.payload},setEnabledBundleId:(e,t)=>{e.enabledBundleId=t.payload},setFacingMode:(e,t)=>{e.facingMode=t.payload},setAudioStreamingLanguageCode:(e,t)=>{e.audioStreamingLanguageCode=t.payload},setEnabledAudioStreamingLanguageCode:(e,t)=>{e.enabledAudioStreamingLanguageCode=t.payload}}});function te(e,t,n){if(e.length>=10)for(let o=0;o<=e.length-5;o++)e.pop();e.unshift(n),t.push({timestamp:n.timestamp,message:{title:`ALERT MESSAGE ${n.title}`,description:JSON.stringify({title:n.title,type:n.type,message:n.message})}})}const ms=()=>async(e,t)=>{e(d.actions.resetState());const n=$o();n.audio!==void 0&&e(d.actions.setAudio(n.audio)),n.audioBitRate!==void 0&&e(d.actions.setAudioBitRate(n.audioBitRate)),n.audioCodecType!==void 0&&e(d.actions.setAudioCodecType(n.audioCodecType));const o=await Bt(),i=o.find(L=>L.kind==="audioinput"&&L.deviceId===n.audioInput);i!==void 0&&e(d.actions.setAudioInput(i.deviceId));const a=o.find(L=>L.kind==="audiooutput"&&L.deviceId===n.audioOutput);a!==void 0&&e(d.actions.setAudioOutput(a.deviceId));const r=o.find(L=>L.kind==="videoinput"&&L.deviceId===n.videoInput);r!==void 0&&e(d.actions.setVideoInput(r.deviceId)),n.autoGainControl!==void 0&&e(d.actions.setAutoGainControl(n.autoGainControl)),n.channelId!==void 0&&e(d.actions.setChannelId(n.channelId)),n.displayResolution!==void 0&&e(d.actions.setDisplayResolution(n.displayResolution)),n.echoCancellation!==void 0&&e(d.actions.setEchoCancellation(n.echoCancellation)),n.echoCancellationType!==void 0&&e(d.actions.setEchoCancellationType(n.echoCancellationType)),n.mediaStats!==void 0&&e(d.actions.setMediaStats(n.mediaStats)),n.mediaType!==void 0&&e(d.actions.setMediaType(n.mediaType)),n.facingMode!==void 0&&e(d.actions.setFacingMode(n.facingMode)),n.fakeVolume!==void 0&&e(d.actions.setFakeVolume(n.fakeVolume)),n.frameRate!==void 0&&e(d.actions.setFrameRate(n.frameRate)),n.multistream!==void 0&&e(d.actions.setMultistream(n.multistream)),n.noiseSuppression!==void 0&&e(d.actions.setNoiseSuppression(n.noiseSuppression)),n.resolution!==void 0&&e(d.actions.setResolution(n.resolution)),n.showStats!==void 0&&e(d.actions.setShowStats(n.showStats)),n.simulcast!==void 0&&e(d.actions.setSimulcast(n.simulcast)),n.simulcastRid!==void 0&&e(d.actions.setSimulcastRid(n.simulcastRid)),n.spotlight!==void 0&&e(d.actions.setSpotlight(n.spotlight)),n.spotlightNumber!==void 0&&e(d.actions.setSpotlightNumber(n.spotlightNumber)),n.spotlightFocusRid!==void 0&&e(d.actions.setSpotlightFocusRid(n.spotlightFocusRid)),n.spotlightUnfocusRid!==void 0&&e(d.actions.setSpotlightUnfocusRid(n.spotlightUnfocusRid)),n.video!==void 0&&e(d.actions.setVideo(n.video)),n.videoBitRate!==void 0&&e(d.actions.setVideoBitRate(n.videoBitRate)),n.videoCodecType!==void 0&&e(d.actions.setVideoCodecType(n.videoCodecType)),n.videoVP9Params!==void 0&&e(d.actions.setVideoVP9Params(n.videoVP9Params)),n.videoH264Params!==void 0&&e(d.actions.setVideoH264Params(n.videoH264Params)),n.videoH265Params!==void 0&&e(d.actions.setVideoH265Params(n.videoH265Params)),n.videoAV1Params!==void 0&&e(d.actions.setVideoAV1Params(n.videoAV1Params)),n.debug!==void 0&&e(d.actions.setDebug(n.debug)),n.debugType!==void 0&&e(d.actions.setDebugType(n.debugType)),n.mute!==void 0&&e(d.actions.setMute(n.mute)),n.dataChannelSignaling!==void 0&&e(d.actions.setDataChannelSignaling(n.dataChannelSignaling)),n.ignoreDisconnectWebSocket!==void 0&&e(d.actions.setIgnoreDisconnectWebSocket(n.ignoreDisconnectWebSocket)),n.micDevice!==void 0&&e(d.actions.setMicDevice(n.micDevice)),n.cameraDevice!==void 0&&e(d.actions.setCameraDevice(n.cameraDevice)),n.audioTrack!==void 0&&e(d.actions.setAudioTrack(n.audioTrack)),n.videoTrack!==void 0&&e(d.actions.setVideoTrack(n.videoTrack)),n.googCpuOveruseDetection!==void 0&&n.googCpuOveruseDetection!==null&&e(d.actions.setGoogCpuOveruseDetection(n.googCpuOveruseDetection)),n.bundleId!==void 0&&e(d.actions.setBundleId(n.bundleId)),n.clientId!==void 0&&e(d.actions.setClientId(n.clientId)),n.metadata!==void 0&&e(d.actions.setMetadata(n.metadata)),n.signalingNotifyMetadata!==void 0&&e(d.actions.setSignalingNotifyMetadata(n.signalingNotifyMetadata)),n.signalingUrlCandidates!==void 0&&e(d.actions.setSignalingUrlCandidates(n.signalingUrlCandidates)),n.forwardingFilter!==void 0&&e(d.actions.setForwardingFilter(n.forwardingFilter)),n.dataChannels!==void 0&&e(d.actions.setDataChannels(n.dataChannels)),n.audioContentHint!==void 0&&e(d.actions.setAudioContentHint(n.audioContentHint)),n.videoContentHint!==void 0&&e(d.actions.setVideoContentHint(n.videoContentHint)),n.reconnect!==void 0&&e(d.actions.setReconnect(n.reconnect)),n.aspectRatio!==void 0&&e(d.actions.setAspectRatio(n.aspectRatio)),n.resizeMode!==void 0&&e(d.actions.setResizeMode(n.resizeMode)),n.blurRadius!==void 0&&e(d.actions.setBlurRadius(n.blurRadius)),n.lightAdjustment!==void 0&&e(d.actions.setLightAdjustment(n.lightAdjustment)),n.mediaProcessorsNoiseSuppression!==void 0&&e(d.actions.setMediaProcessorsNoiseSuppression(n.mediaProcessorsNoiseSuppression)),n.apiUrl!==void 0&&n.apiUrl!==null&&e(d.actions.setApiUrl(n.apiUrl)),n.role!==void 0&&e(d.actions.setRole(n.role)),n.audioStreamingLanguageCode!==void 0&&e(d.actions.setAudioStreamingLanguageCode(n.audioStreamingLanguageCode)),e(d.actions.setInitialFakeContents());const{audioStreamingLanguageCode:c,bundleId:u,clientId:m,dataChannelSignaling:g,dataChannels:S,ignoreDisconnectWebSocket:C,metadata:y,signalingNotifyMetadata:x,signalingUrlCandidates:N,forwardingFilter:k,videoVP9Params:rn,videoH264Params:cn,videoH265Params:ln,videoAV1Params:dn}=t();u!==""&&e(d.actions.setEnabledBundleId(!0)),m!==""&&e(d.actions.setEnabledClientId(!0)),y!==""&&e(d.actions.setEnabledMetadata(!0)),x!==""&&e(d.actions.setEnabledSignalingNotifyMetadata(!0)),N.length>0&&e(d.actions.setEnabledSignalingUrlCandidates(!0)),k!==""&&e(d.actions.setEnabledForwardingFilter(!0)),(g!==""||C!=="")&&e(d.actions.setEnabledDataChannel(!0)),S!==""&&e(d.actions.setEnabledDataChannels(!0)),c!==""&&e(d.actions.setEnabledAudioStreamingLanguageCode(!0)),rn!==""&&e(d.actions.setEnabledVideoVP9Params(!0)),cn!==""&&e(d.actions.setEnabledVideoH264Params(!0)),ln!==""&&e(d.actions.setEnabledVideoH265Params(!0)),dn!==""&&e(d.actions.setEnabledVideoAV1Params(!0)),e(d.actions.setSoraConnectionStatus("disconnected"))},gs=()=>(e,t)=>{const n=t(),o=!(n.role==="recvonly"&&(n.multistream==="true"||n.multistream==="")),i={channelId:n.channelId,role:n.role,audio:n.audio,video:n.video,debug:n.debug,mediaType:n.mediaType!=="getUserMedia"?n.mediaType:void 0,audioBitRate:o&&n.audioBitRate!==""?n.audioBitRate:void 0,audioCodecType:o&&n.audioCodecType!==""?n.audioCodecType:void 0,videoBitRate:o&&n.videoBitRate!==""?n.videoBitRate:void 0,videoCodecType:o&&n.videoCodecType!==""?n.videoCodecType:void 0,videoVP9Params:o&&n.videoVP9Params!==""&&n.enabledVideoVP9Params?n.videoVP9Params:void 0,videoH264Params:o&&n.videoH264Params!==""&&n.enabledVideoH264Params?n.videoH264Params:void 0,videoH265Params:o&&n.videoH265Params!==""&&n.enabledVideoH265Params?n.videoH265Params:void 0,videoAV1Params:o&&n.videoAV1Params!==""&&n.enabledVideoAV1Params?n.videoAV1Params:void 0,audioContentHint:n.audioContentHint!==""?n.audioContentHint:void 0,autoGainControl:n.autoGainControl!==""?n.autoGainControl:void 0,noiseSuppression:n.noiseSuppression!==""?n.noiseSuppression:void 0,echoCancellation:n.echoCancellation!==""?n.echoCancellation:void 0,echoCancellationType:n.echoCancellationType!==""?n.echoCancellationType:void 0,videoContentHint:n.videoContentHint!==""?n.videoContentHint:void 0,resolution:n.resolution!==""?n.resolution:void 0,facingMode:n.facingMode!==""?n.facingMode:void 0,frameRate:n.frameRate!==""?n.frameRate:void 0,aspectRatio:n.aspectRatio!==""?n.aspectRatio:void 0,resizeMode:n.resizeMode!==""?n.resizeMode:void 0,blurRadius:n.blurRadius!==""?n.blurRadius:void 0,lightAdjustment:n.lightAdjustment!==""?n.lightAdjustment:void 0,multistream:n.multistream!==""?n.multistream:void 0,simulcast:n.simulcast!==""?n.simulcast:void 0,simulcastRid:n.simulcastRid!==""?n.simulcastRid:void 0,spotlight:n.spotlight!==""?n.spotlight:void 0,spotlightNumber:n.spotlightNumber!==""?n.spotlightNumber:void 0,spotlightFocusRid:n.spotlightFocusRid!==""?n.spotlightFocusRid:void 0,spotlightUnfocusRid:n.spotlightUnfocusRid!==""?n.spotlightUnfocusRid:void 0,audioInput:n.mediaType==="getUserMedia"&&n.audioInput!==""?n.audioInput:void 0,audioOutput:n.audioOutput!==""?n.audioOutput:void 0,videoInput:n.mediaType==="getUserMedia"&&n.videoInput!==""?n.videoInput:void 0,displayResolution:n.displayResolution!==""?n.displayResolution:void 0,mediaStats:n.mediaStats===!0?!0:void 0,bundleId:n.bundleId!==""&&n.enabledBundleId?n.bundleId:void 0,clientId:n.clientId!==""&&n.enabledClientId?n.clientId:void 0,metadata:n.metadata!==""&&n.enabledMetadata?n.metadata:void 0,signalingNotifyMetadata:n.signalingNotifyMetadata!==""&&n.enabledSignalingNotifyMetadata?n.signalingNotifyMetadata:void 0,forwardingFilter:n.forwardingFilter!==""&&n.enabledForwardingFilter?n.forwardingFilter:void 0,dataChannelSignaling:n.dataChannelSignaling!==""&&n.enabledDataChannel?n.dataChannelSignaling:void 0,ignoreDisconnectWebSocket:n.ignoreDisconnectWebSocket!==""&&n.enabledDataChannel?n.ignoreDisconnectWebSocket:void 0,dataChannels:n.dataChannels!==""&&n.enabledDataChannels?n.dataChannels:void 0,reconnect:n.reconnect===!0?!0:void 0,mediaProcessorsNoiseSuppression:n.mediaProcessorsNoiseSuppression===!0?!0:void 0,micDevice:n.micDevice===!1?!1:void 0,cameraDevice:n.cameraDevice===!1?!1:void 0,audioTrack:n.audioTrack===!1?!1:void 0,videoTrack:n.videoTrack===!1?!1:void 0,signalingUrlCandidates:n.signalingUrlCandidates.length>0&&n.enabledSignalingUrlCandidates?n.signalingUrlCandidates:void 0,apiUrl:n.apiUrl!==null?n.apiUrl:void 0,fakeVolume:n.mediaType==="fakeMedia"?n.fakeVolume:void 0,mute:n.mute===!0?!0:void 0,audioStreamingLanguageCode:o&&n.audioStreamingLanguageCode!==""&&n.enabledAudioStreamingLanguageCode?n.audioStreamingLanguageCode:void 0},a=Object.keys(i).map(r=>{const c=i[r];if(c!==void 0)return r==="signalingUrlCandidates"?`${r}=${encodeURIComponent(JSON.stringify(c))}`:`${r}=${encodeURIComponent(c)}`}).filter(r=>r!==void 0);ge(`${location.origin}${location.pathname}?${a.join("&")}`),window.history.replaceState(null,"",`${location.pathname}?${a.join("&")}`)};async function J(e,t){const n="MEDIA_CONSTRAINTS";if(t.mediaType==="getDisplayMedia"){if(!t.video||!t.cameraDevice)return[new MediaStream,null];if(navigator.mediaDevices===void 0)throw new Error("Failed to call getUserMedia. Make sure domain is secure");const r={audio:rt({audio:t.audio,autoGainControl:t.autoGainControl,noiseSuppression:t.noiseSuppression,echoCancellation:t.echoCancellation,echoCancellationType:t.echoCancellationType}),video:ct({frameRate:t.frameRate,resolution:t.resolution,aspectRatio:t.aspectRatio,resizeMode:t.resizeMode})};e(d.actions.setLogMessages({title:n,description:JSON.stringify(r)})),e(d.actions.setTimelineMessage(A("media-constraints",r)));const c=await navigator.mediaDevices.getDisplayMedia(r);e(d.actions.setTimelineMessage(A("succeed-get-display-media")));for(const u of c.getVideoTracks())u.contentHint!==void 0&&(u.contentHint=t.videoContentHint),u.enabled=t.videoTrack,e(d.actions.setTimelineMessage(M("start",u)));return[c,null]}if(t.mediaType==="mediacaptureRegion"){if(!t.video||!t.cameraDevice)return[new MediaStream,null];if(window.CropTarget===void 0)throw new Error("Failed to call CropTarget");if(navigator.mediaDevices===void 0)throw new Error("Failed to call getDisplayMedia. Make sure domain is secure");const r={audio:rt({audio:t.audio,autoGainControl:t.autoGainControl,noiseSuppression:t.noiseSuppression,echoCancellation:t.echoCancellation,echoCancellationType:t.echoCancellationType}),video:ct({frameRate:t.frameRate,resolution:t.resolution,aspectRatio:t.aspectRatio,resizeMode:t.resizeMode})};r.preferCurrentTab=!0,e(d.actions.setLogMessages({title:n,description:JSON.stringify(r)})),e(d.actions.setTimelineMessage(A("media-constraints",r)));const c=await navigator.mediaDevices.getDisplayMedia(r),u=document.querySelector("#cropArea");if(u===null)throw new Error("Failed to get CropTraget Element");const m=await window.CropTarget.fromElement(u);e(d.actions.setTimelineMessage(A("succeed-get-display-media")));for(const g of c.getVideoTracks())g.contentHint!==void 0&&(g.contentHint=t.videoContentHint),g.enabled=t.videoTrack,await g.cropTo(m),e(d.actions.setTimelineMessage(M("start",g)));return[c,null]}if(t.mediaType==="fakeMedia"&&t.fakeContents.worker){const r=qo({audio:t.audio&&t.micDevice,video:t.video&&t.cameraDevice,frameRate:t.frameRate,resolution:t.resolution,volume:t.fakeVolume,aspectRatio:t.aspectRatio,resizeMode:t.resizeMode});e(d.actions.setLogMessages({title:n,description:JSON.stringify(r)})),e(d.actions.setTimelineMessage(A("media-constraints",r)));const{canvas:c,mediaStream:u,gainNode:m}=Ko(r);c!==null&&(t.fakeContents.worker.onmessage=g=>{const S=g.data;S.type==="update"&&Yo(c,t.fakeContents.colorCode,r.fontSize,S.counter.toString())},t.fakeContents.worker.postMessage({type:"stop"}),t.fakeContents.worker.postMessage({type:"start",interval:1e3/r.frameRate}));for(const g of u.getVideoTracks())g.contentHint!==void 0&&(g.contentHint=t.videoContentHint),g.enabled=t.videoTrack,e(d.actions.setTimelineMessage(M("start",g)));for(const g of u.getAudioTracks())g.contentHint!==void 0&&(g.contentHint=t.audioContentHint),g.enabled=t.audioTrack,e(d.actions.setTimelineMessage(M("start",g)));return e(d.actions.setTimelineMessage(A("succeed-create-fake-media"))),[u,m]}if(t.mediaType==="mp4Media"){if(t.mp4MediaStream===null)throw new Error("No MP4 file has been selected");return[await t.mp4MediaStream.play({repeat:!0}),null]}if(navigator.mediaDevices===void 0)throw new Error("Failed to call getUserMedia. Make sure domain is secure");const o=new MediaStream,i=Jo({audio:t.audio&&t.micDevice,autoGainControl:t.autoGainControl,noiseSuppression:t.noiseSuppression,echoCancellation:t.echoCancellation,echoCancellationType:t.echoCancellationType,audioInput:t.audioInput}),a=Wo({aspectRatio:t.aspectRatio,frameRate:t.frameRate,resizeMode:t.resizeMode,resolution:t.resolution,video:t.video&&t.cameraDevice,videoInput:t.videoInput,facingMode:t.facingMode});if(i||a){const r={};i&&(r.audio=i),a&&(r.video=a),e(d.actions.setLogMessages({title:n,description:JSON.stringify(r)})),e(d.actions.setTimelineMessage(A("media-constraints",r)));const c=await navigator.mediaDevices.getUserMedia(r).catch(u=>{throw o.getTracks().filter(m=>{m.stop()}),u});if(i){let u=c.getAudioTracks()[0];if(e(d.actions.setTimelineMessage(M("start",u))),t.mediaProcessorsNoiseSuppression&&Tt.isSupported()){if(t.noiseSuppressionProcessor===null)throw new Error("Failed to start NoiseSuppressionProcessor. NoiseSuppressionProcessor is 'null'");t.noiseSuppressionProcessor.stopProcessing(),u=await t.noiseSuppressionProcessor.startProcessing(u)}e(d.actions.setTimelineMessage(A("succeed-audio-get-user-media"))),o.addTrack(u)}if(a){let u=c.getVideoTracks()[0];if(e(d.actions.setTimelineMessage(M("start",u))),t.lightAdjustment!==""&&Rt.isSupported()){if(t.lightAdjustmentProcessor===null)throw new Error("Failed to start LightAdjustmentProcessor. LightAdjustmentProcessor is 'null'");const m=zo(t.lightAdjustment);t.lightAdjustmentProcessor.stopProcessing(),u=await t.lightAdjustmentProcessor.startProcessing(u,m)}if(t.blurRadius!==""&&yt.isSupported()){if(t.virtualBackgroundProcessor===null)throw new Error("Failed to start VirtualBackgroundProcessor. VirtualBackgroundProcessor is 'null'");const m={blurRadius:Go(t.blurRadius)};t.virtualBackgroundProcessor.stopProcessing(),u=await t.virtualBackgroundProcessor.startProcessing(u,m)}e(d.actions.setTimelineMessage(A("succeed-video-get-user-media"))),o.addTrack(u)}}for(const r of o.getVideoTracks())r.contentHint!==void 0&&(r.contentHint=t.videoContentHint),r.enabled=t.videoTrack;for(const r of o.getAudioTracks())r.contentHint!==void 0&&(r.contentHint=t.audioContentHint),r.enabled=t.audioTrack;return[o,null]}function K(e,t,n){n.on("log",(o,i)=>{e(d.actions.setLogMessages({title:o,description:JSON.stringify(i)}))}),n.on("notify",(o,i)=>{o.event_type==="spotlight.focused"&&typeof o.connection_id=="string"&&e(d.actions.setFocusedSpotlightConnectionId(o.connection_id)),o.event_type==="spotlight.unfocused"&&typeof o.connection_id=="string"&&e(d.actions.setUnFocusedSpotlightConnectionId(o.connection_id)),o.event_type==="connection.destroyed"&&typeof o.connection_id=="string"&&e(d.actions.deleteFocusedSpotlightConnectionId(o.connection_id));const{soraContents:a}=t();if(o.event_type==="connection.created"&&typeof o.connection_id=="string"&&o.connection_id===a.sora?.connectionId){if(typeof o.session_id=="string"&&e(d.actions.setSoraSessionId(o.session_id)),typeof o.connection_id=="string"&&e(d.actions.setSoraConnectionId(o.connection_id)),typeof o.client_id=="string"&&e(d.actions.setSoraClientId(o.client_id)),Array.isArray(o.data))for(const r of o.data)typeof r.connection_id=="string"&&typeof r.client_id=="string"&&e(d.actions.setSoraRemoteClientId({connectionId:r.connection_id,clientId:r.client_id}))}else o.event_type==="connection.created"&&typeof o.connection_id=="string"&&typeof o.client_id=="string"&&e(d.actions.setSoraRemoteClientId({connectionId:o.connection_id,clientId:o.client_id}));e(d.actions.setNotifyMessages({timestamp:new Date().getTime(),message:o,transportType:i}))}),n.on("push",(o,i)=>{e(d.actions.setPushMessages({timestamp:new Date().getTime(),message:o,transportType:i}))}),n.on("track",o=>{e(d.actions.setTimelineMessage(A("event-on-track")));const{soraContents:i}=t();if(!i.remoteClients.find(r=>r.connectionId===o.streams[0].id)){for(const r of o.streams[0].getTracks())e(d.actions.setTimelineMessage(A(`remote-${r.kind}-mediastream-track`,Ut(r))));e(d.actions.setRemoteClient({mediaStream:o.streams[0],connectionId:o.streams[0].id,clientId:null}))}}),n.on("removetrack",o=>{e(d.actions.setTimelineMessage(A("event-on-removetrack")));const{soraContents:i}=t(),a=i.remoteClients.find(r=>{if(o?.target)return r.connectionId===o.target.id});a&&e(d.actions.removeRemoteClient(a.connectionId))}),n.on("disconnect",o=>{const i={type:o.type,title:o.title};o.code!==void 0&&(i.code=o.code),o.reason!==void 0&&(i.reason=o.reason),o.params!==void 0&&(i.params=o.params),e(d.actions.setTimelineMessage(A("event-on-disconnect",i)));const{fakeContents:a,soraContents:r,reconnect:c,lightAdjustmentProcessor:u,virtualBackgroundProcessor:m,noiseSuppressionProcessor:g}=t(),{localMediaStream:S,remoteClients:C}=r,y=Le(u,m);(async()=>await _e(e,S,y))(),$e(e,S,g),C.filter(x=>{x.mediaStream.getTracks().filter(N=>{N.stop()})}),a.worker&&a.worker.postMessage({type:"stop"}),e(d.actions.setSora(null)),e(d.actions.setSoraSessionId(null)),e(d.actions.setSoraConnectionId(null)),e(d.actions.setSoraClientId(null)),e(d.actions.setSoraTurnUrl(null)),e(d.actions.setSoraConnectionStatus("disconnected")),e(d.actions.setLocalMediaStream(null)),e(d.actions.removeAllRemoteClients()),e(d.actions.setSoraInfoAlertMessage("Disconnect Sora.")),e(d.actions.setTimelineMessage(A("disconnected"))),o.type==="abend"&&c&&e(d.actions.setSoraReconnecting(!0))}),n.on("timeline",o=>{const i={timestamp:new Date().getTime(),type:o.type,data:o.data,dataChannelId:o.dataChannelId,dataChannelLabel:o.dataChannelLabel,logType:o.logType};e(d.actions.setTimelineMessage(i)),o.data&&typeof o.data=="object"&&"sdp"in o.data&&e(d.actions.setTimelineMessage(A(`${o.type}-sdp`,o.data.sdp)))}),n.on("signaling",o=>{const i={timestamp:new Date().getTime(),transportType:o.transportType,type:o.type,data:o.data};e(d.actions.setSignalingMessage(i))}),n.on("message",o=>{e(d.actions.setDataChannelMessage({timestamp:new Date().getTime(),label:o.label,data:o.data}))}),n.on("datachannel",o=>{e(d.actions.setSoraDataChannels(o.datachannel))})}function _t(e){return{audio:e.audio,audioBitRate:e.audioBitRate,audioCodecType:e.audioCodecType,audioStreamingLanguageCode:e.audioStreamingLanguageCode,bundleId:e.bundleId,clientId:e.clientId,dataChannelSignaling:e.dataChannelSignaling,dataChannels:e.enabledDataChannels?e.dataChannels:"",enabledAudioStreamingLanguageCode:e.enabledAudioStreamingLanguageCode,enabledBundleId:e.enabledBundleId,enabledClientId:e.enabledClientId,enabledDataChannel:e.enabledDataChannel,enabledSignalingNotifyMetadata:e.enabledSignalingNotifyMetadata,enabledForwardingFilter:e.enabledForwardingFilter,enabledVideoVP9Params:e.enabledVideoVP9Params,enabledVideoH264Params:e.enabledVideoH264Params,enabledVideoH265Params:e.enabledVideoH265Params,enabledVideoAV1Params:e.enabledVideoAV1Params,ignoreDisconnectWebSocket:e.ignoreDisconnectWebSocket,multistream:e.multistream,signalingNotifyMetadata:e.signalingNotifyMetadata,forwardingFilter:e.forwardingFilter,simulcast:e.simulcast,simulcastRid:e.simulcastRid,spotlight:e.spotlight,spotlightFocusRid:e.spotlightFocusRid,spotlightNumber:e.spotlightNumber,spotlightUnfocusRid:e.spotlightUnfocusRid,video:e.video,videoBitRate:e.videoBitRate,videoCodecType:e.videoCodecType,videoVP9Params:e.videoVP9Params,videoH264Params:e.videoH264Params,videoH265Params:e.videoH265Params,videoAV1Params:e.videoAV1Params,role:e.role}}function A(e,t){return{type:e,logType:"sora-devtools",timestamp:new Date().getTime(),data:t}}function M(e,t){const n=Ut(t);return A(`${e}-${t.kind}-mediastream-track`,n)}async function re(e,t){if(t.pc&&t.pc?.iceConnectionState!=="closed"){const n=await t.pc.getStats(),o=[],i=[];n.forEach(a=>{o.push(a),a.type==="local-candidate"&&i.push(a)}),e(d.actions.setStatsReport(o));for(const a of i){const r=a;if(r.url!==void 0){e(d.actions.setSoraTurnUrl(r.url));break}}}}const ps=()=>async(e,t)=>{const n="REQUEST_MEDIA",o=t();let i,a;try{[i,a]=await J(e,o).catch(r=>{throw r})}catch(r){r instanceof Error&&(e(d.actions.setLogMessages({title:n,description:JSON.stringify(r.message)})),e(d.actions.setAPIErrorAlertMessage(`Failed to get user devices. ${r.message}`)));let c;if(o.lightAdjustmentProcessor?.isProcessing()&&(c=o.lightAdjustmentProcessor.getOriginalTrack(),o.lightAdjustmentProcessor.stopProcessing()),o.virtualBackgroundProcessor?.isProcessing()&&(c===void 0&&(c=o.virtualBackgroundProcessor.getOriginalTrack()),o.virtualBackgroundProcessor.stopProcessing()),c?(c.stop(),e(d.actions.setTimelineMessage(M("stop",c)))):i&&i.getVideoTracks().filter(u=>{u.stop(),e(d.actions.setTimelineMessage(M("stop",u)))}),o.noiseSuppressionProcessor?.isProcessing()){const u=o.noiseSuppressionProcessor.getOriginalTrack();u&&(u.stop(),e(d.actions.setTimelineMessage(M("stop",u)))),o.noiseSuppressionProcessor.stopProcessing()}else i&&i.getAudioTracks().filter(u=>{u.stop(),e(d.actions.setTimelineMessage(M("stop",u)))});throw r}a&&e(d.actions.setFakeContentsGainNode(a)),e(d.actions.setLocalMediaStream(i))},fs=()=>async(e,t)=>{const{fakeContents:n,soraContents:o,lightAdjustmentProcessor:i,noiseSuppressionProcessor:a,virtualBackgroundProcessor:r}=t(),{localMediaStream:c}=o;let u;if(i?.isProcessing()&&(u=i.getOriginalTrack(),i.stopProcessing()),r?.isProcessing()&&(u===void 0&&(u=r.getOriginalTrack()),r.stopProcessing()),u!==void 0?(u.stop(),c?.removeTrack(u),e(d.actions.setTimelineMessage(M("stop",u)))):c&&c.getVideoTracks().filter(m=>{m.stop(),c.removeTrack(m),e(d.actions.setTimelineMessage(M("stop",m)))}),a?.isProcessing()){const m=a.getOriginalTrack();m&&(m.stop(),c?.removeTrack(m),e(d.actions.setTimelineMessage(M("stop",m)))),a.stopProcessing()}else c&&c.getAudioTracks().filter(m=>{m.stop(),c.removeTrack(m),e(d.actions.setTimelineMessage(M("stop",m)))});n.worker&&n.worker.postMessage({type:"stop"}),e(d.actions.setLocalMediaStream(null))},hs=()=>async(e,t)=>{e(d.actions.setTimelineMessage(A("start-connection"))),e(d.actions.setSoraConnectionStatus("preparing"));const n=t();let o=!1;n.soraContents.sora&&(await n.soraContents.sora.disconnect(),o=!0);const i=Ht(n.enabledSignalingUrlCandidates,n.signalingUrlCandidates);e(d.actions.setLogMessages({title:"SIGNALING_URL",description:JSON.stringify(i)}));const a=ue.connection(i,n.debug),r=_t(n),c=Lt(r),u=$(n.enabledMetadata,n.metadata);let m,g,S;try{n.role==="sendonly"?(m=a.sendonly(n.channelId,null,c),m.metadata=u,typeof n.googCpuOveruseDetection=="boolean"&&(m.constraints={optional:[{googCpuOveruseDetection:n.googCpuOveruseDetection}]}),K(e,t,m),!o&&n.soraContents.localMediaStream?g=n.soraContents.localMediaStream:[g,S]=await J(e,n).catch(y=>{throw e(d.actions.setSoraErrorAlertMessage(y.toString())),e(d.actions.setSoraConnectionStatus("disconnected")),y}),e(d.actions.setSoraConnectionStatus("connecting")),e(d.actions.setSora(m)),await m.connect(g)):n.role==="sendrecv"?(m=a.sendrecv(n.channelId,null,c),m.metadata=u,typeof n.googCpuOveruseDetection=="boolean"&&(m.constraints={optional:[{googCpuOveruseDetection:n.googCpuOveruseDetection}]}),K(e,t,m),!o&&n.soraContents.localMediaStream?g=n.soraContents.localMediaStream:[g,S]=await J(e,n).catch(y=>{throw e(d.actions.setSoraErrorAlertMessage(y.toString())),e(d.actions.setSoraConnectionStatus("disconnected")),y}),e(d.actions.setSora(m)),await m.connect(g)):n.role==="recvonly"&&(m=a.recvonly(n.channelId,null,c),m.metadata=u,K(e,t,m),e(d.actions.setSoraConnectionStatus("connecting")),e(d.actions.setSora(m)),await m.connect())}catch(y){e(d.actions.setSora(null)),y instanceof Error&&e(d.actions.setSoraErrorAlertMessage(`Failed to connect Sora. ${y.message}`));let x;if(n.lightAdjustmentProcessor?.isProcessing()&&(x=n.lightAdjustmentProcessor.getOriginalTrack(),n.lightAdjustmentProcessor.stopProcessing()),n.virtualBackgroundProcessor?.isProcessing()&&(x===void 0&&(x=n.virtualBackgroundProcessor.getOriginalTrack()),n.virtualBackgroundProcessor.stopProcessing()),x?(x.stop(),e(d.actions.setTimelineMessage(M("stop",x)))):g&&g.getVideoTracks().filter(N=>{N.stop(),e(d.actions.setTimelineMessage(M("stop",N)))}),n.noiseSuppressionProcessor?.isProcessing()){const N=n.noiseSuppressionProcessor.getOriginalTrack();N&&(N.stop(),e(d.actions.setTimelineMessage(M("stop",N)))),n.noiseSuppressionProcessor.stopProcessing()}else g&&g.getAudioTracks().filter(N=>{N.stop(),e(d.actions.setTimelineMessage(M("stop",N)))});throw e(d.actions.setSoraConnectionStatus("disconnected")),y}if(m===void 0)throw new Error("Failed to connect Sora. Connection object is 'undefined'");e(d.actions.setSoraInfoAlertMessage("Succeeded to connect Sora.")),await re(e,m);const C=setInterval(async()=>{const{soraContents:y}=t();y.sora?await re(e,y.sora):clearInterval(C)},1e3);m.stream=null,g&&(n.soraContents.localMediaStream===null||o)&&e(d.actions.setLocalMediaStream(g)),S&&e(d.actions.setFakeContentsGainNode(S)),e(d.actions.setSoraConnectionStatus("connected")),e(d.actions.setTimelineMessage(A("connected")))},Cs=()=>async(e,t)=>{e(d.actions.setTimelineMessage(A("start-reconnect"))),e(d.actions.setSoraConnectionStatus("connecting"));const n=t();n.soraContents.sora&&n.soraContents.connectionStatus==="connected"&&await n.soraContents.sora.disconnect();const o=Ht(n.enabledSignalingUrlCandidates,n.signalingUrlCandidates);e(d.actions.setLogMessages({title:"SIGNALING_URL",description:JSON.stringify(o)}));const i=ue.connection(o,n.debug),a=_t(n),r=Lt(a),c=$(n.enabledMetadata,n.metadata);let u,m,g;(n.role==="sendonly"||n.role==="sendrecv")&&([m,g]=await J(e,n).catch(C=>{throw e(d.actions.setSoraErrorAlertMessage(C.toString())),e(d.actions.setSoraConnectionStatus("disconnected")),C}));for(let C=1;C<=10;C++){const{soraContents:y}=t();if(y.reconnecting===!1)break;e(d.actions.setSoraReconnectingTrials(C));try{n.role==="sendonly"?(u=i.sendonly(n.channelId,null,r),u.metadata=c,typeof n.googCpuOveruseDetection=="boolean"&&(u.constraints={optional:[{googCpuOveruseDetection:n.googCpuOveruseDetection}]}),K(e,t,u),m&&await u.connect(m)):n.role==="sendrecv"?(u=i.sendrecv(n.channelId,null,r),u.metadata=c,typeof n.googCpuOveruseDetection=="boolean"&&(u.constraints={optional:[{googCpuOveruseDetection:n.googCpuOveruseDetection}]}),K(e,t,u),m&&await u.connect(m)):n.role==="recvonly"&&(u=i.recvonly(n.channelId,null,r),u.metadata=c,K(e,t,u),await u.connect())}catch(x){x instanceof Error&&e(d.actions.setSoraErrorAlertMessage(`(trials ${C}) Failed to connect Sora. ${x.message}`)),u=void 0}if(u!==void 0)break;await new Promise(x=>setTimeout(x,C*500+500))}if(u===void 0){e(d.actions.setSoraErrorAlertMessage("Failed to reconnect Sora.")),e(d.actions.setSoraConnectionStatus("disconnected")),e(d.actions.setSoraReconnecting(!1));return}e(d.actions.setSoraInfoAlertMessage("Succeeded to reconnect Sora.")),await re(e,u);const S=setInterval(async()=>{const{soraContents:C}=t();C.sora?await re(e,C.sora):clearInterval(S)},1e3);e(d.actions.setSora(u)),m&&e(d.actions.setLocalMediaStream(m)),g&&e(d.actions.setFakeContentsGainNode(g)),e(d.actions.setSoraConnectionStatus("connected")),e(d.actions.setTimelineMessage(A("connected"))),e(d.actions.setSoraReconnecting(!1))},$t=()=>async(e,t)=>{const{soraContents:n}=t();n.sora&&n.connectionStatus==="connected"&&(e(d.actions.setSoraConnectionStatus("disconnecting")),await n.sora.disconnect(),e(d.actions.setSoraConnectionStatus("disconnected")))},Gt=()=>async(e,t)=>{const n=await Bt(),o=[],i=[],a=[];n.filter(r=>{r.deviceId!==""&&(r.kind==="audioinput"?o.push(r.toJSON()):r.kind==="audiooutput"?a.push(r.toJSON()):r.kind==="videoinput"&&i.push(r.toJSON()))}),e(d.actions.setAudioInputDevices(o)),e(d.actions.setVideoInputDevices(i)),e(d.actions.setAudioOutputDevices(a))},xs=()=>async(e,t)=>{const n=await navigator.serviceWorker.getRegistrations();for(const o of n)await o.unregister()},Xe=()=>async(e,t)=>{const n=t();if(!n.soraContents.localMediaStream)return;if(n.virtualBackgroundProcessor?.isProcessing()){const a=n.virtualBackgroundProcessor.getOriginalTrack();a&&(a.stop(),e(d.actions.setTimelineMessage(M("stop",a)))),n.virtualBackgroundProcessor.stopProcessing()}else n.soraContents.localMediaStream&&n.soraContents.localMediaStream.getVideoTracks().filter(a=>{a.stop(),e(d.actions.setTimelineMessage(M("stop",a)))});if(n.noiseSuppressionProcessor?.isProcessing()){const a=n.noiseSuppressionProcessor.getOriginalTrack();a&&(a.stop(),e(d.actions.setTimelineMessage(M("stop",a)))),n.noiseSuppressionProcessor.stopProcessing()}else n.soraContents.localMediaStream&&n.soraContents.localMediaStream.getAudioTracks().filter(a=>{a.stop(),e(d.actions.setTimelineMessage(M("stop",a)))});const[o,i]=await J(e,n).catch(a=>{throw e(d.actions.setSoraErrorAlertMessage(a.toString())),e(d.actions.setSoraConnectionStatus("disconnected")),a});o.getTracks().filter(a=>{if(!n.soraContents.sora||!n.soraContents.sora.pc)return;const r=n.soraContents.sora.pc.getSenders().find(c=>c.track?c.track.kind===a.kind:!1);r&&r.replaceTrack(a)}),e(d.actions.setLocalMediaStream(o)),e(d.actions.setFakeContentsGainNode(i))},Ss=e=>async(t,n)=>{const o=n();if(!o.soraContents.localMediaStream||!o.soraContents.sora){t(d.actions.setMicDevice(e));return}if(e){const i={aspectRatio:o.aspectRatio,audio:o.audio,audioContentHint:o.audioContentHint,audioInput:o.audioInput,audioTrack:o.audioTrack,autoGainControl:o.autoGainControl,blurRadius:o.blurRadius,cameraDevice:o.cameraDevice,echoCancellation:o.echoCancellation,echoCancellationType:o.echoCancellationType,facingMode:o.facingMode,fakeContents:o.fakeContents,fakeVolume:o.fakeVolume,frameRate:o.frameRate,lightAdjustment:o.lightAdjustment,lightAdjustmentProcessor:o.lightAdjustmentProcessor,mediaProcessorsNoiseSuppression:o.mediaProcessorsNoiseSuppression,mediaType:o.mediaType,micDevice:e,noiseSuppression:o.noiseSuppression,noiseSuppressionProcessor:o.noiseSuppressionProcessor,resizeMode:o.resizeMode,resolution:o.resolution,video:!1,videoContentHint:o.videoContentHint,videoInput:o.videoInput,videoTrack:o.videoTrack,virtualBackgroundProcessor:o.virtualBackgroundProcessor},[a,r]=await J(t,i).catch(c=>{throw t(d.actions.setSoraErrorAlertMessage(c.toString())),c});a.getAudioTracks().length>0&&(o.soraContents.sora&&o.soraContents.connectionStatus==="connected"&&o.soraContents.localMediaStream?await o.soraContents.sora.replaceAudioTrack(o.soraContents.localMediaStream,a.getAudioTracks()[0]):o.soraContents.localMediaStream&&(o.soraContents.localMediaStream.getAudioTracks().filter(c=>{c.enabled=!1,c.stop(),o.soraContents.localMediaStream?.removeTrack(c)}),o.soraContents.localMediaStream.addTrack(a.getAudioTracks()[0])),t(d.actions.setFakeContentsGainNode(r)))}else o.soraContents.sora&&o.soraContents.connectionStatus==="connected"&&o.soraContents.localMediaStream?($e(t,o.soraContents.localMediaStream,o.noiseSuppressionProcessor),o.soraContents.sora.stopAudioTrack(o.soraContents.localMediaStream)):o.soraContents.localMediaStream&&$e(t,o.soraContents.localMediaStream,o.noiseSuppressionProcessor);t(d.actions.setMicDevice(e))},js=e=>async(t,n)=>{const o=n();if(!o.soraContents.localMediaStream&&!o.soraContents.sora&&o.soraContents.connectionStatus!=="connected"){t(d.actions.setCameraDevice(e));return}if(e){const i={aspectRatio:o.aspectRatio,audio:!1,audioContentHint:o.audioContentHint,audioInput:o.audioInput,audioTrack:o.audioTrack,autoGainControl:o.autoGainControl,blurRadius:o.blurRadius,cameraDevice:e,echoCancellation:o.echoCancellation,echoCancellationType:o.echoCancellationType,facingMode:o.facingMode,fakeContents:o.fakeContents,fakeVolume:o.fakeVolume,frameRate:o.frameRate,lightAdjustment:o.lightAdjustment,lightAdjustmentProcessor:o.lightAdjustmentProcessor,mediaProcessorsNoiseSuppression:o.mediaProcessorsNoiseSuppression,mediaType:o.mediaType,micDevice:o.micDevice,noiseSuppression:o.noiseSuppression,noiseSuppressionProcessor:o.noiseSuppressionProcessor,resizeMode:o.resizeMode,resolution:o.resolution,video:o.video,videoContentHint:o.videoContentHint,videoInput:o.videoInput,videoTrack:o.videoTrack,virtualBackgroundProcessor:o.virtualBackgroundProcessor},[a,r]=await J(t,i).catch(c=>{throw t(d.actions.setSoraErrorAlertMessage(c.toString())),c});a.getVideoTracks().length>0&&(o.soraContents.sora&&o.soraContents.connectionStatus==="connected"&&o.soraContents.localMediaStream?o.soraContents.sora.replaceVideoTrack(o.soraContents.localMediaStream,a.getVideoTracks()[0]):o.soraContents.localMediaStream&&(o.soraContents.localMediaStream.getVideoTracks().filter(c=>{c.enabled=!1,c.stop(),o.soraContents.localMediaStream?.removeTrack(c)}),o.soraContents.localMediaStream.addTrack(a.getVideoTracks()[0])),t(d.actions.setFakeContentsGainNode(r)))}else if(o.soraContents.sora&&o.soraContents.connectionStatus==="connected"&&o.soraContents.localMediaStream){const i=Le(o.lightAdjustmentProcessor,o.virtualBackgroundProcessor);await _e(t,o.soraContents.localMediaStream,i),o.soraContents.sora.stopVideoTrack(o.soraContents.localMediaStream)}else if(o.soraContents.localMediaStream){const i=Le(o.lightAdjustmentProcessor,o.virtualBackgroundProcessor);await _e(t,o.soraContents.localMediaStream,i)}t(d.actions.setCameraDevice(e))},Le=(e,t)=>{let n;return e?.isProcessing()&&(n=e.getOriginalTrack(),e.stopProcessing()),t?.isProcessing()&&(n===void 0&&(n=t.getOriginalTrack()),t.stopProcessing()),n},_e=async(e,t,n)=>{if(n!==void 0)n.enabled=!1,await new Promise(o=>setTimeout(o,100)),n.stop(),t?.removeTrack(n),e(d.actions.setTimelineMessage(M("stop",n)));else{if(!t)return;t.getVideoTracks().filter(o=>{o.enabled=!1}),await new Promise(o=>setTimeout(o,100)),t.getVideoTracks().filter(o=>{o.stop(),t.removeTrack(o),e(d.actions.setTimelineMessage(M("stop",o)))})}},$e=(e,t,n)=>{if(n?.isProcessing()){const o=n.getOriginalTrack();o&&(o.stop(),t?.removeTrack(o),e(d.actions.setTimelineMessage(M("stop",o)))),n.stopProcessing()}else t&&t.getAudioTracks().filter(o=>{o.stop(),t.removeTrack(o),e(d.actions.setTimelineMessage(M("stop",o)))})},{clearDataChannelMessages:vs,deleteAlertMessage:bs,setAPIErrorAlertMessage:E,setAPIInfoAlertMessage:H,setAspectRatio:ys,setAudio:Rs,setAudioBitRate:Ts,setAudioCodecType:Ns,setAudioContentHint:ks,setAudioInput:Is,setAudioOutput:Ms,setAudioTrack:ws,setAutoGainControl:Ps,setBlurRadius:As,setBundleId:Ds,setChannelId:Fs,setClientId:Vs,setDataChannels:dt,setDataChannelSignaling:Os,setDebug:zt,setDebugFilterText:Es,setDebugType:Hs,setDisplayResolution:Jt,setEchoCancellation:Bs,setEchoCancellationType:Us,setEnabledBundleId:Ls,setEnabledClientId:_s,setEnabledDataChannels:$s,setEnabledDataChannel:Gs,setEnabledForwardingFilter:zs,setEnabledMetadata:Js,setEnabledSignalingNotifyMetadata:Ws,setEnabledSignalingUrlCandidates:qs,setEnabledVideoVP9Params:Ks,setEnabledVideoH264Params:Ys,setEnabledVideoH265Params:Zs,setEnabledVideoAV1Params:Qs,setAudioStreamingLanguageCode:Xs,setEnabledAudioStreamingLanguageCode:ea,setFakeVolume:ta,setFacingMode:na,setFrameRate:Wt,setIgnoreDisconnectWebSocket:oa,setLightAdjustment:sa,setLocalMediaStream:Fc,setLogMessages:Vc,setMediaProcessorsNoiseSuppression:aa,setMediaStats:ia,setMediaType:ra,setMetadata:ca,setMultistream:la,setNoiseSuppression:da,setNotifyMessages:Oc,setReconnect:ua,setResizeMode:ma,setRole:ga,setResolution:qt,setSignalingNotifyMetadata:pa,setSignalingUrlCandidates:fa,setForwardingFilter:ha,setSimulcast:Ca,setSimulcastRid:xa,setSora:Ec,setSoraReconnecting:Sa,setSoraErrorAlertMessage:Hc,setSoraInfoAlertMessage:Bc,setSpotlight:ja,setSpotlightFocusRid:va,setSpotlightNumber:ba,setSpotlightUnfocusRid:ya,setVideo:Ra,setVideoBitRate:Ta,setVideoCodecType:Na,setVideoContentHint:ka,setVideoInput:Ia,setVideoTrack:Ma,setVideoVP9Params:wa,setVideoH264Params:Pa,setVideoH265Params:Aa,setVideoAV1Params:Da}=d.actions,p=()=>mn(),l=gn,et=()=>s.jsxs("svg",{width:"1em",height:"1em",viewBox:"0 0 16 16",className:"bi bi-clipboard",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",children:[s.jsx("title",{children:"ClipboardIcon"}),s.jsx("path",{fillRule:"evenodd",d:"M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"}),s.jsx("path",{fillRule:"evenodd",d:"M9.5 1h-3a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"})]}),Fa=e=>{const t=n=>{ge(e.text),n.currentTarget.blur()};return e.disabled?s.jsx("div",{style:{height:"31px"}}):s.jsx("button",{type:"button",className:"btn btn-sm btn-dark",onClick:t,children:s.jsx(et,{})})},Va=e=>{const{description:t}=e;return t===void 0?null:typeof t!="object"?s.jsx("div",{className:"debug-message",children:s.jsx("div",{className:"col-sm-12",children:s.jsx("pre",{className:e.wordBreak?"word-break":"",children:t})})}):s.jsx("div",{className:"debug-message",children:s.jsx("div",{className:"col-sm-12",children:s.jsx("pre",{className:e.wordBreak?"word-break":"",children:JSON.stringify(t,null,2)})})})},U=e=>{const{defaultShow:t,description:n,title:o,timestamp:i,label:a}=e,[r,c]=v.useState(t===void 0?!1:t),u=i?o+i:o,m=n===void 0;return s.jsxs("div",{className:"border border-light rounded mb-1 bg-dark","data-title":o,children:[s.jsxs("div",{className:"d-flex justify-content-between align-items-center text-break",children:[s.jsxs("a",{className:`debug-title ${m?"disabled":""}`,onClick:()=>c(!r),"aria-controls":u,"aria-expanded":r,children:[s.jsx("i",{className:`${r?"arrow-bottom":"arrow-right"} ${m?"disabled":""}`})," ",i?s.jsxs("span",{className:"text-white-50 me-1",children:["[",Et(i),"]"]}):null,a,s.jsx("span",{children:o})]}),s.jsx("div",{className:"border-left",children:s.jsx(Fa,{text:typeof n=="string"?n:JSON.stringify(n,null,2),disabled:m})})]}),s.jsx(le,{in:r,children:s.jsx("div",{className:"border-top",children:s.jsx(Va,{description:n,wordBreak:e.wordBreak})})})]})},Oa=({title:e,codecs:t})=>s.jsx(U,{title:e,timestamp:null,description:JSON.stringify(t,null,2)}),ne=O.memo(e=>s.jsx(Oa,{...e})),oe=(e,t)=>{if(!e)return[];const n=e(t);return!n||!n.codecs?[]:n.codecs},Ea=()=>{const e=oe(RTCRtpSender.getCapabilities,"audio"),t=oe(RTCRtpSender.getCapabilities,"video"),n=oe(RTCRtpReceiver.getCapabilities,"audio"),o=oe(RTCRtpReceiver.getCapabilities,"video");return s.jsxs("div",{className:"capabilities-codec",children:[s.jsx(ne,{title:"Audio RTCRtpSender CapabilitiesCodec",codecs:e}),s.jsx(ne,{title:"Video RTCRtpSender CapabilitiesCodec",codecs:t}),s.jsx(ne,{title:"Audio RTCRtpReceiver CapabilitiesCodec",codecs:n}),s.jsx(ne,{title:"Video RTCRtpReceiver CapabilitiesCodec",codecs:o})]})},Ha=()=>{const e=p(),t=()=>{e(vs())};return s.jsx("input",{className:"btn btn-secondary",type:"button",name:"clear",defaultValue:"clear",onClick:t})},Ba=e=>{const{data:t,label:n,timestamp:o}=e;if(new TextDecoder().decode(t.slice(0,6))==="ZAKURO"){const c=new TextDecoder().decode(t.slice(22,48)),u=new DataView(t),m=u.getBigInt64(6),g=u.getBigInt64(14),S=t.byteLength,C=`connectionId: ${c}
UnixTimeMicro: ${m}
Counter: ${g}
ByteLength: ${S}`;return s.jsx(U,{title:`${n} ZAKURO`,timestamp:o,description:C,defaultShow:!0,wordBreak:!0})}const r=`${new Uint8Array(t).toString()}
(${new TextDecoder().decode(t)})`;return s.jsx(U,{title:n,timestamp:o,description:r,defaultShow:!0,wordBreak:!0})},Ua=O.memo(e=>s.jsx(Ba,{...e})),La=()=>{const e=l(t=>t.dataChannelMessages);return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"py-1",children:s.jsx(Ha,{})}),s.jsx("div",{className:"debug-messages",children:e.map(t=>{const n=t.label+t.timestamp;return s.jsx(Ua,{...t},n)})})]})},W=()=>{const e=l(o=>o.debugFilterText),t=p(),n=o=>{t(Es(o.target.value))};return s.jsxs(h,{className:"form-inline debug-filter",controlId:"channelId",children:[s.jsx(Q,{className:"text-white",children:"Filter:"}),s.jsx(G,{type:"text",placeholder:"Filter",value:e,onChange:n,autoComplete:"off"})]})},_a=e=>{const{message:t,timestamp:n}=e;return s.jsx(U,{title:t.title,timestamp:n,description:JSON.parse(t.description)})},$a=O.memo(e=>s.jsx(_a,{...e})),Ga=()=>{const e=l(o=>o.logMessages),t=l(o=>o.debugFilterText),n=e.filter(o=>t.split(" ").every(i=>i===""?!0:0<=JSON.stringify(o).indexOf(i)));return s.jsx("div",{className:"debug-messages",children:n.map((o,i)=>s.jsx($a,{...o},o.message.title+String(i)+o.timestamp))})},ut={websocket:"#00ff00",datachannel:"#ff00ff"},za=e=>{const{text:t}=e,n=Object.keys(ut).includes(t)?ut[t]:void 0;return s.jsxs("span",{className:"me-1",style:n?{color:n}:{},children:["[",t,"]"]})},Ja=e=>{const{notify:t}=e,n=t.transportType?s.jsx(za,{text:t.transportType}):null;return s.jsx(U,{title:t.message.event_type,timestamp:t.timestamp,description:t.message,label:n})},Wa=O.memo(e=>s.jsx(Ja,{...e})),qa=()=>{const e=l(o=>o.notifyMessages),t=l(o=>o.debugFilterText),n=e.filter(o=>t.split(" ").every(i=>i===""?!0:0<=JSON.stringify(o).indexOf(i)));return s.jsx("div",{className:"debug-messages",children:n.map(o=>s.jsx(Wa,{notify:o},o.message.type+o.timestamp))})},mt={websocket:"#00ff00",datachannel:"#ff00ff"},Ka=e=>{const{text:t}=e,n=Object.keys(mt).includes(t)?mt[t]:void 0;return s.jsxs("span",{style:n?{color:n}:{},children:["[",t,"]"]})},Ya=e=>{const{push:t}=e,n=t.transportType?s.jsx(Ka,{text:t.transportType}):null;return s.jsx(U,{title:t.message.type,timestamp:t.timestamp,description:t.message,label:n})},Za=O.memo(e=>s.jsx(Ya,{...e})),Qa=()=>{const e=l(o=>o.pushMessages),t=l(o=>o.debugFilterText),n=e.filter(o=>t.split(" ").every(i=>i===""?!0:0<=JSON.stringify(o).indexOf(i)));return s.jsx("div",{className:"debug-messages",children:n.map((o,i)=>{const a=`${o.timestamp}-${i}`;return s.jsx(Za,{ariaControls:a,push:o},a)})})},Xa=()=>{const e=v.useRef(null),t=v.useRef(null),n=l(r=>r.soraContents.sora),o=l(r=>r.soraContents.connectionStatus),i=l(r=>r.soraContents.datachannels),a=()=>{if(e.current===null||t.current===null)return;const r=e.current.value;n&&o==="connected"&&n.sendMessage(r,new TextEncoder().encode(t.current.value))};return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"d-flex mt-2",children:[s.jsx(h,{className:"me-1",controlId:"sendDataChannelMessageLabel",children:s.jsx(R,{name:"sendDataChannelMessageLabel",ref:e,children:i.map(r=>s.jsx("option",{value:r.label,children:r.label},r.label))})}),s.jsx(h,{className:"flex-grow-1 me-1",controlId:"sendDataChannelMessage",children:s.jsx(G,{className:"flex-fill",placeholder:"sendDataChannelMessageを指定",type:"text",ref:t})}),s.jsx(ze,{variant:"secondary",onClick:a,disabled:i.length===0,children:"send"})]}),0<i.length?s.jsx("pre",{className:"form-control mt-2",style:{color:"#fff",backgroundColor:"#222222",maxHeight:"250px",minHeight:"250px"},children:JSON.stringify(i,null,2)}):null]})},gt={websocket:"#00ff00",datachannel:"#ff00ff"},ei=e=>{const{text:t}=e,n=Object.keys(gt).includes(t)?gt[t]:void 0;return s.jsxs("span",{className:"me-1",style:n?{color:n}:{},children:["[",t,"]"]})},ti=e=>{const{data:t,type:n,timestamp:o,transportType:i}=e,a=i?s.jsx(ei,{text:i}):null;return s.jsx(U,{title:n,timestamp:o,description:t,label:a})},ni=O.memo(e=>s.jsx(ti,{...e})),oi=()=>{const e=l(o=>o.signalingMessages),t=l(o=>o.debugFilterText),n=e.filter(o=>t.split(" ").every(i=>i===""?!0:0<=JSON.stringify(o).indexOf(i)));return s.jsx("div",{className:"debug-messages",children:n.map(o=>{const i=o.type+o.timestamp;return s.jsx(ni,{...o},i)})})},si=e=>s.jsx(U,{title:`${e.id}(${e.type})`,timestamp:null,description:e}),ai=O.memo(e=>s.jsx(si,{...e})),ii=()=>{const e=l(o=>o.soraContents.statsReport),t=l(o=>o.debugFilterText),n=e.filter(o=>t.split(" ").every(i=>i===""?!0:0<=JSON.stringify(o).indexOf(i)));return s.jsx("div",{className:"debug-messages",children:n.map(o=>s.jsx(ai,{...o},o.id))})},pt={signaling:"#ff00ff",notify:"#ffff00",push:"#98fb98",stats:"#ffc0cb"},ri=()=>s.jsx("span",{className:"me-1",style:{color:"#00ff00"},children:"[websocket]"}),ci=()=>s.jsx("span",{className:"me-1",style:{color:"#ff8c00"},children:"[peerconnection]"}),li=()=>s.jsx("span",{className:"me-1",style:{color:"#bce2e8"},children:"[sora]"}),di=()=>s.jsx("span",{className:"me-1",style:{color:"#73b8e2"},children:"[sora-devtools]"}),ui=e=>{const{label:t,id:n}=e,o=t&&Object.keys(pt).includes(t)?pt[t]:void 0;return s.jsxs("span",{className:"me-1",style:o?{color:o}:{},children:["[datachannel]",t?`[${t}]`:"",typeof n=="number"?`[${n}]`:""]})},mi=e=>{const{timestamp:t,logType:n,dataChannelId:o,dataChannelLabel:i,type:a,data:r}=e,c=`${a}`;let u;return n==="websocket"?u=s.jsx(ri,{}):n==="datachannel"?u=s.jsx(ui,{id:o,label:i}):n==="peerconnection"?u=s.jsx(ci,{}):n==="sora"?u=s.jsx(li,{}):n==="sora-devtools"&&(u=s.jsx(di,{})),s.jsx(U,{title:c,timestamp:t,description:r,label:u})},gi=O.memo(e=>s.jsx(mi,{...e})),pi=()=>{const e=l(o=>o.timelineMessages),t=l(o=>o.debugFilterText),n=e.filter(o=>t.split(" ").every(i=>i===""?!0:0<=JSON.stringify(o).indexOf(i)));return s.jsx("div",{className:"debug-messages",children:n.map(o=>{let i=`${o.timestamp}-${o.type}`;return o.dataChannelLabel&&(i+=`-${o.dataChannelLabel}`),s.jsx(gi,{...o},i)})})},fi=()=>{const e=l(i=>i.debug),t=l(i=>i.debugType),n=p();if(!e)return null;const o=i=>{(i==="log"||i==="notify"||i==="push"||i==="stats"||i==="timeline"||i==="signaling"||i==="messaging"||i==="codec")&&n(Hs(i))};return s.jsx("div",{className:"col-debug col-6",children:s.jsxs(pn,{id:"debug-tab",activeKey:t,defaultActiveKey:"timeline",onSelect:o,children:[s.jsxs(_,{eventKey:"timeline",title:"Timeline",children:[s.jsx(W,{}),s.jsx(pi,{})]}),s.jsxs(_,{eventKey:"signaling",title:"Signaling",children:[s.jsx(W,{}),s.jsx(oi,{})]}),s.jsxs(_,{eventKey:"notify",title:"Notfiy",children:[s.jsx(W,{}),s.jsx(qa,{})]}),s.jsxs(_,{eventKey:"push",title:"Push",children:[s.jsx(W,{}),s.jsx(Qa,{})]}),s.jsxs(_,{eventKey:"stats",title:"Stats",children:[s.jsx(W,{}),s.jsx(ii,{})]}),s.jsxs(_,{eventKey:"log",title:"Log",children:[s.jsx(W,{}),s.jsx(Ga,{})]}),s.jsxs(_,{eventKey:"messaging",title:"Messaging",children:[s.jsx(Xa,{}),s.jsx(La,{})]}),s.jsx(_,{eventKey:"codec",title:"Codec",children:s.jsx(Ea,{})})]})})},hi=()=>{const e=p(),t=l(o=>o.soraContents.reconnectingTrials),n=()=>{e(Sa(!1))};return v.useEffect(()=>{e(Cs())},[e]),s.jsxs(q,{delay:2e4,onClose:n,children:[s.jsx(q.Header,{className:"bg-warning text-white",children:s.jsx("strong",{className:"me-auto",children:"Reconnect"})}),s.jsx(q.Body,{className:"bg-light",children:s.jsxs("p",{className:"text-break font-weight-bold mb-0",children:["Reconnecting... (trials ",t,")"]})})]})},Ci=e=>{const t=p(),n=()=>{t(bs(e.timestamp))},o=e.type==="error"?"bg-danger":"bg-info";return s.jsxs(q,{autohide:!0,delay:2e4,onClose:n,children:[s.jsxs(q.Header,{className:`${o} text-white`,children:[s.jsx("strong",{className:"me-auto",children:e.title}),s.jsx("span",{children:Et(e.timestamp)})]}),s.jsx(q.Body,{className:"bg-light",children:s.jsx("p",{className:"text-break font-weight-bold mb-0",children:e.message})})]})},xi=()=>{const e=l(n=>n.alertMessages),t=l(n=>n.soraContents.reconnecting);return s.jsxs("div",{className:"alert-messages",children:[t?s.jsx(hi,{}):null,e.map(n=>s.jsx(Ci,{...n},n.timestamp))]})},b=e=>{const t=Ot[e.kind];return t?s.jsx(bt,{placement:"top",overlay:s.jsx(ae,{id:"popover-basic",children:s.jsx(ae.Body,{style:{whiteSpace:"pre-wrap"},children:t.description})}),children:s.jsx(Q,{children:e.children})}):(console.warn(`Could not load description "${e.kind}"`),s.jsx(Q,{children:e.children}))},ft=e=>{const t=n=>{ge(e.text),n.currentTarget.blur()};return s.jsxs("div",{className:"d-flex align-items-center",children:[e.label?s.jsx("p",{children:e.label}):null,s.jsxs("div",{className:"d-flex align-items-center border border-secondary rounded mx-1",children:[s.jsx("p",{id:e.id,className:"mx-2 p-1",children:e.text}),s.jsx("div",{className:"border-left border-secondary",children:s.jsx("button",{type:"button",className:"btn btn-sm btn-light",onClick:t,children:s.jsx(et,{})})})]})]})},Kt=e=>{const{localVideo:t,connectionId:n,clientId:o}=e;return s.jsxs(s.Fragment,{children:[n?s.jsx(ft,{id:t?"local-video-connection-id":void 0,label:"connectionID:",text:n}):null,o!=null&&n!==o?s.jsx(ft,{id:t?"local-video-client-id":void 0,label:"clientID:",text:o}):null]})},Si=e=>{const t=l(r=>r.soraContents.statsReport),[n,o]=v.useState([]),[i,a]=v.useState(null);return v.useEffect(()=>{(async()=>{if(e.getVideoTracks().find(m=>m)===void 0)return;const c=t.filter(m=>{if(m.type==="outbound-rtp"&&m.kind==="video")return!0});if(c.length===0)return;const u=c.map(m=>{const g=m,S=t.find(C=>{if(C.type==="codec")return C.id===g.codecId});return S===void 0?{outboundRtpStats:g}:{codec:S,outboundRtpStats:g}});if(o(u.sort((m,g)=>m.outboundRtpStats.rid===void 0?1:g.outboundRtpStats.rid===void 0?-1:m.outboundRtpStats.rid.localeCompare(g.outboundRtpStats.rid))),i===null){const m=u.filter(g=>g.outboundRtpStats.frameWidth!==void 0).sort((g,S)=>g.outboundRtpStats.frameWidth===void 0?1:S.outboundRtpStats.frameWidth===void 0?-1:S.outboundRtpStats.frameWidth-g.outboundRtpStats.frameWidth);m.length>0&&a(m[0])}else{const m=u.find(g=>g.outboundRtpStats.rid===i.outboundRtpStats.rid);m!==void 0&&a(m)}})()},[t,e,i]),{trackStats:n,selected:i,setSelected:a}},ji=({stream:e})=>{const{trackStats:t,selected:n,setSelected:o}=Si(e);return s.jsx("div",{className:"video-overlay",children:t.length===0?s.jsx("p",{children:"loading..."}):s.jsxs(s.Fragment,{children:[t.length>1&&s.jsx("div",{className:"d-flex gap-2",children:t.map(i=>s.jsxs("div",{className:i.outboundRtpStats.rid===n?.outboundRtpStats.rid?"rid-selected":"rid",onClick:()=>o(i),onKeyDown:()=>o(i),children:["[",i.outboundRtpStats.rid,"]"]},i.outboundRtpStats.rid))}),n&&s.jsxs("table",{className:"table-video-capabilities",children:[s.jsxs("tr",{children:[s.jsx("th",{children:"mimeType"}),s.jsx("td",{children:n.codec?.mimeType})]}),s.jsxs("tr",{children:[s.jsx("th",{children:"payloadType"}),s.jsx("td",{children:n.codec?.payloadType})]}),s.jsxs("tr",{children:[s.jsx("th",{children:"sdpFmtpLine"}),s.jsx("td",{children:n.codec?.sdpFmtpLine})]}),s.jsxs("tr",{children:[s.jsx("th",{children:"resolution"}),s.jsxs("td",{children:[n.outboundRtpStats.frameWidth,"x",n.outboundRtpStats.frameHeight]})]}),s.jsxs("tr",{children:[s.jsx("th",{children:"fps"}),s.jsx("td",{children:n.outboundRtpStats.framesPerSecond!==void 0?Math.floor(n.outboundRtpStats.framesPerSecond):void 0})]})]})]})})};async function Z(e,t,n,o){const i=window.location.protocol,a=i==="https:"?"443":"3000",r=i==="https:"?"api":"";let c=`${i}//${window.location.hostname}:${a}/${r}`;e!==null&&(c=e);const u=`Sora_${t}.${n}`,m=await fetch(c,{method:"POST",body:JSON.stringify(o),headers:{Accept:"application/json","Content-Type":"application/json","x-sora-target":u},mode:"cors"}),g=await m.json();if(!m.ok){let S=`POST ${c} ${m.status} (${m.statusText}) target:${u}`;throw g.error_type&&(S+=` error_type: ${g.error_type}`),new Error(S)}return g}function vi(e,t){return Z(e,"20231220","StartRecording",{channel_id:t,expire_time:3600})}function bi(e,t){return Z(e,"20231220","StopRecording",{channel_id:t})}function Yt(e,t,n,o,i){const a={channel_id:t,recv_connection_id:n,rid:o};return i&&(a.send_connection_id=i),Z(e,"20201005","RequestRtpStream",a)}function Zt(e,t,n,o){const i={channel_id:t,recv_connection_id:n};return o&&(i.send_connection_id=o),Z(e,"20201005","ResetRtpStream",i)}function Qt(e,t,n,o,i,a){const r={channel_id:t,recv_connection_id:n,spotlight_focus_rid:o,spotlight_unfocus_rid:i};return a&&(r.send_connection_id=a),Z(e,"20211215","RequestSpotlightRid",r)}function Xt(e,t,n,o){const i={channel_id:t,recv_connection_id:n};return o&&(i.send_connection_id=o),Z(e,"20211215","ResetSpotlightRid",i)}const fe=e=>{const t=l(r=>r.soraContents.sora),n=l(r=>r.apiUrl),o=l(r=>r.channelId),i=p(),a=async()=>{if(t?.connectionId)try{const r=await Yt(n,o,t.connectionId,e.rid);i(H(`POST successed. response: ${JSON.stringify(r)}`))}catch(r){r instanceof Error&&i(E(r.message))}};return s.jsx("div",{className:"mx-1",children:s.jsx("input",{className:"btn btn-secondary",type:"button",name:`requestSimulcastRidTo${e.rid.charAt(0).toUpperCase()+e.rid.slice(1)}`,defaultValue:`${e.rid} rid`,onClick:a})})},yi=()=>{const e=v.useRef(null),t=v.useRef(null),n=l(c=>c.soraContents.sora),o=l(c=>c.channelId),i=l(c=>c.apiUrl),a=p();if(!n?.connectionId)return null;const r=async()=>{if(!n?.connectionId||e.current===null||t.current===null)return;const c=e.current.value,u=t.current.value;try{const m=await Qt(i,o,n.connectionId,c,u);a(H(`POST successed. response: ${JSON.stringify(m)}`))}catch(m){m instanceof Error&&a(E(m.message))}};return s.jsx("div",{className:"mx-1",children:s.jsxs(h,{className:"form-inline",children:[s.jsx(R,{ref:e,children:V.map(c=>c===""?null:s.jsxs("option",{value:c,children:["SpotlightFocusRid: ",c]},c))}),s.jsx(R,{ref:t,children:V.map(c=>c===""?null:s.jsxs("option",{value:c,children:["SpotlightUnfocusRid: ",c,"   "]},c))}),s.jsx("input",{className:"btn btn-secondary",type:"button",name:"requestSpotlightRid",defaultValue:"requestSpotlightRid",onClick:r})]})})},Ri=()=>{const e=l(a=>a.soraContents.sora),t=l(a=>a.channelId),n=l(a=>a.apiUrl),o=p(),i=async()=>{if(e?.connectionId)try{const a=await Zt(n,t,e.connectionId);o(H(`POST successed. response: ${JSON.stringify(a)}`))}catch(a){a instanceof Error&&o(E(a.message))}};return s.jsx("div",{className:"mx-1",children:s.jsx("input",{className:"btn btn-secondary",type:"button",name:"resetAllSimulcastRid",defaultValue:"reset rid",onClick:i})})},Ti=()=>{const e=l(a=>a.soraContents.sora),t=l(a=>a.channelId),n=l(a=>a.apiUrl),o=p(),i=async()=>{if(e?.connectionId)try{const a=await Xt(n,t,e.connectionId);o(H(`POST successed. response: ${JSON.stringify(a)}`))}catch(a){a instanceof Error&&o(E(a.message))}};return s.jsx("div",{className:"mx-1",children:s.jsx("input",{className:"btn btn-secondary",type:"button",name:"resetAllSpotlightRid",defaultValue:"resetSpotlightRid",onClick:i})})},Ni=e=>{const t=n=>{ge(e.text),n.currentTarget.blur()};return s.jsxs("div",{className:"d-flex align-items-center",children:[s.jsx("p",{children:"sessionID:"}),s.jsxs("div",{className:"d-flex align-items-center border border-secondary rounded mx-1",children:[s.jsx("p",{id:e.id,className:"mx-2 p-1",children:e.text}),s.jsx("div",{className:"border-left border-secondary",children:s.jsx("button",{type:"button",className:"btn btn-sm btn-light",onClick:t,children:s.jsx(et,{})})})]})]})},ki=e=>{const{sessionId:t}=e;return s.jsx(Ni,{id:"session-id",text:t})},Ii=e=>{const{displayResolution:t,stream:n,mute:o,audioOutput:i,setHeight:a}=e,r=v.useRef(null),c=pe(t);return v.useEffect(()=>{const u=new ResizeObserver(m=>{m.filter(g=>{a(g.contentRect.height)})});return r.current&&(i&&n&&n.getAudioTracks().length>0&&r.current.setSinkId(i),u.observe(r.current)),()=>{u.disconnect()}},[a,i,n]),v.useEffect(()=>{r.current&&o&&(r.current.muted=!0)},[o]),v.useEffect(()=>{if(r.current&&n){let u;n.getVideoTracks().filter(m=>{u=m.enabled,m.enabled=!1}),r.current.onloadedmetadata=m=>{n.getVideoTracks().filter(g=>{u!==void 0&&(g.enabled=u)})},r.current.srcObject=n,i&&n.getAudioTracks().length>0&&r.current.setSinkId(i)}else r.current&&n===null&&(r.current.srcObject=null)},[n,i]),i&&r.current?.setSinkId&&n&&n.getAudioTracks().length>0&&r.current.setSinkId(i),s.jsx("video",{id:e.localVideo?"local-video":void 0,autoPlay:!0,playsInline:!0,controls:!0,muted:o,ref:r,width:0<c.width?c.width:void 0,height:0<c.height?c.height:void 0})},en=O.memo(e=>s.jsx(Ii,{...e})),X=25,ce=2.5,Y=10,ht="#CCCCCC",Mi="#000000";function Ge(e,t,n){e.beginPath(),e.fillStyle=t,e.fillRect(0,n,X,Y),e.closePath()}function tn(e,t){const n=Math.ceil(t/(Y+ce));let o=t-Y;Ge(e,ht,o);for(let i=0;i<n;i++)o=o-Y-ce,Ge(e,ht,o)}function wi(e,t,n){const o=t*n,i=Math.ceil(o/(Y+ce));for(let a=0;a<i;a++){const r=t-Y*(a+1)-ce*a;Ge(e,Mi,r)}}const Pi=e=>{const t=v.useRef(null);return v.useEffect(()=>{if(e.stream.getAudioTracks().length===0)return;const n=window.AudioContext||window.webkitAudioContext,o=new n,i=o.createMediaStreamSource(e.stream),a=o.createAnalyser();a.fftSize=2048;const r=a.frequencyBinCount,c=new Uint8Array(r);i.connect(a);let u=null;function m(){u=requestAnimationFrame(m),a.getByteTimeDomainData(c);const g=Array.from(c),S=Math.max.apply(null,g)-128,C=t.current;if(C===null)return;const y=C.getContext("2d");y!==null&&(y.clearRect(0,0,X,C.height),y.save(),tn(y,C.height),wi(y,C.height,S/128),y.restore())}return m(),()=>{o&&o.close(),u&&cancelAnimationFrame(u)}},[e.stream]),s.jsx("canvas",{width:X,height:e.height,className:"volume-visualizer",ref:t})},Ai=e=>{const t=v.useRef(null);return v.useEffect(()=>{const n=t.current;if(n===null)return;const o=n.getContext("2d");o!==null&&(o.clearRect(0,0,X,n.height),o.save(),tn(o,n.height),o.restore())},[]),s.jsx("canvas",{width:X,height:e.height,className:"volume-visualizer",ref:t})},nn=O.memo(e=>e.micDevice&&0<e.stream.getAudioTracks().length?s.jsx(Pi,{...e}):s.jsx(Ai,{...e})),Di=()=>{const[e,t]=v.useState(0),n=l(C=>C.audio),o=l(C=>C.video),i=l(C=>C.audioOutput),a=l(C=>C.displayResolution),r=l(C=>C.focusedSpotlightConnectionIds),c=l(C=>C.soraContents.connectionId),u=l(C=>C.soraContents.localMediaStream),m=l(C=>C.micDevice),g=c&&r[c],S=l(C=>C.mediaStats);return n===!1&&o===!1?null:s.jsx(s.Fragment,{children:s.jsx("div",{className:"d-flex",children:s.jsxs("div",{className:`position-relative d-flex flex-nowrap align-items-start video-wrapper overflow-y-hidden${g?" spotlight-focused":""}`,children:[S&&u&&u.getVideoTracks().length>0&&s.jsx(ji,{stream:u}),s.jsx(en,{stream:u,setHeight:t,audioOutput:i,displayResolution:a,localVideo:!0,mute:!0}),u!==null?s.jsx(nn,{micDevice:m,stream:u,height:e}):null]})})})},Fi=()=>{const e=l(c=>c.soraContents.connectionId),t=l(c=>c.soraContents.clientId),n=l(c=>c.soraContents.sessionId),o=l(c=>c.simulcast),i=l(c=>c.spotlight),a=l(c=>c.role),r=l(c=>c.soraContents.localMediaStream);return s.jsx("div",{className:"row my-1",children:s.jsxs("div",{className:"col-auto",children:[s.jsxs("div",{className:"video-status mb-1",children:[n!==null?s.jsx("div",{className:"d-flex align-items-center mb-1 video-status-inner",children:s.jsx(ki,{sessionId:n})}):null,e!==null||t!==null?s.jsx("div",{className:"d-flex align-items-center mb-1 video-status-inner",children:s.jsx(Kt,{connectionId:e,clientId:t,localVideo:!0})}):null,e!==null&&i!=="true"&&o==="true"&&a!=="sendonly"?s.jsxs("div",{className:"d-flex align-items-center mb-1 video-status-inner",children:[s.jsx(b,{kind:"changeAllRecvStream",children:"change all:"}),s.jsx(fe,{rid:"r0"}),s.jsx(fe,{rid:"r1"}),s.jsx(fe,{rid:"r2"}),s.jsx(Ri,{})]}):null,e!==null&&i==="true"?s.jsxs("div",{className:"d-flex align-items-center mb-1 video-status-inner",children:[s.jsx(yi,{}),s.jsx(Ti,{})]}):null]}),r!==null&&a!=="recvonly"?s.jsx(Di,{}):null]})})};function Ct(e,t,n){if(t===null)return;let o=[];return n==="video"?o=t.getVideoTracks().map(a=>a.id):n==="audio"&&(o=t.getAudioTracks().map(a=>a.id)),e.find(a=>{if(a.type!=="inbound-rtp"||!("kind"in a)||!("trackIdentifier"in a))return!1;const r=a;return!(r.kind!==n||!o.includes(r.trackIdentifier))})}const xt=e=>{const t=l(m=>m.soraContents.statsReport),n=l(m=>m.soraContents.prevStatsReport),o=Ct(t,e.stream,e.type),i=Ct(n,e.stream,e.type);if(o===void 0||o.jitterBufferDelay===void 0||o.jitterBufferEmittedCount===void 0)return null;let a=o.jitterBufferDelay,r=o.jitterBufferEmittedCount;i!==void 0&&i.jitterBufferDelay!==void 0&&i.jitterBufferEmittedCount!==void 0&&(a=o.jitterBufferDelay-i.jitterBufferDelay,r=o.jitterBufferEmittedCount-i.jitterBufferEmittedCount);const c=Math.floor(a/r*1e3);let u="normal-jitter-buffer";return 500<c?u="critical-jitter-buffer":300<c?u="danger-jitter-buffer":100<c&&(u="warning-jitter-buffer"),s.jsx("div",{className:`btn btn-sm mx-1 ${u}`,children:s.jsxs("span",{children:[e.type,": ",c]})})},Vi=e=>{const t=l(a=>a.soraContents.statsReport),n=l(a=>a.soraContents),[o,i]=v.useState(null);return v.useEffect(()=>{(async()=>{if(!n.sora?.pc)return;const a=e.getVideoTracks().find(g=>g);if(a===void 0)return;const r=await n.sora.pc.getReceivers().find(g=>g.track.id===a.id);if(r===void 0)return;let c;const u=await r.getStats();for(const g of u){const[S,C]=g;if(C.codecId){c=C.codecId;break}}if(c===void 0)return;let m;for(const g of t)if(g.type==="codec"){const S=g;c===S.id&&(m=S)}m&&i({codec:m,videoTrackStats:{width:a.getSettings().width,height:a.getSettings().height,frameRate:a.getSettings().frameRate!==void 0?Math.floor(a.getSettings().frameRate||0):void 0}})})()},[t,e,n]),{trackStats:o}},Oi=({stream:e})=>{const{trackStats:t}=Vi(e);return s.jsx("div",{className:"video-overlay",children:t===null?s.jsx("p",{children:"loading..."}):s.jsxs("table",{className:"table-video-capabilities",children:[s.jsxs("tr",{children:[s.jsx("th",{children:"mimeType"}),s.jsx("td",{children:t.codec.mimeType})]}),s.jsxs("tr",{children:[s.jsx("th",{children:"payloadType"}),s.jsx("td",{children:t.codec.payloadType})]}),s.jsxs("tr",{children:[s.jsx("th",{children:"sdpFmtpLine"}),s.jsx("td",{children:t.codec.sdpFmtpLine})]}),s.jsxs("tr",{children:[s.jsx("th",{children:"resolution"}),s.jsx("td",{children:t.videoTrackStats.width===void 0||t.videoTrackStats.height===void 0?"undefined":`${t.videoTrackStats.width}x${t.videoTrackStats.height}`})]}),s.jsxs("tr",{children:[s.jsx("th",{children:"fps"}),s.jsx("td",{children:t.videoTrackStats.frameRate===void 0?"undefined":t.videoTrackStats.frameRate})]})]})})},he=e=>{const t=l(r=>r.soraContents.sora),n=l(r=>r.apiUrl),o=l(r=>r.channelId),i=p(),a=async()=>{if(t?.connectionId)try{const r=await Yt(n,o,t.connectionId,e.rid,e.sendConnectionId);i(H(`POST successed. response: ${JSON.stringify(r)}`))}catch(r){r instanceof Error&&i(E(r.message))}};return s.jsx("input",{className:"btn btn-secondary btn-sm mx-1",type:"button",name:`requestSimulcastRidTo${e.rid.charAt(0).toUpperCase()+e.rid.slice(1)}`,defaultValue:`${e.rid} rid`,onClick:a})},Ei=e=>{const t=v.useRef(null),n=v.useRef(null),o=l(u=>u.soraContents.sora),i=l(u=>u.channelId),a=l(u=>u.apiUrl),r=p();if(!o?.connectionId)return null;const c=async()=>{if(!o?.connectionId||t.current===null||n.current===null)return;const u=t.current.value,m=n.current.value;try{const g=await Qt(a,i,o.connectionId,u,m,e.sendConnectionId);r(H(`POST successed. response: ${JSON.stringify(g)}`))}catch(g){g instanceof Error&&r(E(g.message))}};return s.jsx("div",{className:"mx-1",children:s.jsxs(h,{className:"form-inline",children:[s.jsx(R,{ref:t,children:V.map(u=>u===""?null:s.jsxs("option",{value:u,children:["SpotlightFocusRid: ",u]},u))}),s.jsx(R,{ref:n,children:V.map(u=>u===""?null:s.jsxs("option",{value:u,children:["SpotlightUnfocusRid: ",u,"   "]},u))}),s.jsx("input",{className:"btn btn-secondary",type:"button",name:"requestSpotlightRidBySendConnectionId",defaultValue:"requestSpotlightRid",onClick:c})]})})},Hi=e=>{const t=l(r=>r.soraContents.sora),n=l(r=>r.channelId),o=l(r=>r.apiUrl),i=p(),a=async()=>{if(t?.connectionId)try{const r=await Zt(o,n,t.connectionId,e.sendConnectionId);i(H(`POST successed. response: ${JSON.stringify(r)}`))}catch(r){r instanceof Error&&i(E(r.message))}};return s.jsx("input",{className:"btn btn-secondary btn-sm mx-1",type:"button",name:"resetRtpStream",defaultValue:"reset rid",onClick:a})},Bi=e=>{const t=l(r=>r.soraContents.sora),n=l(r=>r.channelId),o=l(r=>r.apiUrl),i=p(),a=async()=>{if(t?.connectionId)try{const r=await Xt(o,n,t.connectionId,e.sendConnectionId);i(H(`POST successed. response: ${JSON.stringify(r)}`))}catch(r){r instanceof Error&&i(E(r.message))}};return s.jsx("input",{className:"btn btn-secondary mx-1",type:"button",name:"resetSpotlightRid",defaultValue:"resetSpotlightRid",onClick:a})};function St(e,t){if(t===null)return[];const n=t.getTracks().map(i=>i.id),o=[];for(const i of e)if(!(i.id&&!i.id.match(/^RTCMediaStreamTrack/))&&"trackIdentifier"in i){const a=i;a.trackIdentifier&&n.includes(a.trackIdentifier)&&o.push(a)}return o}const Ui=e=>{const t=l(r=>r.showStats),n=l(r=>r.soraContents.statsReport),o=l(r=>r.soraContents.prevStatsReport);if(!t)return null;const i=St(n,e.stream),a=St(o,e.stream);return s.jsx(s.Fragment,{children:i.map(r=>{let c=0,u=0;const m=a.find(g=>r.id===g.id);return m&&(c=r.jitterBufferDelay-m.jitterBufferDelay,u=r.jitterBufferEmittedCount-m.jitterBufferEmittedCount),s.jsx("div",{children:s.jsxs("ul",{className:"mediastream-stats-report",children:[Object.entries(r).map(([g,S])=>s.jsxs("li",{children:[s.jsxs("strong",{children:[g,":"]})," ",S]},g)),s.jsxs("li",{children:[s.jsx("strong",{children:"[jitterBufferDelay/jitterBufferEmittedCount_in_ms]"})," ",Math.floor(c/u*1e3)]})]})},r.id)})})},Li=({client:e})=>{const{mediaStream:t,connectionId:n,clientId:o}=e,[i,a]=v.useState(0),r=l(N=>N.audioOutput),c=l(N=>N.displayResolution),u=l(N=>N.focusedSpotlightConnectionIds),m=l(N=>N.multistream),g=l(N=>N.mute),S=l(N=>N.simulcast),C=l(N=>N.spotlight),y=n&&u[n],x=l(N=>N.mediaStats);return s.jsxs("div",{className:"col-auto",children:[s.jsxs("div",{className:"video-status",children:[s.jsxs("div",{className:"d-flex align-items-center mb-1 video-status-inner",children:[s.jsx(Kt,{connectionId:n,clientId:o}),s.jsx(xt,{type:"audio",stream:t}),s.jsx(xt,{type:"video",stream:t})]}),s.jsxs("div",{className:"d-flex align-items-center mb-1 video-status-inner",children:[C!=="true"&&m==="true"&&S==="true"?s.jsxs(s.Fragment,{children:[s.jsx(he,{rid:"r0",sendConnectionId:n}),s.jsx(he,{rid:"r1",sendConnectionId:n}),s.jsx(he,{rid:"r2",sendConnectionId:n}),s.jsx(Hi,{sendConnectionId:n})]}):null,C==="true"&&m==="true"&&S==="true"?s.jsxs(s.Fragment,{children:[s.jsx(Ei,{sendConnectionId:n}),s.jsx(Bi,{sendConnectionId:n})]}):null]})]}),s.jsxs("div",{className:"d-flex flex-wrap align-items-start overflow-y-hidden",children:[s.jsxs("div",{className:`position-relative d-flex flex-nowrap align-items-start video-wrapper${y?" spotlight-focused":""}`,children:[x&&t.getVideoTracks().length>0&&s.jsx(Oi,{stream:t}),s.jsx(en,{stream:t,setHeight:a,mute:g,audioOutput:r,displayResolution:c}),s.jsx(nn,{micDevice:!0,stream:t,height:i})]}),s.jsx(Ui,{stream:t})]})]})},_i=()=>{const e=l(t=>t.soraContents.remoteClients);return s.jsx("div",{className:"row my-2",children:e.map(t=>s.jsx(Li,{client:t},t.connectionId))})},$i=()=>{const e=l(o=>o.aspectRatio),t=p(),n=o=>{I(o.target.value,Ve)&&t(ys(o.target.value))};return s.jsxs(h,{className:"form-inline",controlId:"aspectRatio",children:[s.jsx(b,{kind:"aspectRatio",children:"aspectRatio:"}),s.jsx(R,{name:"aspectRatio",value:e,onChange:n,children:Ve.map(o=>s.jsx("option",{value:o,children:o===""?"未指定":o},o))})]})},Gi=()=>{const e=l(a=>a.audioBitRate),t=l(a=>a.soraContents.connectionStatus),n=T(t),o=p(),i=a=>{I(a.target.value,ye)&&o(Ts(a.target.value))};return s.jsxs(h,{className:"form-inline",controlId:"audioBitRate",children:[s.jsx(b,{kind:"audioBitRate",children:"audioBitRate:"}),s.jsx(R,{name:"audioBitRate",value:e,onChange:i,disabled:n,children:ye.map(a=>s.jsx("option",{value:a,children:a===""?"未指定":a},a))})]})},zi=()=>{const e=l(a=>a.audioCodecType),t=l(a=>a.soraContents.connectionStatus),n=T(t),o=p(),i=a=>{I(a.target.value,be)&&o(Ns(a.target.value))};return s.jsxs(h,{className:"form-inline",controlId:"audioCodecType",children:[s.jsx(b,{kind:"audioCodecType",children:"audioCodecType:"}),s.jsx(R,{name:"audioCodecType",value:e,onChange:i,disabled:n,children:be.map(a=>s.jsx("option",{value:a,children:a===""?"未指定":a},a))})]})},Ji=()=>{const e=l(o=>o.audioContentHint),t=p(),n=o=>{I(o.target.value,De)&&t(ks(o.target.value))};return s.jsxs(h,{className:"form-inline",controlId:"audioContentHint",children:[s.jsx(b,{kind:"audioContentHint",children:"audioContentHint:"}),s.jsx(R,{name:"audioContentHint",value:e,onChange:n,children:De.map(o=>s.jsx("option",{value:o,children:o===""?"未指定":o},o))})]})},w=e=>{const{children:t,kind:n,checked:o,onChange:i,disabled:a}=e,r=Ot[n];return r?s.jsxs(s.Fragment,{children:[s.jsx(Je,{type:"switch",checked:o,onChange:i,disabled:a}),s.jsx(bt,{placement:"top",overlay:s.jsx(ae,{id:"popover-basic",children:s.jsx(ae.Body,{style:{whiteSpace:"pre-wrap"},children:r.description})}),children:s.jsx(Q,{children:t})})]}):(console.warn(`Could not load description "${n}"`),s.jsx(Q,{children:t}))},Wi=()=>{const e=l(a=>a.audio),t=l(a=>a.soraContents.connectionStatus),n=T(t),o=p(),i=a=>{o(Rs(a.target.checked))};return s.jsx(h,{className:"form-inline",controlId:"audio",children:s.jsx(w,{kind:"audio",checked:e,onChange:i,disabled:n,children:"audio"})})},qi=()=>{const e=l(i=>i.audioInput),t=l(i=>i.audioInputDevices),n=p(),o=i=>{n(Is(i.target.value)),n(Xe())};return s.jsxs(h,{className:"form-inline",controlId:"audioInput",children:[s.jsx(b,{kind:"audioInput",children:"audioInput:"}),s.jsxs(R,{name:"audioInput",value:e,onChange:o,disabled:t.length===0,children:[s.jsx("option",{value:"",children:"未指定"}),t.map(i=>s.jsx("option",{value:i.deviceId,children:i.label},i.deviceId))]})]})},Ki=()=>{const e=l(i=>i.audioOutput),t=l(i=>i.audioOutputDevices),n=p(),o=i=>{n(Ms(i.target.value))};return s.jsxs(h,{className:"form-inline",controlId:"audioOutput",children:[s.jsx(b,{kind:"audioOutput",children:"audioOutput:"}),s.jsxs(R,{name:"audioOutput",value:e,onChange:o,disabled:t.length===0,children:[s.jsx("option",{value:"",children:"未指定"}),t.map(i=>s.jsx("option",{value:i.deviceId,children:i.label},i.deviceId))]})]})},Yi=()=>{const e=l(c=>c.enabledAudioStreamingLanguageCode),t=l(c=>c.audioStreamingLanguageCode),n=l(c=>c.soraContents.connectionStatus),o=T(n),i=p(),a=c=>{i(ea(c.target.checked))},r=c=>{i(Xs(c.target.value))};return s.jsxs(s.Fragment,{children:[s.jsx(j,{className:"form-row",children:s.jsx(f,{className:"col-auto",children:s.jsx(h,{className:"form-inline",controlId:"enabledAudioStreamingLanguageCode",children:s.jsx(w,{kind:"audioStreamingLanguageCode",checked:e,onChange:a,disabled:o,children:"audioStreamingLanguageCode"})})})}),e?s.jsx(j,{className:"form-row",children:s.jsx(f,{className:"col-auto",children:s.jsx(h,{className:"form-inline",controlId:"audioStreamingLanguageCode",children:s.jsx(G,{className:"flex-fill w-500",type:"text",placeholder:"audioStreamingLanguageCodeを指定",value:t,onChange:r,disabled:o})})})}):null]})},Zi=()=>{const e=l(o=>o.audioTrack),t=p(),n=o=>{t(ws(o.target.checked))};return s.jsx(h,{className:"form-inline",controlId:"audioTrack",children:s.jsx(w,{kind:"audioTrack",checked:e,onChange:n,disabled:!1,children:"Enable audio track"})})},Qi=()=>{const e=l(o=>o.autoGainControl),t=p(),n=o=>{I(o.target.value,Te)&&t(Ps(o.target.value))};return s.jsxs(h,{className:"form-inline",controlId:"autoGainControl",children:[s.jsx(b,{kind:"autoGainControl",children:"autoGainControl:"}),s.jsx(R,{name:"autoGainControl",value:e,onChange:n,children:Te.map(o=>s.jsx("option",{value:o,children:o===""?"未指定":o},o))})]})},Xi=()=>{const e=l(a=>a.blurRadius),t=l(a=>a.mediaType),n=p(),o=a=>{I(a.target.value,Ee)&&n(As(a.target.value))},i=t!=="getUserMedia";return s.jsxs(h,{className:"form-inline",controlId:"blurRadius",children:[s.jsx(b,{kind:"blurRadius",children:"blurRadius:"}),s.jsx(R,{value:e,onChange:o,disabled:i,children:Ee.map(a=>s.jsx("option",{suppressHydrationWarning:!0,value:a,children:a===""||i?"未指定":a},a))})]})},er=()=>{const e=l(c=>c.enabledBundleId),t=l(c=>c.bundleId),n=l(c=>c.soraContents.connectionStatus),o=T(n),i=p(),a=c=>{i(Ls(c.target.checked))},r=c=>{i(Ds(c.target.value))};return s.jsxs(s.Fragment,{children:[s.jsx(j,{className:"form-row",children:s.jsx(f,{className:"col-auto",children:s.jsx(h,{className:"form-inline",controlId:"enabledBundleId",children:s.jsx(w,{kind:"bundleId",checked:e,onChange:a,disabled:o,children:"bundleId"})})})}),e?s.jsx(j,{className:"form-row",children:s.jsx(f,{className:"col-auto",children:s.jsx(h,{className:"form-inline",controlId:"bundleId",children:s.jsx(G,{className:"flex-fill w-500",type:"text",placeholder:"bundleIdを指定",value:t,onChange:r,disabled:o})})})}):null]})},tr=()=>{const e=l(c=>c.cameraDevice),t=l(c=>c.soraContents.connectionStatus),n=l(c=>c.soraContents.sora),o=l(c=>c.video),i=!(n&&t==="connected"?n.video:o),a=p(),r=c=>{a(js(c.target.checked))};return s.jsx(h,{className:"form-inline",controlId:"cameraDevice",children:s.jsx(w,{kind:"cameraDevice",checked:e,onChange:r,disabled:i,children:"Enable camera device"})})},nr=()=>{const e=l(a=>a.channelId),t=l(a=>a.soraContents.connectionStatus),n=T(t),o=p(),i=a=>{o(Fs(a.target.value))};return s.jsxs(h,{className:"form-inline",controlId:"channelId",children:[s.jsx(b,{kind:"channelId",children:"channelId:"}),s.jsx(G,{type:"text",placeholder:"ChannelIdを指定",value:e,onChange:i,disabled:n})]})},or=()=>{const e=l(c=>c.enabledClientId),t=l(c=>c.clientId),n=l(c=>c.soraContents.connectionStatus),o=T(n),i=p(),a=c=>{i(_s(c.target.checked))},r=c=>{i(Vs(c.target.value))};return s.jsxs(s.Fragment,{children:[s.jsx(j,{className:"form-row",children:s.jsx(f,{className:"col-auto",children:s.jsx(h,{className:"form-inline",controlId:"enabledClientId",children:s.jsx(w,{kind:"clientId",checked:e,onChange:a,disabled:o,children:"clientId"})})})}),e?s.jsx(j,{className:"form-row",children:s.jsx(f,{className:"col-auto",children:s.jsx(h,{className:"form-inline",controlId:"clientId",children:s.jsx(G,{className:"flex-fill w-500",type:"text",placeholder:"ClientIdを指定",value:t,onChange:r,disabled:o})})})}):null]})},sr=()=>{const e=l(o=>o.soraContents.connectionStatus),t=p(),n=()=>{t(hs())};return s.jsx("div",{className:"col-auto mb-1",children:s.jsx("input",{className:"btn btn-secondary",type:"button",name:"connect",defaultValue:"connect",onClick:n,disabled:e==="disconnecting"||e==="connecting"||e==="initializing"})})},ar=e=>{const t=l(i=>i.ignoreDisconnectWebSocket),n=p(),o=i=>{I(i.target.value,Ae)&&n(oa(i.target.value))};return s.jsxs(h,{className:"form-inline",controlId:"ignoreDisconnectWebSocket",children:[s.jsx(b,{kind:"ignoreDisconnectWebSocket",children:"ignoreDisconnectWebSocket:"}),s.jsx(R,{name:"ignoreDisconnectWebSocket",value:t,onChange:o,disabled:e.disabled,children:Ae.map(i=>s.jsx("option",{value:i,children:i===""?"未指定":i},i))})]})},ir=e=>{const t=l(i=>i.dataChannelSignaling),n=p(),o=i=>{I(i.target.value,Pe)&&n(Os(i.target.value))};return s.jsxs(h,{className:"form-inline",controlId:"dataChannelSignaling",children:[s.jsx(b,{kind:"dataChannelSignaling",children:"dataChannelSignaling:"}),s.jsx(R,{name:"dataChannelSignaling",value:t,onChange:o,disabled:e.disabled,children:Pe.map(i=>s.jsx("option",{value:i,children:i===""?"未指定":i},i))})]})},rr=()=>{const e=l(a=>a.enabledDataChannel),t=l(a=>a.soraContents.connectionStatus),n=T(t),o=p(),i=a=>{o(Gs(a.target.checked))};return s.jsxs(s.Fragment,{children:[s.jsx(j,{className:"form-row",children:s.jsx(f,{className:"col-auto",children:s.jsx(h,{className:"form-inline",controlId:"enabledDataChannel",children:s.jsx(Je,{type:"switch",name:"enabledDataChannel",label:"dataChannel",checked:e,onChange:i,disabled:n})})})}),e?s.jsx(j,{className:"form-row",children:s.jsx(f,{className:"col-auto",children:s.jsxs(j,{xs:"auto",children:[s.jsx(f,{children:s.jsx(ir,{disabled:n})}),s.jsx(f,{children:s.jsx(ar,{disabled:n})})]})})}):null]})},cr=(e,t)=>{if(e!=="")try{const n=JSON.stringify(JSON.parse(e),null,2);t(n)}catch{}},z=({value:e,controlId:t,placeholder:n,disabled:o,setValue:i,extraControls:a,rows:r,cols:c})=>{const[u,m]=v.useState(!1),g=S=>{i(S.target.value)};return v.useEffect(()=>{if(e===""){m(!1);return}try{JSON.parse(e),m(!1)}catch{m(!0)}},[e]),s.jsxs(h,{className:"form-inline position-relative",controlId:t,children:[s.jsx(G,{className:u?"flex-fill invalid-json":"flex-fill",as:"textarea",placeholder:n,value:e,onChange:g,rows:r||10,cols:c||100,disabled:o}),s.jsxs("div",{className:"json-input-textarea-overlay",children:[a,s.jsx(ze,{type:"button",variant:"outline-secondary",size:"sm",onClick:()=>cr(e,i),disabled:u,children:"pretty format"})]})]})},lr=()=>{const e=l(u=>u.enabledDataChannels),t=l(u=>u.dataChannels),n=l(u=>u.soraContents.connectionStatus),o=T(n),i=p(),a=JSON.stringify([{label:"#devtools",maxPacketLifeTime:10,ordered:!0,compress:!1,direction:"sendrecv"}],null,2),r=`dataChannelsを指定
(例)
${a}`,c=u=>{i($s(u.target.checked))};return s.jsxs(s.Fragment,{children:[s.jsx(j,{className:"form-row",children:s.jsx(f,{className:"col-auto",children:s.jsx(h,{className:"form-inline",controlId:"enabledDataChannels",children:s.jsx(w,{kind:"dataChannels",checked:e,onChange:c,disabled:o,children:"dataChannels"})})})}),e?s.jsx(j,{className:"form-row",children:s.jsx(f,{className:"col-auto",children:s.jsx(z,{controlId:"dataChannels",placeholder:r,value:t,setValue:u=>i(dt(u)),disabled:o,rows:12,extraControls:s.jsx(ze,{type:"button",variant:"outline-secondary",size:"sm",onClick:()=>i(dt(a)),children:"load template"})})})}):null]})},dr=()=>{const e=l(o=>o.soraContents.connectionStatus),t=p(),n=()=>{t($t())};return s.jsx("div",{className:"col-auto mb-1",children:s.jsx("input",{className:"btn btn-secondary",type:"button",name:"disconnect",defaultValue:"disconnect",onClick:n,disabled:e==="disconnecting"||e==="connecting"||e==="initializing"})})},ur=Array({label:"未指定",value:""},{label:"144p",value:"256x144"},{label:"240p",value:"320x240"},{label:"360p",value:"640x360"},{label:"480p",value:"720x480"},{label:"540p",value:"960x540"},{label:"720p",value:"1280x720"},{label:"1080p",value:"1920x1080"},{label:"1440p",value:"2560x1440"},{label:"2160p",value:"3840x2160"}),mr=({label:e,value:t})=>{const n=p();return s.jsxs(Ke.Item,{as:"button",onClick:()=>n(Jt(t)),children:[e," ",t!==""&&`(${t})`]})},gr=()=>{const e=l(o=>o.displayResolution),t=p(),n=o=>{t(Jt(o.target.value))};return s.jsxs(h,{className:"form-inline",controlId:"displayResolution",children:[s.jsx(b,{kind:"displayResolution",children:"displayResolution:"}),s.jsxs(We,{children:[s.jsx(de.Control,{className:"form-display-resolution",type:"text",value:e,onChange:n,placeholder:"未指定"}),s.jsx(qe,{variant:"outline-secondary form-template-dropdown",title:"",align:"end",children:ur.map(({label:o,value:i})=>s.jsx(mr,{label:o,value:i},i))})]})]})},pr=()=>{const e=p(),t=()=>{e(fs())},n=l(r=>r.soraContents.connectionStatus),o=l(r=>r.soraContents.sora),a=l(r=>r.role)==="recvonly"||o!==null||T(n);return s.jsx("div",{className:"col-auto mb-1",children:s.jsx("input",{className:"btn btn-outline-secondary",type:"button",name:"media_access",defaultValue:"dispose media",onClick:t,disabled:a})})},fr=()=>{const e=l(o=>o.echoCancellation),t=p(),n=o=>{I(o.target.value,ke)&&t(Bs(o.target.value))};return s.jsxs(h,{className:"form-inline",controlId:"echoCancellation",children:[s.jsx(b,{kind:"echoCancellation",children:"echoCancellation:"}),s.jsx(R,{name:"echoCancellation",value:e,onChange:n,children:ke.map(o=>s.jsx("option",{value:o,children:o===""?"未指定":o},o))})]})},hr=()=>{const e=l(o=>o.echoCancellationType),t=p(),n=o=>{I(o.target.value,Ie)&&t(Us(o.target.value))};return s.jsxs(h,{className:"form-inline",controlId:"echoCancellationType",children:[s.jsx(b,{kind:"echoCancellationType",children:"echoCancellationType:"}),s.jsx(R,{name:"echoCancellationType",value:e,onChange:n,children:Ie.map(o=>s.jsx("option",{value:o,children:o===""?"未指定":o},o))})]})},Cr=()=>{const e=l(a=>a.facingMode),t=l(a=>a.mediaType),n=p(),o=a=>{I(a.target.value,Ue)&&n(na(a.target.value))},i=t!=="getUserMedia";return s.jsxs(h,{className:"form-inline",controlId:"facingMode",children:[s.jsx(b,{kind:"facingMode",children:"facingMode:"}),s.jsx(R,{name:"facingMode",value:e,onChange:o,disabled:i,children:Ue.map(a=>s.jsx("option",{value:a,children:a===""?"未指定":a},a))})]})},xr=()=>{const e=l(i=>i.mediaType),t=l(i=>i.fakeVolume),n=p(),o=i=>{n(ta(i.target.value))};return e!=="fakeMedia"?null:s.jsxs(h,{className:"form-inline",controlId:"fakeVolume",children:[s.jsx(b,{kind:"fakeVolume",children:"fakeVolume:"}),s.jsx(de.Range,{min:"0",max:"1",step:"0.25",value:t,onChange:o})]})},Sr=()=>{const e=l(r=>r.enabledForwardingFilter),t=l(r=>r.forwardingFilter),n=l(r=>r.soraContents.connectionStatus),o=T(n),i=p(),a=r=>{i(zs(r.target.checked))};return s.jsxs(s.Fragment,{children:[s.jsx(j,{className:"form-row",children:s.jsx(f,{className:"col-auto",children:s.jsx(h,{className:"form-inline",controlId:"enabledForwardingFilter",children:s.jsx(w,{kind:"forwardingFilter",checked:e,onChange:a,disabled:o,children:"forwardingFilter"})})})}),e?s.jsx(j,{className:"form-row",children:s.jsx(f,{className:"col-auto",children:s.jsx(z,{controlId:"forwardingFilter",placeholder:"forwardingFilterを指定",value:t,setValue:r=>i(ha(r)),disabled:o})})}):null]})},jr=Array({label:"未指定",value:""},{label:"60",value:"60"},{label:"30",value:"30"},{label:"24",value:"24"},{label:"20",value:"20"},{label:"15",value:"15"},{label:"10",value:"10"},{label:"5",value:"5"}),vr=({label:e,value:t})=>{const n=p();return s.jsx(Ke.Item,{as:"button",onClick:()=>n(Wt(t)),children:e})},br=()=>{const e=l(o=>o.frameRate),t=p(),n=o=>{t(Wt(o.target.value))};return s.jsxs(h,{className:"form-inline",controlId:"frameRate",children:[s.jsx(b,{kind:"frameRate",children:"frameRate:"}),s.jsxs(We,{children:[s.jsx(de.Control,{className:"form-frame-rate",type:"text",value:e,onChange:n,placeholder:"未指定"}),s.jsx(qe,{variant:"outline-secondary form-template-dropdown",title:"",align:"end",children:jr.map(({label:o,value:i})=>s.jsx(vr,{label:o,value:i},i))})]})]})},yr=()=>{const e=l(a=>a.lightAdjustment),t=l(a=>a.mediaType),n=p(),o=a=>{I(a.target.value,He)&&n(sa(a.target.value))},i=t!=="getUserMedia";return s.jsxs(h,{className:"form-inline",controlId:"lightAdjustment",children:[s.jsx(b,{kind:"lightAdjustment",children:"lightAdjustment:"}),s.jsx(R,{value:e,onChange:o,disabled:i,children:He.map(a=>s.jsx("option",{suppressHydrationWarning:!0,value:a,children:a===""||i?"未指定":a},a))})]})},Rr=()=>{const e=l(a=>a.mediaProcessorsNoiseSuppression),t=l(a=>a.mediaType),n=p(),o=a=>{n(aa(a.target.checked))},i=t!=="getUserMedia";return s.jsx(h,{className:"form-inline",controlId:"mediaProcessorsNoiseSuppression",children:s.jsx(w,{kind:"mediaProcessorsNoiseSuppression",checked:e,onChange:o,disabled:i,children:"mediaProcessorsNoiseSuppression"})})},Tr=()=>{const e=l(o=>o.mediaStats),t=p(),n=o=>{t(ia(o.target.checked))};return s.jsx(h,{className:"form-inline",controlId:"mediaStats",children:s.jsx(w,{kind:"mediaStats",checked:e,onChange:n,disabled:!1,children:"Show media stats"})})},se=e=>{const{label:t,disabled:n,onChange:o,mediaType:i}=e;return s.jsx(Je,{type:"radio",inline:!0,id:t,label:t,value:t,checked:i===t,onChange:o,disabled:n})},Nr=()=>{const[e,t]=v.useState(!1),n=typeof window<"u"&&window.CropTarget!==void 0,o=l(m=>m.soraContents.connectionStatus),i=l(m=>m.soraContents.localMediaStream),a=l(m=>m.mediaType),r=i!==null||T(o),c=p(),u=m=>{I(m.target.value,Vt)&&c(ra(m.target.value))};return v.useEffect(()=>{t(!0)},[]),s.jsxs(h,{className:"form-inline flex-wrap",children:[s.jsx(b,{kind:"mediaType",children:"mediaType:"}),s.jsx(se,{label:"getUserMedia",mediaType:a,disabled:r,onChange:u}),s.jsx(se,{label:"getDisplayMedia",mediaType:a,disabled:r,onChange:u}),s.jsx(se,{label:"fakeMedia",mediaType:a,disabled:r,onChange:u}),e&&s.jsx(se,{label:"mediacaptureRegion",mediaType:a,disabled:r||!n,onChange:u})]})},kr=()=>{const e=l(r=>r.enabledMetadata),t=l(r=>r.metadata),n=l(r=>r.soraContents.connectionStatus),o=T(n),i=p(),a=r=>{i(Js(r.target.checked))};return s.jsxs(s.Fragment,{children:[s.jsx(j,{className:"form-row",children:s.jsx(f,{className:"col-auto",children:s.jsx(h,{className:"form-inline",controlId:"enabledMetadata",children:s.jsx(w,{kind:"metadata",checked:e,onChange:a,disabled:o,children:"metadata"})})})}),e?s.jsx(j,{className:"form-row",children:s.jsx(f,{className:"col-auto",children:s.jsx(z,{controlId:"metadata",placeholder:"Metadataを指定",value:t,setValue:r=>i(ca(r)),disabled:o})})}):null]})},Ir=()=>{const e=l(c=>c.micDevice),t=l(c=>c.soraContents.connectionStatus),n=l(c=>c.soraContents.sora),o=l(c=>c.audio),i=!(n&&t==="connected"?n.audio:o),a=p(),r=c=>{a(Ss(c.target.checked))};return s.jsx(h,{className:"form-inline",controlId:"micDevice",children:s.jsx(w,{kind:"micDevice",checked:e,onChange:r,disabled:i,children:"Enable mic device"})})},Mr=()=>{const e=l(a=>a.multistream),t=l(a=>a.soraContents.connectionStatus),n=T(t),o=p(),i=a=>{I(a.target.value,Se)&&o(la(a.target.value))};return s.jsxs(h,{className:"form-inline",controlId:"multistream",children:[s.jsx(b,{kind:"multistream",children:"multistream:"}),s.jsx(R,{name:"multistream",value:e,onChange:i,disabled:n,children:Se.map(a=>s.jsx("option",{value:a,children:a===""?"未指定":a},a))})]})},wr=()=>{const e=l(o=>o.noiseSuppression),t=p(),n=o=>{I(o.target.value,Ne)&&t(da(o.target.value))};return s.jsxs(h,{className:"form-inline",controlId:"noiseSuppression",children:[s.jsx(b,{kind:"noiseSuppression",children:"noiseSuppression:"}),s.jsx(R,{name:"noiseSuppression",value:e,onChange:n,children:Ne.map(o=>s.jsx("option",{value:o,children:o===""?"未指定":o},o))})]})},Pr=()=>{const e=l(a=>a.reconnect),t=l(a=>a.soraContents.connectionStatus),n=T(t),o=p(),i=a=>{o(ua(a.target.checked))};return s.jsx(j,{className:"form-row",children:s.jsx(f,{className:"col-auto",children:s.jsx(h,{className:"form-inline",controlId:"reconnect",children:s.jsx(w,{kind:"reconnect",checked:e,onChange:i,disabled:n,children:"reconnect"})})})})},Ar=()=>{const e=p(),t=()=>{e(Gt())};return s.jsx("div",{className:"col-auto mb-1",children:s.jsx("input",{className:"btn btn-outline-secondary",type:"button",name:"update-devices",defaultValue:"update-devices",onClick:t})})},Dr=()=>{const e=p(),t=()=>{e(ps())},n=l(r=>r.soraContents.connectionStatus),o=l(r=>r.soraContents.sora),a=l(r=>r.role)==="recvonly"||o!==null||T(n);return s.jsx("div",{className:"col-auto mb-1",children:s.jsx("input",{className:"btn btn-outline-secondary",type:"button",name:"media_access",defaultValue:"request media",onClick:t,disabled:a})})},Fr=()=>{const e=l(o=>o.resizeMode),t=p(),n=o=>{I(o.target.value,Oe)&&t(ma(o.target.value))};return s.jsxs(h,{className:"form-inline",controlId:"resizeMode",children:[s.jsx(b,{kind:"resizeMode",children:"resizeMode:"}),s.jsx(R,{name:"resizeMode",value:e,onChange:n,children:Oe.map(o=>s.jsx("option",{value:o,children:o===""?"未指定":o},o))})]})},Vr=Array({label:"未指定",value:""},{label:"144p",value:"256x144"},{label:"240p",value:"320x240"},{label:"360p",value:"640x360"},{label:"480p",value:"720x480"},{label:"540p",value:"960x540"},{label:"720p",value:"1280x720"},{label:"1080p",value:"1920x1080"},{label:"1440p",value:"2560x1440"},{label:"2160p",value:"3840x2160"}),Or=({label:e,value:t})=>{const n=p();return s.jsxs(Ke.Item,{as:"button",onClick:()=>n(qt(t)),children:[e," ",t!==""&&`(${t})`]})},Er=()=>{const e=l(o=>o.resolution),t=p(),n=o=>{t(qt(o.target.value))};return s.jsxs(h,{className:"form-inline",controlId:"resolution",children:[s.jsx(b,{kind:"resolution",children:"resolution:"}),s.jsxs(We,{children:[s.jsx(de.Control,{className:"form-resolution",type:"text",value:e,onChange:n,placeholder:"未指定"}),s.jsx(qe,{variant:"outline-secondary form-template-dropdown",title:"",align:"end",children:Vr.map(({label:o,value:i})=>s.jsx(Or,{label:o,value:i},i))})]})]})},Hr=()=>{const e=l(r=>r.role),t=l(r=>r.soraContents.connectionStatus),o=l(r=>r.soraContents.localMediaStream)!==null||T(t),i=p(),a=r=>{I(r.target.value,Be)&&i(ga(r.target.value))};return s.jsxs(h,{className:"form-inline",controlId:"role",children:[s.jsx(b,{kind:"role",children:"role:"}),s.jsx(R,{name:"role",value:e,onChange:a,disabled:o,children:Be.map(r=>s.jsx("option",{value:r,children:r},r))})]})},Br=()=>{const e=l(r=>r.enabledSignalingNotifyMetadata),t=l(r=>r.signalingNotifyMetadata),n=l(r=>r.soraContents.connectionStatus),o=T(n),i=p(),a=r=>{i(Ws(r.target.checked))};return s.jsxs(s.Fragment,{children:[s.jsx(j,{className:"form-row",children:s.jsx(f,{className:"col-auto",children:s.jsx(h,{className:"form-inline",controlId:"enabledSignalingNotifyMetadata",children:s.jsx(w,{kind:"signalingNotifyMetadata",checked:e,onChange:a,disabled:o,children:"signalingNotifyMetadata"})})})}),e?s.jsx(j,{className:"form-row",children:s.jsx(f,{className:"col-auto",children:s.jsx(z,{controlId:"signalingNotifyMetadata",placeholder:"signalingNotifyMetadataを指定",value:t,setValue:r=>i(pa(r)),disabled:o})})}):null]})},Ur=()=>{const e=l(u=>u.enabledSignalingUrlCandidates),t=l(u=>u.signalingUrlCandidates),n=l(u=>u.soraContents.connectionStatus),o=T(n),i=p(),a=u=>{i(qs(u.target.checked))},r=u=>{i(fa(u.target.value.split(`
`)))};return s.jsxs(s.Fragment,{children:[s.jsx(j,{className:"form-row",xs:"auto",children:s.jsx(f,{className:"col-auto",children:s.jsx(h,{className:"form-inline",controlId:"enabledSignalingUrlCandidates",children:s.jsx(w,{kind:"signalingUrlCandidates",checked:e,onChange:a,disabled:o,children:"signalingUrlCandidates"})})})}),e?s.jsx(j,{className:"form-row",xs:"auto",children:s.jsx(f,{className:"col-auto",children:s.jsx(h,{className:"form-inline",controlId:"signalingNotifyMetadata",children:s.jsx(G,{className:"flex-fill",as:"textarea",placeholder:`signalingUrlCandidatesを指定
(例)
wss://sora0.example.com/signaling
wss://sora1.example.com/signaling
`,value:t.join(`
`),onChange:r,rows:5,cols:100,disabled:o})})})}):null]})},Lr=()=>{const e=l(a=>a.simulcast),t=l(a=>a.soraContents.connectionStatus),n=T(t),o=p(),i=a=>{I(a.target.value,je)&&o(Ca(a.target.value))};return s.jsxs(h,{className:"form-inline",controlId:"simulcast",children:[s.jsx(b,{kind:"simulcast",children:"simulcast:"}),s.jsx(R,{name:"simulcast",value:e,onChange:i,disabled:n,children:je.map(a=>s.jsx("option",{value:a,children:a===""?"未指定":a},a))})]})},_r=()=>{const e=l(a=>a.simulcastRid),t=l(a=>a.soraContents.connectionStatus),n=T(t),o=p(),i=a=>{I(a.target.value,we)&&o(xa(a.target.value))};return s.jsxs(h,{className:"form-inline",controlId:"simulcastRid",children:[s.jsx(b,{kind:"simulcastRid",children:"simulcastRid:"}),s.jsx(R,{name:"simulcastRid",value:e,onChange:i,disabled:n,children:we.map(a=>s.jsx("option",{value:a,children:a===""?"未指定":a},a))})]})},$r=()=>{const e=l(a=>a.spotlightFocusRid),t=l(a=>a.soraContents.connectionStatus),n=T(t),o=p(),i=a=>{I(a.target.value,V)&&o(va(a.target.value))};return s.jsxs(h,{className:"form-inline",controlId:"spotlightFocusRid",children:[s.jsx(b,{kind:"spotlightFocusRid",children:"spotlightFocusRid:"}),s.jsx(R,{value:e,onChange:i,disabled:n,children:V.map(a=>s.jsx("option",{value:a,children:a===""?"未指定":a},a))})]})},Gr=()=>{const e=l(a=>a.spotlight),t=l(a=>a.soraContents.connectionStatus),n=T(t),o=p(),i=a=>{I(a.target.value,ve)&&o(ja(a.target.value))};return s.jsxs(h,{className:"form-inline",controlId:"spotlight",children:[s.jsx(b,{kind:"spotlight",children:"spotlight:"}),s.jsx(R,{name:"spotlight",value:e,onChange:i,disabled:n,children:ve.map(a=>s.jsx("option",{value:a,children:a===""?"未指定":a},a))})]})},zr=()=>{const e=l(a=>a.spotlightNumber),t=l(a=>a.soraContents.connectionStatus),n=T(t),o=p(),i=a=>{I(a.target.value,Me)&&o(ba(a.target.value))};return s.jsxs(h,{className:"form-inline",controlId:"spotlightNumber",children:[s.jsx(b,{kind:"spotlightNumber",children:"spotlightNumber:"}),s.jsx(R,{value:e,onChange:i,disabled:n,children:Me.map(a=>s.jsx("option",{value:a,children:a===""?"未指定":a},a))})]})},Jr=()=>{const e=l(a=>a.spotlightUnfocusRid),t=l(a=>a.soraContents.connectionStatus),n=T(t),o=p(),i=a=>{I(a.target.value,V)&&o(ya(a.target.value))};return s.jsxs(h,{className:"form-inline",controlId:"spotlightUnfocusRid",children:[s.jsx(b,{kind:"spotlightUnfocusRid",children:"spotlightUnfocusRid:"}),s.jsx(R,{value:e,onChange:i,disabled:n,children:V.map(a=>s.jsx("option",{value:a,children:a===""?"未指定":a},a))})]})},Wr=()=>{const e=l(a=>a.channelId),t=l(a=>a.soraContents.connectionStatus),n=l(a=>a.apiUrl),o=p(),i=async()=>{try{const a=await vi(n,e);o(H(`POST successed. response: ${JSON.stringify(a)}`))}catch(a){a instanceof Error&&o(E(a.message))}};return s.jsx("div",{className:"col-auto mb-1",children:s.jsx("input",{className:"btn btn-secondary",type:"button",name:"startRec",defaultValue:"start rec",onClick:i,disabled:t==="initializing"})})},qr=()=>{const e=l(a=>a.channelId),t=l(a=>a.soraContents.connectionStatus),n=l(a=>a.apiUrl),o=p(),i=async()=>{try{const a=await bi(n,e);o(H(`POST successed. response: ${JSON.stringify(a)}`))}catch(a){a instanceof Error&&o(E(a.message))}};return s.jsx("div",{className:"col-auto mb-1",children:s.jsx("input",{className:"btn btn-secondary",type:"button",name:"stopRec",defaultValue:"stop rec",onClick:i,disabled:t==="initializing"})})},Kr=()=>{const e=p(),t=()=>{e(Xe())};return s.jsx("div",{className:"col-auto mb-1",children:s.jsx("input",{className:"btn btn-outline-secondary",type:"button",name:"update-mediastream",defaultValue:"update-mediastream",onClick:t})})},Yr=()=>{const e=l(r=>r.enabledVideoAV1Params),t=l(r=>r.videoAV1Params),n=l(r=>r.soraContents.connectionStatus),o=T(n),i=p(),a=r=>{i(Qs(r.target.checked))};return s.jsxs(s.Fragment,{children:[s.jsx(j,{className:"form-row",children:s.jsx(f,{className:"col-auto",children:s.jsx(h,{className:"form-inline",controlId:"enabledVideoAV1Params",children:s.jsx(w,{kind:"videoAV1Params",checked:e,onChange:a,disabled:o,children:"videoAV1Params"})})})}),e?s.jsx(j,{className:"form-row",children:s.jsx(f,{className:"col-auto",children:s.jsx(z,{controlId:"videoAV1Params",placeholder:"videoAV1Paramsを指定",value:t,setValue:r=>i(Da(r)),disabled:o})})}):null]})},on=me.slice();on.splice(me.indexOf("15000")+1,0,"support-message");const Zr=()=>{const e=l(a=>a.videoBitRate),t=l(a=>a.soraContents.connectionStatus),n=T(t),o=p(),i=a=>{I(a.target.value,me)&&o(Ta(a.target.value))};return s.jsxs(h,{className:"form-inline",controlId:"videoBitRate",children:[s.jsx(b,{kind:"videoBitRate",children:"videoBitRate:"}),s.jsx(R,{name:"videoBitRate",value:e,onChange:i,disabled:n,children:on.map(a=>{let r=a;return a===""?r="未指定":a==="support-message"&&(r="以下はサポート外です"),s.jsx("option",{value:a,disabled:a==="support-message",children:r},a)})})]})},Qr=()=>{const e=l(a=>a.videoCodecType),t=l(a=>a.soraContents.connectionStatus),n=T(t),o=p(),i=a=>{I(a.target.value,Re)&&o(Na(a.target.value))};return s.jsxs(h,{className:"form-inline",controlId:"videoCodecType",children:[s.jsx(b,{kind:"videoCodecType",children:"videoCodecType:"}),s.jsx(R,{name:"videoCodecType",value:e,onChange:i,disabled:n,children:Re.map(a=>s.jsx("option",{value:a,children:a===""?"未指定":a},a))})]})},Xr=()=>{const e=l(o=>o.videoContentHint),t=p(),n=o=>{I(o.target.value,Fe)&&t(ka(o.target.value))};return s.jsxs(h,{className:"form-inline",controlId:"videoContentHint",children:[s.jsx(b,{kind:"videoContentHint",children:"videoContentHint:"}),s.jsx(R,{name:"videoContentHint",value:e,onChange:n,children:Fe.map(o=>s.jsx("option",{value:o,children:o===""?"未指定":o},o))})]})},ec=()=>{const e=l(a=>a.video),t=l(a=>a.soraContents.connectionStatus),n=T(t),o=p(),i=a=>{o(Ra(a.target.checked))};return s.jsx(h,{className:"form-inline",controlId:"video",children:s.jsx(w,{kind:"video",checked:e,onChange:i,disabled:n,children:"video"})})},tc=()=>{const e=l(r=>r.enabledVideoH264Params),t=l(r=>r.videoH264Params),n=l(r=>r.soraContents.connectionStatus),o=T(n),i=p(),a=r=>{i(Ys(r.target.checked))};return s.jsxs(s.Fragment,{children:[s.jsx(j,{className:"form-row",children:s.jsx(f,{className:"col-auto",children:s.jsx(h,{className:"form-inline",controlId:"enabledVideoH264Params",children:s.jsx(w,{kind:"videoH264Params",checked:e,onChange:a,disabled:o,children:"videoH264Params"})})})}),e?s.jsx(j,{className:"form-row",children:s.jsx(f,{className:"col-auto",children:s.jsx(z,{controlId:"videoH264Params",placeholder:"videoH264Paramsを指定",value:t,setValue:r=>i(Pa(r)),disabled:o})})}):null]})},nc=()=>{const e=l(r=>r.enabledVideoH265Params),t=l(r=>r.videoH265Params),n=l(r=>r.soraContents.connectionStatus),o=T(n),i=p(),a=r=>{i(Zs(r.target.checked))};return s.jsxs(s.Fragment,{children:[s.jsx(j,{className:"form-row",children:s.jsx(f,{className:"col-auto",children:s.jsx(h,{className:"form-inline",controlId:"enabledVideoH265Params",children:s.jsx(w,{kind:"videoH265Params",checked:e,onChange:a,disabled:o,children:"videoH265Params"})})})}),e?s.jsx(j,{className:"form-row",children:s.jsx(f,{className:"col-auto",children:s.jsx(z,{controlId:"videoH265Params",placeholder:"videoH265Paramsを指定",value:t,setValue:r=>i(Aa(r)),disabled:o})})}):null]})},oc=()=>{const e=l(i=>i.videoInput),t=l(i=>i.videoInputDevices),n=p(),o=i=>{n(Ia(i.target.value)),n(Xe())};return s.jsxs(h,{className:"form-inline",controlId:"videoInput",children:[s.jsx(b,{kind:"videoInput",children:"videoInput:"}),s.jsxs(R,{name:"videoInput",value:e,onChange:o,disabled:t.length===0,children:[s.jsx("option",{value:"",children:"未指定"}),t.map(i=>s.jsx("option",{value:i.deviceId,children:i.label},i.deviceId))]})]})},sc=()=>{const e=l(o=>o.videoTrack),t=p(),n=o=>{t(Ma(o.target.checked))};return s.jsx(h,{className:"form-inline",controlId:"videoTrack",children:s.jsx(w,{kind:"videoTrack",checked:e,onChange:n,disabled:!1,children:"Enable video track"})})},ac=()=>{const e=l(r=>r.enabledVideoVP9Params),t=l(r=>r.videoVP9Params),n=l(r=>r.soraContents.connectionStatus),o=T(n),i=p(),a=r=>{i(Ks(r.target.checked))};return s.jsxs(s.Fragment,{children:[s.jsx(j,{className:"form-row",children:s.jsx(f,{className:"col-auto",children:s.jsx(h,{className:"form-inline",controlId:"enabledVideoVP9Params",children:s.jsx(w,{kind:"videoVP9Params",checked:e,onChange:a,disabled:o,children:"videoVP9Params"})})})}),e?s.jsx(j,{className:"form-row",children:s.jsx(f,{className:"col-auto",children:s.jsx(z,{controlId:"videoVP9Params",placeholder:"videoVP9Paramsを指定",value:t,setValue:r=>i(wa(r)),disabled:o})})}):null]})},ic=()=>s.jsxs(s.Fragment,{children:[s.jsx(j,{className:"form-row",xs:"auto",children:s.jsx(f,{xs:"12",sm:"12",className:"form-channel-id",children:s.jsx(nr,{})})}),s.jsxs(j,{className:"form-row",xs:"auto",children:[s.jsx(f,{children:s.jsx(Hr,{})}),s.jsx(f,{children:s.jsx(Mr,{})}),s.jsx(f,{children:s.jsx(Lr,{})}),s.jsx(f,{children:s.jsx(Gr,{})})]})]}),rc=()=>{const e=l(o=>o.role),t=l(o=>o.multistream),n=!(e==="recvonly"&&(t==="true"||t===""));return s.jsxs(s.Fragment,{children:[s.jsxs(j,{className:"form-row",xs:"auto",children:[s.jsx(f,{children:s.jsx(Wi,{})}),n&&s.jsxs(s.Fragment,{children:[s.jsx(f,{children:s.jsx(zi,{})}),s.jsx(f,{children:s.jsx(Gi,{})})]})]}),s.jsxs(j,{className:"form-row",xs:"auto",children:[s.jsx(f,{children:s.jsx(ec,{})}),n&&s.jsxs(s.Fragment,{children:[s.jsx(f,{children:s.jsx(Qr,{})}),s.jsx(f,{children:s.jsx(Zr,{})})]})]})]})},cc=()=>l(t=>t.simulcast)!=="true"?null:s.jsx(j,{className:"form-row",xs:"auto",children:s.jsx(f,{children:s.jsx(_r,{})})}),lc=()=>l(t=>t.spotlight)!=="true"?null:s.jsxs(j,{className:"form-row",xs:"auto",children:[s.jsx(f,{children:s.jsx(zr,{})}),s.jsx(f,{children:s.jsx($r,{})}),s.jsx(f,{children:s.jsx(Jr,{})})]}),dc=()=>{const[e,t]=v.useState(!0),n=l(x=>x.enabledBundleId),o=l(x=>x.enabledClientId),i=l(x=>x.enabledDataChannel),a=l(x=>x.enabledDataChannels),r=l(x=>x.enabledForwardingFilter),c=l(x=>x.enabledMetadata),u=l(x=>x.enabledSignalingNotifyMetadata),m=l(x=>x.enabledSignalingUrlCandidates),g=l(x=>x.reconnect),S=[n,o,i,a,r,c,u,m,g].some(x=>x),C=["btn-collapse-options"];e&&C.push("collapsed"),S&&C.push("fw-bold");const y=x=>{x.preventDefault(),t(!e)};return s.jsxs(j,{className:"form-row",children:[s.jsx(f,{children:s.jsx("a",{href:"#",className:C.join(" "),onClick:y,children:"Signaling options"})}),s.jsx(le,{in:!e,children:s.jsxs("div",{children:[s.jsx(Pr,{}),s.jsx(or,{}),s.jsx(kr,{}),s.jsx(er,{}),s.jsx(Br,{}),s.jsx(Ur,{}),s.jsx(Sr,{}),s.jsx(lr,{}),s.jsx(rr,{})]})})]})},uc=()=>{const[e,t]=v.useState(!0),n=l(g=>g.enabledAudioStreamingLanguageCode),o=l(g=>g.enabledVideoVP9Params),i=l(g=>g.enabledVideoH264Params),a=l(g=>g.enabledVideoH265Params),r=l(g=>g.enabledVideoAV1Params),c=[n,o,i,a,r].some(g=>g),u=["btn-collapse-options"];e&&u.push("collapsed"),c&&u.push("fw-bold");const m=g=>{g.preventDefault(),t(!e)};return s.jsxs(j,{className:"form-row",children:[s.jsx(f,{children:s.jsx("a",{href:"#",className:u.join(" "),onClick:m,children:"Advanced signaling options"})}),s.jsx(le,{in:!e,children:s.jsxs("div",{children:[s.jsx(Yi,{}),s.jsx(ac,{}),s.jsx(Yr,{}),s.jsx(tc,{}),s.jsx(nc,{})]})})]})},mc=()=>s.jsxs(s.Fragment,{children:[s.jsx(j,{xs:"auto",className:"form-row",children:s.jsx(f,{children:s.jsx(Nr,{})})}),s.jsx(j,{xs:"auto",className:"form-row",children:s.jsx(f,{children:s.jsx(xr,{})})})]}),gc=()=>{const[e,t]=v.useState(!0),n=l(k=>k.audioContentHint),o=l(k=>k.autoGainControl),i=l(k=>k.noiseSuppression),a=l(k=>k.echoCancellation),r=l(k=>k.echoCancellationType),c=l(k=>k.videoContentHint),u=l(k=>k.resolution),m=l(k=>k.frameRate),g=l(k=>k.blurRadius),S=l(k=>k.lightAdjustment),C=l(k=>k.mediaProcessorsNoiseSuppression),y=[n!=="",o!=="",i!=="",a!=="",r!=="",c!=="",u!=="",m!=="",g!=="",S!=="",C].some(k=>k),x=["btn-collapse-options"];e&&x.push("collapsed"),y&&x.push("fw-bold");const N=k=>{k.preventDefault(),t(!e)};return s.jsxs(j,{className:"form-row",children:[s.jsx(f,{children:s.jsx("a",{href:"#",className:x.join(" "),onClick:N,children:"Media options"})}),s.jsx(le,{in:!e,children:s.jsxs("div",{children:[s.jsxs(j,{className:"form-row",children:[s.jsx(f,{className:"col-auto",children:s.jsx(Ji,{})}),s.jsx(f,{className:"col-auto",children:s.jsx(Qi,{})}),s.jsx(f,{className:"col-auto",children:s.jsx(wr,{})}),s.jsx(f,{className:"col-auto",children:s.jsx(fr,{})}),s.jsx(f,{className:"col-auto",children:s.jsx(hr,{})}),s.jsx(f,{className:"col-auto",children:s.jsx(Rr,{})})]}),s.jsxs(j,{className:"form-row",children:[s.jsx(f,{className:"col-auto",children:s.jsx(Xr,{})}),s.jsx(f,{className:"col-auto",children:s.jsx(Er,{})}),s.jsx(f,{className:"col-auto",children:s.jsx(br,{})}),s.jsx(f,{className:"col-auto",children:s.jsx($i,{})}),s.jsx(f,{className:"col-auto",children:s.jsx(Fr,{})}),s.jsx(f,{className:"col-auto",children:s.jsx(Xi,{})}),s.jsx(f,{className:"col-auto",children:s.jsx(yr,{})}),s.jsx(f,{className:"col-auto",children:s.jsx(Cr,{})})]}),s.jsx(Kr,{})]})})]})},pc=()=>{const e=l(n=>n.role),t=l(n=>n.mediaType);return s.jsxs(s.Fragment,{children:[s.jsx(j,{className:"form-row",xs:"auto",children:e!=="recvonly"&&t==="getUserMedia"?s.jsxs(s.Fragment,{children:[s.jsx(f,{children:s.jsx(qi,{})}),s.jsx(f,{children:s.jsx(oc,{})})]}):null}),s.jsxs(j,{className:"form-row",xs:"auto",children:[e!=="sendonly"?s.jsx(f,{children:s.jsx(Ki,{})}):null,s.jsx(Ar,{}),e!=="recvonly"?s.jsxs(s.Fragment,{children:[s.jsx(Dr,{}),s.jsx(pr,{})]}):null]})]})},fc=()=>{const e=l(t=>t.role);return s.jsxs(s.Fragment,{children:[s.jsxs(j,{className:"form-row",xs:"auto",children:[s.jsx(f,{children:s.jsx(gr,{})}),s.jsx(f,{children:s.jsx(Tr,{})})]}),e!=="recvonly"&&s.jsxs(j,{className:"form-row",xs:"auto",children:[s.jsx(f,{children:s.jsx(Ir,{})}),s.jsx(f,{children:s.jsx(tr,{})}),s.jsx(f,{children:s.jsx(Zi,{})}),s.jsx(f,{children:s.jsx(sc,{})})]})]})},hc=()=>{const e=l(i=>i.debug),t=l(i=>i.role),n=l(i=>i.multistream),o=!(t==="recvonly"&&(n==="true"||n===""));return s.jsxs("div",{className:e?"col-devtools col-6":"col-devtools col-12",children:[s.jsx(xi,{}),s.jsx(ic,{}),s.jsx(cc,{}),s.jsx(lc,{}),s.jsx("hr",{className:"hr-form"}),s.jsx(rc,{}),s.jsx(dc,{}),o&&s.jsx(uc,{}),s.jsx("hr",{className:"hr-form"}),t!=="recvonly"?s.jsxs(s.Fragment,{children:[s.jsx(mc,{}),s.jsx(gc,{}),s.jsx("hr",{className:"hr-form"})]}):null,s.jsx(pc,{}),s.jsx(fc,{}),s.jsx("hr",{className:"hr-form"}),s.jsxs("div",{className:"row",children:[s.jsx(sr,{}),s.jsx(dr,{}),s.jsx(Wr,{}),s.jsx(qr,{})]}),s.jsx("hr",{className:"hr-form"}),s.jsx(Fi,{}),t==="recvonly"||t==="sendrecv"?s.jsx(_i,{}):null]})},Cc=()=>{const e=l(i=>i.debug),t=p(),n=()=>{t(zt(!e))},o=e?"btn btn-footer-debug-mode active":"btn btn-footer-debug-mode";return s.jsx("div",{children:s.jsx("button",{type:"button",className:o,onClick:n,children:"debug"})})},xc=()=>{const e=l(t=>t.version);return s.jsxs("footer",{children:[s.jsxs(F,{variant:"dark",bg:"sora",expand:"md",fixed:"bottom",children:[s.jsx(ie,{className:"me-auto"}),s.jsx(ie,{children:s.jsxs(F.Collapse,{id:"navbar-collapse",children:[s.jsxs("a",{href:"https://github.com/shiguredo/sora-devtools",className:"btn btn-outline-light m-1",children:["GitHub: shiguredo/sora-devtools: ",e]}),s.jsxs("a",{href:"https://github.com/shiguredo/sora-js-sdk",className:"btn btn-outline-light m-1",children:["GitHub: shiguredo/sora-js-sdk: ",ue.version()]})]})})]}),s.jsx(Cc,{})]})},Sc=()=>{const e=p(),t=()=>{e(gs())};return s.jsx("input",{className:"btn btn-light btn-sm ms-1",type:"button",name:"copyUrl",defaultValue:"copy URL",onClick:t})},jc=()=>{const e=l(i=>i.debug),t=p(),n=()=>{t(zt(!e))},o=["btn","btn-header-debug-mode","btn-sm","ms-1"];return e&&o.push("active"),s.jsx("input",{className:o.join(" "),type:"button",name:"debug",defaultValue:"debug",onClick:n})};jn();const sn=vn({reducer:d.reducer,middleware:e=>e({serializableCheck:{ignoredActions:["soraDevtools/setSora","soraDevtools/setLocalMediaStream","soraDevtools/setRemoteClient","soraDevtools/setFakeContentsGainNode","soraDevtools/setDataChannelMessage"],ignoredPaths:["soraContents","fakeContents","dataChannelMessages","logMessages","notifyMessages","pushMessages","signalingMessages","lightAdjustmentProcessor","virtualBackgroundProcessor","noiseSuppressionProcessor"]},immutableCheck:{ignoredPaths:["soraContents","fakeContents","dataChannelMessages","logMessages","notifyMessages","pushMessages","signalingMessages","noiseSuppressionProcessor"]}})});function vc(){const e=sn.getState(),t={aspectRatio:e.aspectRatio,audio:e.audio,audioBitRate:e.audioBitRate,audioCodecType:e.audioCodecType,audioContentHint:e.audioContentHint,audioInput:e.audioInput,audioInputDevices:e.audioInputDevices,audioOutput:e.audioOutput,audioOutputDevices:e.audioOutputDevices,audioStreamingLanguageCode:e.audioStreamingLanguageCode,audioTrack:e.audioTrack,autoGainControl:e.autoGainControl,bundleId:e.bundleId,cameraDevice:e.cameraDevice,channelId:e.channelId,clientId:e.clientId,dataChannelSignaling:e.dataChannelSignaling,dataChannels:e.dataChannels,debug:e.debug,displayResolution:e.displayResolution,echoCancellation:e.echoCancellation,echoCancellationType:e.echoCancellationType,enabledAudioStreamingLanguageCode:e.enabledAudioStreamingLanguageCode,enabledBundleId:e.enabledBundleId,enabledClientId:e.enabledClientId,enabledDataChannel:e.enabledDataChannel,enabledDataChannels:e.enabledDataChannels,enabledForwardingFilter:e.enabledForwardingFilter,enabledMetadata:e.enabledMetadata,enabledSignalingNotifyMetadata:e.enabledSignalingNotifyMetadata,enabledSignalingUrlCandidates:e.enabledSignalingUrlCandidates,enabledVideoVP9Params:e.enabledVideoVP9Params,enabledVideoH264Params:e.enabledVideoH264Params,enabledVideoH265Params:e.enabledVideoH265Params,enabledVideoAV1Params:e.enabledVideoAV1Params,facingMode:e.facingMode,fakeVolume:e.fakeVolume,forwardingFilter:e.forwardingFilter,frameRate:e.frameRate,googCpuOveruseDetection:e.googCpuOveruseDetection,ignoreDisconnectWebSocket:e.ignoreDisconnectWebSocket,mediaType:e.mediaType,metadata:e.metadata,micDevice:e.micDevice,multistream:e.multistream,noiseSuppression:e.noiseSuppression,reconnect:e.reconnect,resizeMode:e.resizeMode,resolution:e.resolution,mediaStats:e.mediaStats,role:e.role,signalingNotifyMetadata:e.signalingNotifyMetadata,signalingUrlCandidates:e.signalingUrlCandidates,simulcast:e.simulcast,simulcastRid:e.simulcastRid,spotlight:e.spotlight,spotlightFocusRid:e.spotlightFocusRid,spotlightNumber:e.spotlightNumber,spotlightUnfocusRid:e.spotlightUnfocusRid,video:e.video,videoBitRate:e.videoBitRate,videoCodecType:e.videoCodecType,videoContentHint:e.videoContentHint,videoInput:e.videoInput,videoInputDevices:e.videoInputDevices,videoTrack:e.videoTrack,videoVP9Params:e.videoVP9Params,videoH264Params:e.videoH264Params,videoH265Params:e.videoH265Params,videoAV1Params:e.videoAV1Params};return{userAgent:navigator.userAgent,"sora-devtools":e.version,"sora-js-sdk":ue.version(),parameters:t,timeline:e.timelineMessages.map(o=>({timestamp:o.timestamp,message:o})),notify:e.notifyMessages,stats:e.soraContents.statsReport}}const bc=()=>{const e=v.useRef(null),t=()=>{const n=vc(),o=JSON.stringify(n),i=new Blob([o],{type:"text/plain"});if(window.URL=window.URL||window.webkitURL,e.current){const a=new Date().toISOString().replaceAll(":","_").replaceAll(".","_");e.current.download=`sora-devtools-report-${a}.json`,e.current.href=window.URL.createObjectURL(i),e.current.click()}};return s.jsxs(s.Fragment,{children:[s.jsx("input",{className:"btn btn-light btn-sm ms-1",type:"button",name:"downloadReport",defaultValue:"Download report",onClick:t}),s.jsx("a",{ref:e,style:{display:"none"}})]})},yc=()=>{const e=l(i=>i.soraContents.connectionStatus),t=l(i=>i.soraContents.turnUrl),n=l(i=>i.soraContents.sora),o=n&&e==="connected"?t!==null?t:"不明":"TURN URL";return s.jsx("header",{children:s.jsx(F,{variant:"dark",bg:"sora",expand:"lg",fixed:"top",children:s.jsxs(fn,{children:[s.jsx(F.Brand,{href:"/",children:"Sora DevTools"}),s.jsx(F.Toggle,{"aria-controls":"navbar-collapse"}),s.jsxs(F.Collapse,{id:"navbar-collapse",children:[s.jsx(ie,{className:"me-auto"}),s.jsxs(ie,{children:[s.jsx(F.Text,{className:"py-0 my-1 mx-1",children:s.jsx("p",{className:"navbar-signaling-url border rounded",children:n&&e==="connected"?n.connectedSignalingUrl:"Signaling URL"})}),s.jsx(F.Text,{className:"py-0 my-1 mx-1",children:s.jsx("p",{className:"navbar-turn-url border rounded",children:o})}),s.jsx(F.Text,{className:"py-0 my-1 mx-1",children:s.jsx(jc,{})}),s.jsx(F.Text,{className:"py-0 my-1 mx-1",children:s.jsx(bc,{})}),s.jsx(F.Text,{className:"py-0 my-1 ms-1",children:s.jsx(Sc,{})})]})]})]})})})};var Rc=hn();const Tc=Cn(Rc),jt=640,vt=40;function Nc(e){return e<jt+vt?e-vt:jt}const kc=()=>{const e=l(c=>c.mediaType),t={x:100,y:100},[n,o]=v.useState(t),[i,a]=v.useState(0),r=(c,u)=>{o({x:u.x,y:u.y})};return v.useEffect(()=>{const c=()=>{window!==void 0&&a(Nc(window.innerWidth))};return window.addEventListener("resize",c),c(),()=>{window.removeEventListener("resize",c)}},[]),e!=="mediacaptureRegion"?null:s.jsx(Tc,{position:n,onDrag:r,defaultPosition:t,children:s.jsx("div",{id:"cropArea",className:"cropArea",style:{width:`${i}px`,height:`${Math.floor(i/4*3)}px`}})})},Ic=()=>{const e=p();return v.useEffect(()=>(e(ms()),e(Gt()),e(xs()),()=>{e($t())}),[e]),s.jsxs(s.Fragment,{children:[s.jsx(kc,{}),s.jsx(yc,{}),s.jsx("main",{children:s.jsx("div",{className:"container",children:s.jsxs("div",{className:"row",children:[s.jsx(hc,{}),s.jsx(fi,{})]})})}),s.jsx(xc,{})]})};function Mc(){return s.jsx(xn,{store:sn,children:s.jsx(Ic,{})})}const an=document.getElementById("root");if(!an)throw new Error("Root element not found");const wc=yn.createRoot(an);wc.render(s.jsx(v.StrictMode,{children:s.jsx(Mc,{})}));
