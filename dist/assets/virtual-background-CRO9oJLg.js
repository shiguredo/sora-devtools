/**
 * @shiguredo/virtual-background
 * Virtual Background Library
 * @version: 2023.2.0
 * @author: Shiguredo Inc.
 * @license: Apache-2.0
 **//**
 * @shiguredo/video-track-processor
 * Unpublished internal utility package for video track processing
 * @version: 0.0.0
 * @author: Shiguredo Inc.
 * @license: Apache-2.0
 **/class br{trackProcessor;processedTrack;originalTrack;static isSupported(){return Ce.isSupported()||Re.isSupported()}async startProcessing(d,v){if(this.isProcessing())throw Error("Video track processing has already started.");if(Ce.isSupported())this.trackProcessor=new Ce(d,v);else if(Re.isSupported())this.trackProcessor=new Re(d,v);else throw Error("Unsupported browser");return this.originalTrack=d,this.processedTrack=await this.trackProcessor.startProcessing(),this.processedTrack}stopProcessing(){this.trackProcessor!==void 0&&(this.trackProcessor.stopProcessing(),this.trackProcessor=void 0,this.originalTrack=void 0,this.processedTrack=void 0)}isProcessing(){return this.trackProcessor!==void 0}getOriginalTrack(){return this.originalTrack}getProcessedTrack(){return this.processedTrack}}class Pr{track;callback;constructor(d,v){this.track=d,this.callback=v}}class Ce extends Pr{abortController;generator;processor;constructor(d,v){super(d,v),this.abortController=new AbortController,this.generator=new MediaStreamTrackGenerator({kind:"video"}),this.processor=new MediaStreamTrackProcessor({track:this.track})}static isSupported(){return!(typeof MediaStreamTrackProcessor>"u"||typeof MediaStreamTrackGenerator>"u")}startProcessing(){const d=this.abortController.signal;return this.processor.readable.pipeThrough(new TransformStream({transform:async(v,j)=>{if(this.generator.readyState==="ended"){this.stopProcessing();return}const{timestamp:b,duration:y}=v,g=await createImageBitmap(v);v.close();const E=await this.callback(g);g.close(),j.enqueue(new VideoFrame(E,{timestamp:b,duration:y}))}}),{signal:d}).pipeTo(this.generator.writable).catch(v=>{d.aborted?console.debug("Shutting down streams after abort."):console.warn("Error from stream transform:",v),this.processor.readable.cancel(v).catch(j=>{console.warn("Failed to cancel `MediaStreamTrackProcessor`:",j)}),this.generator.writable.abort(v).catch(j=>{console.warn("Failed to abort `MediaStreamTrackGenerator`:",j)})}),Promise.resolve(this.generator)}stopProcessing(){this.abortController.abort()}}class Re extends Pr{video;requestVideoFrameCallbackHandle;canvas;canvasCtx;constructor(d,v){super(d,v),this.video=document.createElement("video"),this.video.muted=!0,this.video.playsInline=!0,this.video.srcObject=new MediaStream([d]);const j=d.getSettings().width||0,b=d.getSettings().height||0;this.canvas=document.createElement("canvas"),this.canvas.width=j,this.canvas.height=b;const y=this.canvas.getContext("2d");if(y===null)throw Error("Failed to create 2D canvas context");this.canvasCtx=y}static isSupported(){return"requestVideoFrameCallback"in HTMLVideoElement.prototype}async startProcessing(){this.requestVideoFrameCallbackHandle=this.video.requestVideoFrameCallback(()=>{this.onFrame().catch(v=>console.warn("Error: ",v))}),await this.video.play();const d=this.canvas.captureStream();return Promise.resolve(d.getVideoTracks()[0])}stopProcessing(){this.requestVideoFrameCallbackHandle!==void 0&&(this.video.pause(),this.video.cancelVideoFrameCallback(this.requestVideoFrameCallbackHandle),this.requestVideoFrameCallbackHandle=void 0)}async onFrame(){const{videoWidth:d,videoHeight:v}=this.video;wn(d,v,this.canvas);const j=await this.callback(this.video);this.canvasCtx.drawImage(j,0,0),this.requestVideoFrameCallbackHandle=this.video.requestVideoFrameCallback(()=>{this.onFrame().catch(b=>console.warn("Error: ",b))})}}function wn(h,d,v){(v.width!==h||v.height!==d)&&(v.width=h,v.height=d)}var Se=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};(function(){var h;function d(t){var e=0;return function(){return e<t.length?{done:!1,value:t[e++]}:{done:!0}}}var v=typeof Object.defineProperties=="function"?Object.defineProperty:function(t,e,r){return t==Array.prototype||t==Object.prototype||(t[e]=r.value),t};function j(t){t=[typeof globalThis=="object"&&globalThis,t,typeof window=="object"&&window,typeof self=="object"&&self,typeof Se=="object"&&Se];for(var e=0;e<t.length;++e){var r=t[e];if(r&&r.Math==Math)return r}throw Error("Cannot find global object")}var b=j(this);function y(t,e){if(e)t:{var r=b;t=t.split(".");for(var n=0;n<t.length-1;n++){var i=t[n];if(!(i in r))break t;r=r[i]}t=t[t.length-1],n=r[t],e=e(n),e!=n&&e!=null&&v(r,t,{configurable:!0,writable:!0,value:e})}}y("Symbol",function(t){function e(s){if(this instanceof e)throw new TypeError("Symbol is not a constructor");return new r(n+(s||"")+"_"+i++,s)}function r(s,o){this.h=s,v(this,"description",{configurable:!0,writable:!0,value:o})}if(t)return t;r.prototype.toString=function(){return this.h};var n="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",i=0;return e}),y("Symbol.iterator",function(t){if(t)return t;t=Symbol("Symbol.iterator");for(var e="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),r=0;r<e.length;r++){var n=b[e[r]];typeof n=="function"&&typeof n.prototype[t]!="function"&&v(n.prototype,t,{configurable:!0,writable:!0,value:function(){return g(d(this))}})}return t});function g(t){return t={next:t},t[Symbol.iterator]=function(){return this},t}function E(t){var e=typeof Symbol<"u"&&Symbol.iterator&&t[Symbol.iterator];return e?e.call(t):{next:d(t)}}function N(t){if(!(t instanceof Array)){t=E(t);for(var e,r=[];!(e=t.next()).done;)r.push(e.value);t=r}return t}var B=typeof Object.assign=="function"?Object.assign:function(t,e){for(var r=1;r<arguments.length;r++){var n=arguments[r];if(n)for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t};y("Object.assign",function(t){return t||B});var U=typeof Object.create=="function"?Object.create:function(t){function e(){}return e.prototype=t,new e},W;if(typeof Object.setPrototypeOf=="function")W=Object.setPrototypeOf;else{var K;t:{var P={a:!0},Et={};try{Et.__proto__=P,K=Et.a;break t}catch{}K=!1}W=K?function(t,e){if(t.__proto__=e,t.__proto__!==e)throw new TypeError(t+" is not extensible");return t}:null}var Ft=W;function k(t,e){if(t.prototype=U(e.prototype),t.prototype.constructor=t,Ft)Ft(t,e);else for(var r in e)if(r!="prototype")if(Object.defineProperties){var n=Object.getOwnPropertyDescriptor(e,r);n&&Object.defineProperty(t,r,n)}else t[r]=e[r];t.za=e.prototype}function V(){this.m=!1,this.j=null,this.i=void 0,this.h=1,this.v=this.s=0,this.l=null}function $(t){if(t.m)throw new TypeError("Generator is already running");t.m=!0}V.prototype.u=function(t){this.i=t};function Z(t,e){t.l={ma:e,na:!0},t.h=t.s||t.v}V.prototype.return=function(t){this.l={return:t},this.h=this.v};function A(t,e,r){return t.h=r,{value:e}}function ct(t){this.h=new V,this.i=t}function $t(t,e){$(t.h);var r=t.h.j;return r?S(t,"return"in r?r.return:function(n){return{value:n,done:!0}},e,t.h.return):(t.h.return(e),ht(t))}function S(t,e,r,n){try{var i=e.call(t.h.j,r);if(!(i instanceof Object))throw new TypeError("Iterator result "+i+" is not an object");if(!i.done)return t.h.m=!1,i;var s=i.value}catch(o){return t.h.j=null,Z(t.h,o),ht(t)}return t.h.j=null,n.call(t.h,s),ht(t)}function ht(t){for(;t.h.h;)try{var e=t.i(t.h);if(e)return t.h.m=!1,{value:e.value,done:!1}}catch(r){t.h.i=void 0,Z(t.h,r)}if(t.h.m=!1,t.h.l){if(e=t.h.l,t.h.l=null,e.na)throw e.ma;return{value:e.return,done:!0}}return{value:void 0,done:!0}}function ot(t){this.next=function(e){return $(t.h),t.h.j?e=S(t,t.h.j.next,e,t.h.u):(t.h.u(e),e=ht(t)),e},this.throw=function(e){return $(t.h),t.h.j?e=S(t,t.h.j.throw,e,t.h.u):(Z(t.h,e),e=ht(t)),e},this.return=function(e){return $t(t,e)},this[Symbol.iterator]=function(){return this}}function st(t){function e(n){return t.next(n)}function r(n){return t.throw(n)}return new Promise(function(n,i){function s(o){o.done?n(o.value):Promise.resolve(o.value).then(e,r).then(s,i)}s(t.next())})}function C(t){return st(new ot(new ct(t)))}y("Promise",function(t){function e(o){this.i=0,this.j=void 0,this.h=[],this.u=!1;var u=this.l();try{o(u.resolve,u.reject)}catch(a){u.reject(a)}}function r(){this.h=null}function n(o){return o instanceof e?o:new e(function(u){u(o)})}if(t)return t;r.prototype.i=function(o){if(this.h==null){this.h=[];var u=this;this.j(function(){u.m()})}this.h.push(o)};var i=b.setTimeout;r.prototype.j=function(o){i(o,0)},r.prototype.m=function(){for(;this.h&&this.h.length;){var o=this.h;this.h=[];for(var u=0;u<o.length;++u){var a=o[u];o[u]=null;try{a()}catch(l){this.l(l)}}}this.h=null},r.prototype.l=function(o){this.j(function(){throw o})},e.prototype.l=function(){function o(l){return function(f){a||(a=!0,l.call(u,f))}}var u=this,a=!1;return{resolve:o(this.I),reject:o(this.m)}},e.prototype.I=function(o){if(o===this)this.m(new TypeError("A Promise cannot resolve to itself"));else if(o instanceof e)this.L(o);else{t:switch(typeof o){case"object":var u=o!=null;break t;case"function":u=!0;break t;default:u=!1}u?this.F(o):this.s(o)}},e.prototype.F=function(o){var u=void 0;try{u=o.then}catch(a){this.m(a);return}typeof u=="function"?this.M(u,o):this.s(o)},e.prototype.m=function(o){this.v(2,o)},e.prototype.s=function(o){this.v(1,o)},e.prototype.v=function(o,u){if(this.i!=0)throw Error("Cannot settle("+o+", "+u+"): Promise already settled in state"+this.i);this.i=o,this.j=u,this.i===2&&this.K(),this.H()},e.prototype.K=function(){var o=this;i(function(){if(o.D()){var u=b.console;typeof u<"u"&&u.error(o.j)}},1)},e.prototype.D=function(){if(this.u)return!1;var o=b.CustomEvent,u=b.Event,a=b.dispatchEvent;return typeof a>"u"?!0:(typeof o=="function"?o=new o("unhandledrejection",{cancelable:!0}):typeof u=="function"?o=new u("unhandledrejection",{cancelable:!0}):(o=b.document.createEvent("CustomEvent"),o.initCustomEvent("unhandledrejection",!1,!0,o)),o.promise=this,o.reason=this.j,a(o))},e.prototype.H=function(){if(this.h!=null){for(var o=0;o<this.h.length;++o)s.i(this.h[o]);this.h=null}};var s=new r;return e.prototype.L=function(o){var u=this.l();o.T(u.resolve,u.reject)},e.prototype.M=function(o,u){var a=this.l();try{o.call(u,a.resolve,a.reject)}catch(l){a.reject(l)}},e.prototype.then=function(o,u){function a(p,c){return typeof p=="function"?function(w){try{l(p(w))}catch(x){f(x)}}:c}var l,f,m=new e(function(p,c){l=p,f=c});return this.T(a(o,l),a(u,f)),m},e.prototype.catch=function(o){return this.then(void 0,o)},e.prototype.T=function(o,u){function a(){switch(l.i){case 1:o(l.j);break;case 2:u(l.j);break;default:throw Error("Unexpected state: "+l.i)}}var l=this;this.h==null?s.i(a):this.h.push(a),this.u=!0},e.resolve=n,e.reject=function(o){return new e(function(u,a){a(o)})},e.race=function(o){return new e(function(u,a){for(var l=E(o),f=l.next();!f.done;f=l.next())n(f.value).T(u,a)})},e.all=function(o){var u=E(o),a=u.next();return a.done?n([]):new e(function(l,f){function m(w){return function(x){p[w]=x,c--,c==0&&l(p)}}var p=[],c=0;do p.push(void 0),c++,n(a.value).T(m(p.length-1),f),a=u.next();while(!a.done)})},e});function Nt(t,e){t instanceof String&&(t+="");var r=0,n=!1,i={next:function(){if(!n&&r<t.length){var s=r++;return{value:e(s,t[s]),done:!1}}return n=!0,{done:!0,value:void 0}}};return i[Symbol.iterator]=function(){return i},i}y("Array.prototype.keys",function(t){return t||function(){return Nt(this,function(e){return e})}}),y("Array.prototype.fill",function(t){return t||function(e,r,n){var i=this.length||0;for(0>r&&(r=Math.max(0,i+r)),(n==null||n>i)&&(n=i),n=Number(n),0>n&&(n=Math.max(0,i+n)),r=Number(r||0);r<n;r++)this[r]=e;return this}});function z(t){return t||Array.prototype.fill}y("Int8Array.prototype.fill",z),y("Uint8Array.prototype.fill",z),y("Uint8ClampedArray.prototype.fill",z),y("Int16Array.prototype.fill",z),y("Uint16Array.prototype.fill",z),y("Int32Array.prototype.fill",z),y("Uint32Array.prototype.fill",z),y("Float32Array.prototype.fill",z),y("Float64Array.prototype.fill",z),y("Object.is",function(t){return t||function(e,r){return e===r?e!==0||1/e===1/r:e!==e&&r!==r}}),y("Array.prototype.includes",function(t){return t||function(e,r){var n=this;n instanceof String&&(n=String(n));var i=n.length;for(r=r||0,0>r&&(r=Math.max(r+i,0));r<i;r++){var s=n[r];if(s===e||Object.is(s,e))return!0}return!1}}),y("String.prototype.includes",function(t){return t||function(e,r){if(this==null)throw new TypeError("The 'this' value for String.prototype.includes must not be null or undefined");if(e instanceof RegExp)throw new TypeError("First argument to String.prototype.includes must not be a regular expression");return this.indexOf(e,r||0)!==-1}});var pt=this||self;function ut(t,e){t=t.split(".");var r=pt;t[0]in r||typeof r.execScript>"u"||r.execScript("var "+t[0]);for(var n;t.length&&(n=t.shift());)t.length||e===void 0?r[n]&&r[n]!==Object.prototype[n]?r=r[n]:r=r[n]={}:r[n]=e}function yt(t){var e;t:{if((e=pt.navigator)&&(e=e.userAgent))break t;e=""}return e.indexOf(t)!=-1}var Pt=Array.prototype.map?function(t,e){return Array.prototype.map.call(t,e,void 0)}:function(t,e){for(var r=t.length,n=Array(r),i=typeof t=="string"?t.split(""):t,s=0;s<r;s++)s in i&&(n[s]=e.call(void 0,i[s],s,t));return n},Dt={},Q=null;function Ot(t){var e=t.length,r=3*e/4;r%3?r=Math.floor(r):"=.".indexOf(t[e-1])!=-1&&(r="=.".indexOf(t[e-2])!=-1?r-2:r-1);var n=new Uint8Array(r),i=0;return Tt(t,function(s){n[i++]=s}),i!==r?n.subarray(0,i):n}function Tt(t,e){function r(a){for(;n<t.length;){var l=t.charAt(n++),f=Q[l];if(f!=null)return f;if(!/^[\s\xa0]*$/.test(l))throw Error("Unknown base64 encoding at char: "+l)}return a}dt();for(var n=0;;){var i=r(-1),s=r(0),o=r(64),u=r(64);if(u===64&&i===-1)break;e(i<<2|s>>4),o!=64&&(e(s<<4&240|o>>2),u!=64&&e(o<<6&192|u))}}function dt(){if(!Q){Q={};for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),e=["+/=","+/","-_=","-_.","-_"],r=0;5>r;r++){var n=t.concat(e[r].split(""));Dt[r]=n;for(var i=0;i<n.length;i++){var s=n[i];Q[s]===void 0&&(Q[s]=i)}}}}var gt=typeof Uint8Array<"u",at=!(yt("Trident")||yt("MSIE"))&&typeof pt.btoa=="function";function J(t){if(!at){var e;e===void 0&&(e=0),dt(),e=Dt[e];for(var r=Array(Math.floor(t.length/3)),n=e[64]||"",i=0,s=0;i<t.length-2;i+=3){var o=t[i],u=t[i+1],a=t[i+2],l=e[o>>2];o=e[(o&3)<<4|u>>4],u=e[(u&15)<<2|a>>6],a=e[a&63],r[s++]=l+o+u+a}switch(l=0,a=n,t.length-i){case 2:l=t[i+1],a=e[(l&15)<<2]||n;case 1:t=t[i],r[s]=e[t>>2]+e[(t&3)<<4|l>>4]+a+n}return r.join("")}for(e="";10240<t.length;)e+=String.fromCharCode.apply(null,t.subarray(0,10240)),t=t.subarray(10240);return e+=String.fromCharCode.apply(null,t),btoa(e)}var q=RegExp("[-_.]","g");function lt(t){switch(t){case"-":return"+";case"_":return"/";case".":return"=";default:return""}}function kt(t){if(!at)return Ot(t);q.test(t)&&(t=t.replace(q,lt)),t=atob(t);for(var e=new Uint8Array(t.length),r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}var Ct;function mt(){return Ct||(Ct=new Uint8Array(0))}var tt={},Rt=typeof Uint8Array.prototype.slice=="function",R=0,L=0;function St(t){var e=0>t;t=Math.abs(t);var r=t>>>0;t=Math.floor((t-r)/4294967296),e&&(r=E(Mt(r,t)),e=r.next().value,t=r.next().value,r=e),R=r>>>0,L=t>>>0}var It=typeof BigInt=="function";function Mt(t,e){return e=~e,t?t=~t+1:e+=1,[t,e]}function wt(t,e){this.i=t>>>0,this.h=e>>>0}function Vt(t){if(!t)return Ut||(Ut=new wt(0,0));if(!/^-?\d+$/.test(t))return null;if(16>t.length)St(Number(t));else if(It)t=BigInt(t),R=Number(t&BigInt(4294967295))>>>0,L=Number(t>>BigInt(32)&BigInt(4294967295));else{var e=+(t[0]==="-");L=R=0;for(var r=t.length,n=e,i=(r-e)%6+e;i<=r;n=i,i+=6)n=Number(t.slice(n,i)),L*=1e6,R=1e6*R+n,4294967296<=R&&(L+=R/4294967296|0,R%=4294967296);e&&(e=E(Mt(R,L)),t=e.next().value,e=e.next().value,R=t,L=e)}return new wt(R,L)}var Ut;function Me(t,e){return Error("Invalid wire type: "+t+" (at position "+e+")")}function le(){return Error("Failed to read varint, encoding is invalid.")}function Ue(t,e){return Error("Tried to read past the end of the data "+e+" > "+t)}function At(){throw Error("Invalid UTF8")}function Be(t,e){return e=String.fromCharCode.apply(null,e),t==null?e:t+e}var Zt=void 0,fe,Or=typeof TextDecoder<"u",Le,Tr=typeof TextEncoder<"u",Ne;function De(t){if(t!==tt)throw Error("illegal external caller")}function Gt(t,e){if(De(e),this.V=t,t!=null&&t.length===0)throw Error("ByteString should be constructed with non-empty values")}function ce(){return Ne||(Ne=new Gt(null,tt))}function Ie(t){De(tt);var e=t.V;return e=e==null||gt&&e!=null&&e instanceof Uint8Array?e:typeof e=="string"?kt(e):null,e==null?e:t.V=e}function kr(t){if(typeof t=="string")return{buffer:kt(t),C:!1};if(Array.isArray(t))return{buffer:new Uint8Array(t),C:!1};if(t.constructor===Uint8Array)return{buffer:t,C:!1};if(t.constructor===ArrayBuffer)return{buffer:new Uint8Array(t),C:!1};if(t.constructor===Gt)return{buffer:Ie(t)||mt(),C:!0};if(t instanceof Uint8Array)return{buffer:new Uint8Array(t.buffer,t.byteOffset,t.byteLength),C:!1};throw Error("Type not convertible to a Uint8Array, expected a Uint8Array, an ArrayBuffer, a base64 encoded string, a ByteString or an Array of numbers")}function Ve(t,e){this.i=null,this.m=!1,this.h=this.j=this.l=0,he(this,t,e)}function he(t,e,r){r=r===void 0?{}:r,t.S=r.S===void 0?!1:r.S,e&&(e=kr(e),t.i=e.buffer,t.m=e.C,t.l=0,t.j=t.i.length,t.h=t.l)}Ve.prototype.reset=function(){this.h=this.l};function xt(t,e){if(t.h=e,e>t.j)throw Ue(t.j,e)}function Ht(t){var e=t.i,r=t.h,n=e[r++],i=n&127;if(n&128&&(n=e[r++],i|=(n&127)<<7,n&128&&(n=e[r++],i|=(n&127)<<14,n&128&&(n=e[r++],i|=(n&127)<<21,n&128&&(n=e[r++],i|=n<<28,n&128&&e[r++]&128&&e[r++]&128&&e[r++]&128&&e[r++]&128&&e[r++]&128)))))throw le();return xt(t,r),i}function Ge(t,e){if(0>e)throw Error("Tried to read a negative byte length: "+e);var r=t.h,n=r+e;if(n>t.j)throw Ue(e,t.j-r);return t.h=n,r}var He=[];function de(){this.h=[]}de.prototype.length=function(){return this.h.length},de.prototype.end=function(){var t=this.h;return this.h=[],t};function We(t,e,r){for(;0<r||127<e;)t.h.push(e&127|128),e=(e>>>7|r<<25)>>>0,r>>>=7;t.h.push(e)}function bt(t,e){for(;127<e;)t.h.push(e&127|128),e>>>=7;t.h.push(e)}function ve(t,e){if(He.length){var r=He.pop();he(r,t,e),t=r}else t=new Ve(t,e);this.h=t,this.j=this.h.h,this.i=this.l=-1,this.setOptions(e)}ve.prototype.setOptions=function(t){t=t===void 0?{}:t,this.ca=t.ca===void 0?!1:t.ca},ve.prototype.reset=function(){this.h.reset(),this.j=this.h.h,this.i=this.l=-1};function ze(t){var e=t.h;if(e.h==e.j)return!1;t.j=t.h.h;var r=Ht(t.h)>>>0;if(e=r>>>3,r&=7,!(0<=r&&5>=r))throw Me(r,t.j);if(1>e)throw Error("Invalid field number: "+e+" (at position "+t.j+")");return t.l=e,t.i=r,!0}function Qt(t){switch(t.i){case 0:if(t.i!=0)Qt(t);else t:{t=t.h;for(var e=t.h,r=e+10,n=t.i;e<r;)if((n[e++]&128)===0){xt(t,e);break t}throw le()}break;case 1:t=t.h,xt(t,t.h+8);break;case 2:t.i!=2?Qt(t):(e=Ht(t.h)>>>0,t=t.h,xt(t,t.h+e));break;case 5:t=t.h,xt(t,t.h+4);break;case 3:e=t.l;do{if(!ze(t))throw Error("Unmatched start-group tag: stream EOF");if(t.i==4){if(t.l!=e)throw Error("Unmatched end-group tag");break}Qt(t)}while(!0);break;default:throw Me(t.i,t.j)}}var Jt=[];function Cr(){this.j=[],this.i=0,this.h=new de}function Bt(t,e){e.length!==0&&(t.j.push(e),t.i+=e.length)}function Rr(t,e){if(e=e.R){Bt(t,t.h.end());for(var r=0;r<e.length;r++)Bt(t,Ie(e[r])||mt())}}var ft=typeof Symbol=="function"&&typeof Symbol()=="symbol"?Symbol():void 0;function jt(t,e){return ft?t[ft]|=e:t.A!==void 0?t.A|=e:(Object.defineProperties(t,{A:{value:e,configurable:!0,writable:!0,enumerable:!1}}),e)}function _e(t,e){ft?t[ft]&&(t[ft]&=~e):t.A!==void 0&&(t.A&=~e)}function M(t){var e;return ft?e=t[ft]:e=t.A,e??0}function et(t,e){ft?t[ft]=e:t.A!==void 0?t.A=e:Object.defineProperties(t,{A:{value:e,configurable:!0,writable:!0,enumerable:!1}})}function pe(t){return jt(t,1),t}function Sr(t,e){et(e,(t|0)&-51)}function qt(t,e){et(e,(t|18)&-41)}var ye={};function te(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)&&t.constructor===Object}var Wt,Xe=[];et(Xe,23),Wt=Object.freeze(Xe);function ge(t){if(M(t.o)&2)throw Error("Cannot mutate an immutable Message")}function me(t){var e=t.length;(e=e?t[e-1]:void 0)&&te(e)?e.g=1:(e={},t.push((e.g=1,e)))}function Ye(t){var e=t.i+t.G;return t.B||(t.B=t.o[e]={})}function X(t,e){return e===-1?null:e>=t.i?t.B?t.B[e]:void 0:t.o[e+t.G]}function rt(t,e,r,n){ge(t),zt(t,e,r,n)}function zt(t,e,r,n){t.j&&(t.j=void 0),e>=t.i||n?Ye(t)[e]=r:(t.o[e+t.G]=r,(t=t.B)&&e in t&&delete t[e])}function we(t,e,r,n){var i=X(t,e);Array.isArray(i)||(i=Wt);var s=M(i);if(s&1||pe(i),n)s&2||jt(i,2),r&1||Object.freeze(i);else{n=!(r&2);var o=s&2;r&1||!o?n&&s&16&&!o&&_e(i,16):(i=pe(Array.prototype.slice.call(i)),zt(t,e,i))}return i}function Ae(t,e){var r=X(t,e),n=r==null?r:typeof r=="number"||r==="NaN"||r==="Infinity"||r==="-Infinity"?Number(r):void 0;return n!=null&&n!==r&&zt(t,e,n),n}function Ke(t,e,r,n,i){t.h||(t.h={});var s=t.h[r],o=we(t,r,3,i);if(!s){var u=o;s=[];var a=!!(M(t.o)&16);o=!!(M(u)&2);var l=u;!i&&o&&(u=Array.prototype.slice.call(u));for(var f=o,m=0;m<u.length;m++){var p=u[m],c=e,w=!1;if(w=w===void 0?!1:w,p=Array.isArray(p)?new c(p):w?new c:void 0,p!==void 0){c=p.o;var x=w=M(c);o&&(x|=2),a&&(x|=16),x!=w&&et(c,x),c=x,f=f||!!(2&c),s.push(p)}}return t.h[r]=s,a=M(u),e=a|33,e=f?e&-9:e|8,a!=e&&(f=u,Object.isFrozen(f)&&(f=Array.prototype.slice.call(f)),et(f,e),u=f),l!==u&&zt(t,r,u),(i||n&&o)&&jt(s,2),n&&Object.freeze(s),s}return i||(i=Object.isFrozen(s),n&&!i?Object.freeze(s):!n&&i&&(s=Array.prototype.slice.call(s),t.h[r]=s)),s}function xe(t,e,r){var n=!!(M(t.o)&2);if(e=Ke(t,e,r,n,n),t=we(t,r,3,n),!(n||M(t)&8)){for(n=0;n<e.length;n++){if(r=e[n],M(r.o)&2){var i=tr(r,!1);i.j=r}else i=r;r!==i&&(e[n]=i,t[n]=i.o)}jt(t,8)}return e}function nt(t,e,r){if(r!=null&&typeof r!="number")throw Error("Value of float/double field must be a number|null|undefined, found "+typeof r+": "+r);rt(t,e,r)}function $e(t,e,r,n,i){ge(t);var s=Ke(t,r,e,!1,!1);return r=n??new r,t=we(t,e,2,!1),i!=null?(s.splice(i,0,r),t.splice(i,0,r.o)):(s.push(r),t.push(r.o)),r.C()&&_e(t,8),r}function ee(t,e){return t??e}function it(t,e,r){return r=r===void 0?0:r,ee(Ae(t,e),r)}var re;function Mr(t){switch(typeof t){case"number":return isFinite(t)?t:String(t);case"object":if(t)if(Array.isArray(t)){if((M(t)&128)!==0)return t=Array.prototype.slice.call(t),me(t),t}else{if(gt&&t!=null&&t instanceof Uint8Array)return J(t);if(t instanceof Gt){var e=t.V;return e==null?"":typeof e=="string"?e:t.V=J(e)}}}return t}function Ze(t,e,r,n){if(t!=null){if(Array.isArray(t))t=be(t,e,r,n!==void 0);else if(te(t)){var i={},s;for(s in t)i[s]=Ze(t[s],e,r,n);t=i}else t=e(t,n);return t}}function be(t,e,r,n){var i=M(t);n=n?!!(i&16):void 0,t=Array.prototype.slice.call(t);for(var s=0;s<t.length;s++)t[s]=Ze(t[s],e,r,n);return r(i,t),t}function Ur(t){return t.ja===ye?t.toJSON():Mr(t)}function Br(t,e){t&128&&me(e)}function Qe(t,e,r){if(r=r===void 0?qt:r,t!=null){if(gt&&t instanceof Uint8Array)return t.length?new Gt(new Uint8Array(t),tt):ce();if(Array.isArray(t)){var n=M(t);return n&2?t:e&&!(n&32)&&(n&16||n===0)?(et(t,n|2),t):(t=be(t,Qe,n&4?qt:r,!0),e=M(t),e&4&&e&2&&Object.freeze(t),t)}return t.ja===ye?qe(t):t}}function Je(t,e,r,n,i,s,o){if(t=t.h&&t.h[r]){if(n=M(t),n&2?n=t:(s=Pt(t,qe),qt(n,s),Object.freeze(s),n=s),ge(e),o=n==null?Wt:pe([]),n!=null){for(s=!!n.length,t=0;t<n.length;t++){var u=n[t];s=s&&!(M(u.o)&2),o[t]=u.o}s=(s?8:0)|1,t=M(o),(t&s)!==s&&(Object.isFrozen(o)&&(o=Array.prototype.slice.call(o)),et(o,t|s)),e.h||(e.h={}),e.h[r]=n}else e.h&&(e.h[r]=void 0);zt(e,r,o,i)}else rt(e,r,Qe(n,s,o),i)}function qe(t){return M(t.o)&2||(t=tr(t,!0),jt(t.o,2)),t}function tr(t,e){var r=t.o,n=[];jt(n,16);var i=t.constructor.h;if(i&&n.push(i),i=t.B,i){n.length=r.length,n.fill(void 0,n.length,r.length);var s={};n[n.length-1]=s}(M(r)&128)!==0&&me(n),e=e||t.C()?qt:Sr,s=t.constructor,re=n,n=new s(n),re=void 0,t.R&&(n.R=t.R.slice()),s=!!(M(r)&16);for(var o=i?r.length-1:r.length,u=0;u<o;u++)Je(t,n,u-t.G,r[u],!1,s,e);if(i)for(var a in i)Je(t,n,+a,i[a],!0,s,e);return n}function G(t,e,r){t==null&&(t=re),re=void 0;var n=this.constructor.i||0,i=0<n,s=this.constructor.h,o=!1;if(t==null){t=s?[s]:[];var u=48,a=!0;i&&(n=0,u|=128),et(t,u)}else{if(!Array.isArray(t)||s&&s!==t[0])throw Error();var l=u=jt(t,0);if((a=(16&l)!==0)&&((o=(32&l)!==0)||(l|=32)),i){if(128&l)n=0;else if(0<t.length){var f=t[t.length-1];if(te(f)&&"g"in f){n=0,l|=128,delete f.g;var m=!0,p;for(p in f){m=!1;break}m&&t.pop()}}}else if(128&l)throw Error();u!==l&&et(t,l)}this.G=(s?0:-1)-n,this.h=void 0,this.o=t;t:{if(s=this.o.length,n=s-1,s&&(s=this.o[n],te(s))){this.B=s,this.i=n-this.G;break t}e!==void 0&&-1<e?(this.i=Math.max(e,n+1-this.G),this.B=void 0):this.i=Number.MAX_VALUE}if(!i&&this.B&&"g"in this.B)throw Error('Unexpected "g" flag in sparse object of message that is not a group type.');if(r){e=a&&!o&&!0,i=this.i;var c;for(a=0;a<r.length;a++)o=r[a],o<i?(o+=this.G,(n=t[o])?er(n,e):t[o]=Wt):(c||(c=Ye(this)),(n=c[o])?er(n,e):c[o]=Wt)}}G.prototype.toJSON=function(){return be(this.o,Ur,Br)},G.prototype.C=function(){return!!(M(this.o)&2)};function er(t,e){if(Array.isArray(t)){var r=M(t),n=1;!e||r&2||(n|=16),(r&n)!==n&&et(t,r|n)}}G.prototype.ja=ye,G.prototype.toString=function(){return this.o.toString()};function rr(t,e,r){if(r){var n={},i;for(i in r){var s=r[i],o=s.ra;o||(n.J=s.xa||s.oa.W,s.ia?(n.aa=ur(s.ia),o=function(u){return function(a,l,f){return u.J(a,l,f,u.aa)}}(n)):s.ka?(n.Z=ar(s.da.P,s.ka),o=function(u){return function(a,l,f){return u.J(a,l,f,u.Z)}}(n)):o=n.J,s.ra=o),o(e,t,s.da),n={J:n.J,aa:n.aa,Z:n.Z}}}Rr(e,t)}var ne=Symbol();function nr(t,e,r){return t[ne]||(t[ne]=function(n,i){return e(n,i,r)})}function ir(t){var e=t[ne];if(!e){var r=Ee(t);e=function(n,i){return lr(n,i,r)},t[ne]=e}return e}function Lr(t){var e=t.ia;if(e)return ir(e);if(e=t.wa)return nr(t.da.P,e,t.ka)}function Nr(t){var e=Lr(t),r=t.da,n=t.oa.U;return e?function(i,s){return n(i,s,r,e)}:function(i,s){return n(i,s,r)}}function or(t,e){var r=t[e];return typeof r=="function"&&r.length===0&&(r=r(),t[e]=r),Array.isArray(r)&&(Xt in r||_t in r||0<r.length&&typeof r[0]=="function")?r:void 0}function sr(t,e,r,n,i,s){e.P=t[0];var o=1;if(t.length>o&&typeof t[o]!="number"){var u=t[o++];r(e,u)}for(;o<t.length;){r=t[o++];for(var a=o+1;a<t.length&&typeof t[a]!="number";)a++;switch(u=t[o++],a-=o,a){case 0:n(e,r,u);break;case 1:(a=or(t,o))?(o++,i(e,r,u,a)):n(e,r,u,t[o++]);break;case 2:a=o++,a=or(t,a),i(e,r,u,a,t[o++]);break;case 3:s(e,r,u,t[o++],t[o++],t[o++]);break;case 4:s(e,r,u,t[o++],t[o++],t[o++],t[o++]);break;default:throw Error("unexpected number of binary field arguments: "+a)}}return e}var ie=Symbol();function ur(t){var e=t[ie];if(!e){var r=je(t);e=function(n,i){return fr(n,i,r)},t[ie]=e}return e}function ar(t,e){var r=t[ie];return r||(r=function(n,i){return rr(n,i,e)},t[ie]=r),r}var _t=Symbol();function Dr(t,e){t.push(e)}function Ir(t,e,r){t.push(e,r.W)}function Vr(t,e,r,n){var i=ur(n),s=je(n).P,o=r.W;t.push(e,function(u,a,l){return o(u,a,l,s,i)})}function Gr(t,e,r,n,i,s){var o=ar(n,s),u=r.W;t.push(e,function(a,l,f){return u(a,l,f,n,o)})}function je(t){var e=t[_t];return e||(e=sr(t,t[_t]=[],Dr,Ir,Vr,Gr),Xt in t&&_t in t&&(t.length=0),e)}var Xt=Symbol();function Hr(t,e){t[0]=e}function Wr(t,e,r,n){var i=r.U;t[e]=n?function(s,o,u){return i(s,o,u,n)}:i}function zr(t,e,r,n,i){var s=r.U,o=ir(n),u=Ee(n).P;t[e]=function(a,l,f){return s(a,l,f,u,o,i)}}function _r(t,e,r,n,i,s,o){var u=r.U,a=nr(n,i,s);t[e]=function(l,f,m){return u(l,f,m,n,a,o)}}function Ee(t){var e=t[Xt];return e||(e=sr(t,t[Xt]={},Hr,Wr,zr,_r),Xt in t&&_t in t&&(t.length=0),e)}function lr(t,e,r){for(;ze(e)&&e.i!=4;){var n=e.l,i=r[n];if(!i){var s=r[0];s&&(s=s[n])&&(i=r[n]=Nr(s))}if(!i||!i(e,t,n)){i=e,n=t,s=i.j,Qt(i);var o=i;if(!o.ca){if(i=o.h.h-s,o.h.h=s,o=o.h,i==0)i=ce();else{if(s=Ge(o,i),o.S&&o.m)i=o.i.subarray(s,s+i);else{o=o.i;var u=s;i=s+i,i=u===i?mt():Rt?o.slice(u,i):new Uint8Array(o.subarray(u,i))}i=i.length==0?ce():new Gt(i,tt)}(s=n.R)?s.push(i):n.R=[i]}}}return t}function fr(t,e,r){for(var n=r.length,i=n%2==1,s=i?1:0;s<n;s+=2)(0,r[s+1])(e,t,r[s]);rr(t,e,i?r[0]:void 0)}function Yt(t,e){return{U:t,W:e}}var Y=Yt(function(t,e,r){if(t.i!==5)return!1;t=t.h;var n=t.i,i=t.h,s=n[i],o=n[i+1],u=n[i+2];return n=n[i+3],xt(t,t.h+4),o=(s<<0|o<<8|u<<16|n<<24)>>>0,t=2*(o>>31)+1,s=o>>>23&255,o&=8388607,rt(e,r,s==255?o?NaN:1/0*t:s==0?t*Math.pow(2,-149)*o:t*Math.pow(2,s-150)*(o+Math.pow(2,23))),!0},function(t,e,r){if(e=Ae(e,r),e!=null){bt(t.h,8*r+5),t=t.h;var n=+e;n===0?0<1/n?R=L=0:(L=0,R=2147483648):isNaN(n)?(L=0,R=2147483647):(n=(r=0>n?-2147483648:0)?-n:n,34028234663852886e22<n?(L=0,R=(r|2139095040)>>>0):11754943508222875e-54>n?(n=Math.round(n/Math.pow(2,-149)),L=0,R=(r|n)>>>0):(e=Math.floor(Math.log(n)/Math.LN2),n*=Math.pow(2,-e),n=Math.round(8388608*n),16777216<=n&&++e,L=0,R=(r|e+127<<23|n&8388607)>>>0)),r=R,t.h.push(r>>>0&255),t.h.push(r>>>8&255),t.h.push(r>>>16&255),t.h.push(r>>>24&255)}}),Xr=Yt(function(t,e,r){if(t.i!==0)return!1;var n=t.h,i=0,s=t=0,o=n.i,u=n.h;do{var a=o[u++];i|=(a&127)<<s,s+=7}while(32>s&&a&128);for(32<s&&(t|=(a&127)>>4),s=3;32>s&&a&128;s+=7)a=o[u++],t|=(a&127)<<s;if(xt(n,u),128>a)n=i>>>0,a=t>>>0,(t=a&2147483648)&&(n=~n+1>>>0,a=~a>>>0,n==0&&(a=a+1>>>0)),n=4294967296*a+(n>>>0);else throw le();return rt(e,r,t?-n:n),!0},function(t,e,r){e=X(e,r),e!=null&&(typeof e=="string"&&Vt(e),e!=null&&(bt(t.h,8*r),typeof e=="number"?(t=t.h,St(e),We(t,R,L)):(r=Vt(e),We(t.h,r.i,r.h))))}),Yr=Yt(function(t,e,r){return t.i!==0?!1:(rt(e,r,Ht(t.h)),!0)},function(t,e,r){if(e=X(e,r),e!=null&&e!=null)if(bt(t.h,8*r),t=t.h,r=e,0<=r)bt(t,r);else{for(e=0;9>e;e++)t.h.push(r&127|128),r>>=7;t.h.push(1)}}),cr=Yt(function(t,e,r){if(t.i!==2)return!1;var n=Ht(t.h)>>>0;t=t.h;var i=Ge(t,n);if(t=t.i,Or){var s=t,o;(o=fe)||(o=fe=new TextDecoder("utf-8",{fatal:!0})),t=i+n,s=i===0&&t===s.length?s:s.subarray(i,t);try{var u=o.decode(s)}catch(m){if(Zt===void 0){try{o.decode(new Uint8Array([128]))}catch{}try{o.decode(new Uint8Array([97])),Zt=!0}catch{Zt=!1}}throw!Zt&&(fe=void 0),m}}else{u=i,n=u+n,i=[];for(var a=null,l,f;u<n;)l=t[u++],128>l?i.push(l):224>l?u>=n?At():(f=t[u++],194>l||(f&192)!==128?(u--,At()):i.push((l&31)<<6|f&63)):240>l?u>=n-1?At():(f=t[u++],(f&192)!==128||l===224&&160>f||l===237&&160<=f||((s=t[u++])&192)!==128?(u--,At()):i.push((l&15)<<12|(f&63)<<6|s&63)):244>=l?u>=n-2?At():(f=t[u++],(f&192)!==128||(l<<28)+(f-144)>>30!==0||((s=t[u++])&192)!==128||((o=t[u++])&192)!==128?(u--,At()):(l=(l&7)<<18|(f&63)<<12|(s&63)<<6|o&63,l-=65536,i.push((l>>10&1023)+55296,(l&1023)+56320))):At(),8192<=i.length&&(a=Be(a,i),i.length=0);u=Be(a,i)}return rt(e,r,u),!0},function(t,e,r){if(e=X(e,r),e!=null){var n=!1;if(n=n===void 0?!1:n,Tr){if(n&&/(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])/.test(e))throw Error("Found an unpaired surrogate");e=(Le||(Le=new TextEncoder)).encode(e)}else{for(var i=0,s=new Uint8Array(3*e.length),o=0;o<e.length;o++){var u=e.charCodeAt(o);if(128>u)s[i++]=u;else{if(2048>u)s[i++]=u>>6|192;else{if(55296<=u&&57343>=u){if(56319>=u&&o<e.length){var a=e.charCodeAt(++o);if(56320<=a&&57343>=a){u=1024*(u-55296)+a-56320+65536,s[i++]=u>>18|240,s[i++]=u>>12&63|128,s[i++]=u>>6&63|128,s[i++]=u&63|128;continue}else o--}if(n)throw Error("Found an unpaired surrogate");u=65533}s[i++]=u>>12|224,s[i++]=u>>6&63|128}s[i++]=u&63|128}}e=i===s.length?s:s.subarray(0,i)}bt(t.h,8*r+2),bt(t.h,e.length),Bt(t,t.h.end()),Bt(t,e)}}),hr=Yt(function(t,e,r,n,i){if(t.i!==2)return!1;e=$e(e,r,n),r=t.h.j,n=Ht(t.h)>>>0;var s=t.h.h+n,o=s-r;if(0>=o&&(t.h.j=s,i(e,t,void 0,void 0,void 0),o=s-t.h.h),o)throw Error("Message parsing ended unexpectedly. Expected to read "+(n+" bytes, instead read "+(n-o)+" bytes, either the data ended unexpectedly or the message misreported its own length"));return t.h.h=s,t.h.j=r,!0},function(t,e,r,n,i){if(e=xe(e,n,r),e!=null)for(n=0;n<e.length;n++){var s=t;bt(s.h,8*r+2);var o=s.h.end();Bt(s,o),o.push(s.i),s=o,i(e[n],t),o=t;var u=s.pop();for(u=o.i+o.h.length()-u;127<u;)s.push(u&127|128),u>>>=7,o.i++;s.push(u),o.i++}});function Fe(t){return function(e,r){t:{if(Jt.length){var n=Jt.pop();n.setOptions(r),he(n.h,e,r),e=n}else e=new ve(e,r);try{var i=Ee(t),s=lr(new i.P,e,i);break t}finally{i=e.h,i.i=null,i.m=!1,i.l=0,i.j=0,i.h=0,i.S=!1,e.l=-1,e.i=-1,100>Jt.length&&Jt.push(e)}s=void 0}return s}}function Pe(t){return function(){var e=new Cr;fr(this,e,je(t)),Bt(e,e.h.end());for(var r=new Uint8Array(e.i),n=e.j,i=n.length,s=0,o=0;o<i;o++){var u=n[o];r.set(u,s),s+=u.length}return e.j=[r],r}}function Lt(t){G.call(this,t)}k(Lt,G);var dr=[Lt,1,Yr,2,Y,3,cr,4,cr];Lt.prototype.l=Pe(dr);function Oe(t){G.call(this,t,-1,Kr)}k(Oe,G),Oe.prototype.addClassification=function(t,e){return $e(this,1,Lt,t,e),this};var Kr=[1],$r=Fe([Oe,1,hr,dr]);function Kt(t){G.call(this,t)}k(Kt,G);var vr=[Kt,1,Y,2,Y,3,Y,4,Y,5,Y];Kt.prototype.l=Pe(vr);function pr(t){G.call(this,t,-1,Zr)}k(pr,G);var Zr=[1],Qr=Fe([pr,1,hr,vr]);function oe(t){G.call(this,t)}k(oe,G);var yr=[oe,1,Y,2,Y,3,Y,4,Y,5,Y,6,Xr],Jr=Fe(yr);oe.prototype.l=Pe(yr);function gr(t,e,r){if(r=t.createShader(r===0?t.VERTEX_SHADER:t.FRAGMENT_SHADER),t.shaderSource(r,e),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS))throw Error(`Could not compile WebGL shader.

`+t.getShaderInfoLog(r));return r}function qr(t){return xe(t,Lt,1).map(function(e){var r=X(e,1);return{index:r??0,qa:it(e,2),label:X(e,3)!=null?ee(X(e,3),""):void 0,displayName:X(e,4)!=null?ee(X(e,4),""):void 0}})}function tn(t){return{x:it(t,1),y:it(t,2),z:it(t,3),visibility:Ae(t,4)!=null?it(t,4):void 0}}function Te(t,e){this.i=t,this.h=e,this.m=0}function mr(t,e,r){return en(t,e),typeof t.h.canvas.transferToImageBitmap=="function"?Promise.resolve(t.h.canvas.transferToImageBitmap()):r?Promise.resolve(t.h.canvas):typeof createImageBitmap=="function"?createImageBitmap(t.h.canvas):(t.j===void 0&&(t.j=document.createElement("canvas")),new Promise(function(n){t.j.height=t.h.canvas.height,t.j.width=t.h.canvas.width,t.j.getContext("2d",{}).drawImage(t.h.canvas,0,0,t.h.canvas.width,t.h.canvas.height),n(t.j)}))}function en(t,e){var r=t.h;if(t.s===void 0){var n=gr(r,`
  attribute vec2 aVertex;
  attribute vec2 aTex;
  varying vec2 vTex;
  void main(void) {
    gl_Position = vec4(aVertex, 0.0, 1.0);
    vTex = aTex;
  }`,0),i=gr(r,`
  precision mediump float;
  varying vec2 vTex;
  uniform sampler2D sampler0;
  void main(){
    gl_FragColor = texture2D(sampler0, vTex);
  }`,1),s=r.createProgram();if(r.attachShader(s,n),r.attachShader(s,i),r.linkProgram(s),!r.getProgramParameter(s,r.LINK_STATUS))throw Error(`Could not compile WebGL program.

`+r.getProgramInfoLog(s));n=t.s=s,r.useProgram(n),i=r.getUniformLocation(n,"sampler0"),t.l={O:r.getAttribLocation(n,"aVertex"),N:r.getAttribLocation(n,"aTex"),ya:i},t.v=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,t.v),r.enableVertexAttribArray(t.l.O),r.vertexAttribPointer(t.l.O,2,r.FLOAT,!1,0,0),r.bufferData(r.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,1,-1]),r.STATIC_DRAW),r.bindBuffer(r.ARRAY_BUFFER,null),t.u=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,t.u),r.enableVertexAttribArray(t.l.N),r.vertexAttribPointer(t.l.N,2,r.FLOAT,!1,0,0),r.bufferData(r.ARRAY_BUFFER,new Float32Array([0,1,0,0,1,0,1,1]),r.STATIC_DRAW),r.bindBuffer(r.ARRAY_BUFFER,null),r.uniform1i(i,0)}n=t.l,r.useProgram(t.s),r.canvas.width=e.width,r.canvas.height=e.height,r.viewport(0,0,e.width,e.height),r.activeTexture(r.TEXTURE0),t.i.bindTexture2d(e.glName),r.enableVertexAttribArray(n.O),r.bindBuffer(r.ARRAY_BUFFER,t.v),r.vertexAttribPointer(n.O,2,r.FLOAT,!1,0,0),r.enableVertexAttribArray(n.N),r.bindBuffer(r.ARRAY_BUFFER,t.u),r.vertexAttribPointer(n.N,2,r.FLOAT,!1,0,0),r.bindFramebuffer(r.DRAW_FRAMEBUFFER?r.DRAW_FRAMEBUFFER:r.FRAMEBUFFER,null),r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT),r.colorMask(!0,!0,!0,!0),r.drawArrays(r.TRIANGLE_FAN,0,4),r.disableVertexAttribArray(n.O),r.disableVertexAttribArray(n.N),r.bindBuffer(r.ARRAY_BUFFER,null),t.i.bindTexture2d(0)}function rn(t){this.h=t}var nn=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,9,1,7,0,65,0,253,15,26,11]);function on(t,e){return e+t}function wr(t,e){window[t]=e}function sn(t){var e=document.createElement("script");return e.setAttribute("src",t),e.setAttribute("crossorigin","anonymous"),new Promise(function(r){e.addEventListener("load",function(){r()},!1),e.addEventListener("error",function(){r()},!1),document.body.appendChild(e)})}function un(){return C(function(t){switch(t.h){case 1:return t.s=2,A(t,WebAssembly.instantiate(nn),4);case 4:t.h=3,t.s=0;break;case 2:return t.s=0,t.l=null,t.return(!1);case 3:return t.return(!0)}})}function ke(t){if(this.h=t,this.listeners={},this.l={},this.L={},this.s={},this.v={},this.M=this.u=this.ga=!0,this.I=Promise.resolve(),this.fa="",this.D={},this.locateFile=t&&t.locateFile||on,typeof window=="object")var e=window.location.pathname.toString().substring(0,window.location.pathname.toString().lastIndexOf("/"))+"/";else if(typeof location<"u")e=location.pathname.toString().substring(0,location.pathname.toString().lastIndexOf("/"))+"/";else throw Error("solutions can only be loaded on a web page or in a web worker");if(this.ha=e,t.options){e=E(Object.keys(t.options));for(var r=e.next();!r.done;r=e.next()){r=r.value;var n=t.options[r].default;n!==void 0&&(this.l[r]=typeof n=="function"?n():n)}}}h=ke.prototype,h.close=function(){return this.j&&this.j.delete(),Promise.resolve()};function an(t){var e,r,n,i,s,o,u,a,l,f,m;return C(function(p){switch(p.h){case 1:return t.ga?(e=t.h.files===void 0?[]:typeof t.h.files=="function"?t.h.files(t.l):t.h.files,A(p,un(),2)):p.return();case 2:if(r=p.i,typeof window=="object")return wr("createMediapipeSolutionsWasm",{locateFile:t.locateFile}),wr("createMediapipeSolutionsPackedAssets",{locateFile:t.locateFile}),o=e.filter(function(c){return c.data!==void 0}),u=e.filter(function(c){return c.data===void 0}),a=Promise.all(o.map(function(c){var w=se(t,c.url);if(c.path!==void 0){var x=c.path;w=w.then(function(T){return t.overrideFile(x,T),Promise.resolve(T)})}return w})),l=Promise.all(u.map(function(c){return c.simd===void 0||c.simd&&r||!c.simd&&!r?sn(t.locateFile(c.url,t.ha)):Promise.resolve()})).then(function(){var c,w,x;return C(function(T){if(T.h==1)return c=window.createMediapipeSolutionsWasm,w=window.createMediapipeSolutionsPackedAssets,x=t,A(T,c(w),2);x.i=T.i,T.h=0})}),f=function(){return C(function(c){return t.h.graph&&t.h.graph.url?c=A(c,se(t,t.h.graph.url),0):(c.h=0,c=void 0),c})}(),A(p,Promise.all([l,a,f]),7);if(typeof importScripts!="function")throw Error("solutions can only be loaded on a web page or in a web worker");return n=e.filter(function(c){return c.simd===void 0||c.simd&&r||!c.simd&&!r}).map(function(c){return t.locateFile(c.url,t.ha)}),importScripts.apply(null,N(n)),i=t,A(p,createMediapipeSolutionsWasm(Module),6);case 6:i.i=p.i,t.m=new OffscreenCanvas(1,1),t.i.canvas=t.m,s=t.i.GL.createContext(t.m,{antialias:!1,alpha:!1,va:typeof WebGL2RenderingContext<"u"?2:1}),t.i.GL.makeContextCurrent(s),p.h=4;break;case 7:if(t.m=document.createElement("canvas"),m=t.m.getContext("webgl2",{}),!m&&(m=t.m.getContext("webgl",{}),!m))return alert("Failed to create WebGL canvas context when passing video frame."),p.return();t.K=m,t.i.canvas=t.m,t.i.createContext(t.m,!0,!0,{});case 4:t.j=new t.i.SolutionWasm,t.ga=!1,p.h=0}})}function ln(t){var e,r,n,i,s,o,u,a;return C(function(l){if(l.h==1){if(t.h.graph&&t.h.graph.url&&t.fa===t.h.graph.url)return l.return();if(t.u=!0,!t.h.graph||!t.h.graph.url){l.h=2;return}return t.fa=t.h.graph.url,A(l,se(t,t.h.graph.url),3)}for(l.h!=2&&(e=l.i,t.j.loadGraph(e)),r=E(Object.keys(t.D)),n=r.next();!n.done;n=r.next())i=n.value,t.j.overrideFile(i,t.D[i]);if(t.D={},t.h.listeners)for(s=E(t.h.listeners),o=s.next();!o.done;o=s.next())u=o.value,dn(t,u);a=t.l,t.l={},t.setOptions(a),l.h=0})}h.reset=function(){var t=this;return C(function(e){t.j&&(t.j.reset(),t.s={},t.v={}),e.h=0})},h.setOptions=function(t,e){var r=this;if(e=e||this.h.options){for(var n=[],i=[],s={},o=E(Object.keys(t)),u=o.next();!u.done;s={X:s.X,Y:s.Y},u=o.next())if(u=u.value,!(u in this.l&&this.l[u]===t[u])){this.l[u]=t[u];var a=e[u];a!==void 0&&(a.onChange&&(s.X=a.onChange,s.Y=t[u],n.push(function(l){return function(){var f;return C(function(m){if(m.h==1)return A(m,l.X(l.Y),2);f=m.i,f===!0&&(r.u=!0),m.h=0})}}(s))),a.graphOptionXref&&(u=Object.assign({},{calculatorName:"",calculatorIndex:0},a.graphOptionXref,{valueNumber:a.type===1?t[u]:0,valueBoolean:a.type===0?t[u]:!1,valueString:a.type===2?t[u]:""}),i.push(u)))}(n.length!==0||i.length!==0)&&(this.u=!0,this.H=(this.H===void 0?[]:this.H).concat(i),this.F=(this.F===void 0?[]:this.F).concat(n))}};function fn(t){var e,r,n,i,s,o,u;return C(function(a){switch(a.h){case 1:if(!t.u)return a.return();if(!t.F){a.h=2;break}e=E(t.F),r=e.next();case 3:if(r.done){a.h=5;break}return n=r.value,A(a,n(),4);case 4:r=e.next(),a.h=3;break;case 5:t.F=void 0;case 2:if(t.H){for(i=new t.i.GraphOptionChangeRequestList,s=E(t.H),o=s.next();!o.done;o=s.next())u=o.value,i.push_back(u);t.j.changeOptions(i),i.delete(),t.H=void 0}t.u=!1,a.h=0}})}h.initialize=function(){var t=this;return C(function(e){return e.h==1?A(e,an(t),2):e.h!=3?A(e,ln(t),3):A(e,fn(t),0)})};function se(t,e){var r,n;return C(function(i){return e in t.L?i.return(t.L[e]):(r=t.locateFile(e,""),n=fetch(r).then(function(s){return s.arrayBuffer()}),t.L[e]=n,i.return(n))})}h.overrideFile=function(t,e){this.j?this.j.overrideFile(t,e):this.D[t]=e},h.clearOverriddenFiles=function(){this.D={},this.j&&this.j.clearOverriddenFiles()},h.send=function(t,e){var r=this,n,i,s,o,u,a,l,f,m;return C(function(p){switch(p.h){case 1:return r.h.inputs?(n=1e3*(e??performance.now()),A(p,r.I,2)):p.return();case 2:return A(p,r.initialize(),3);case 3:for(i=new r.i.PacketDataList,s=E(Object.keys(t)),o=s.next();!o.done;o=s.next())if(u=o.value,a=r.h.inputs[u]){t:{var c=t[u];switch(a.type){case"video":var w=r.s[a.stream];if(w||(w=new Te(r.i,r.K),r.s[a.stream]=w),w.m===0&&(w.m=w.i.createTexture()),typeof HTMLVideoElement<"u"&&c instanceof HTMLVideoElement)var x=c.videoWidth,T=c.videoHeight;else typeof HTMLImageElement<"u"&&c instanceof HTMLImageElement?(x=c.naturalWidth,T=c.naturalHeight):(x=c.width,T=c.height);T={glName:w.m,width:x,height:T},x=w.h,x.canvas.width=T.width,x.canvas.height=T.height,x.activeTexture(x.TEXTURE0),w.i.bindTexture2d(w.m),x.texImage2D(x.TEXTURE_2D,0,x.RGBA,x.RGBA,x.UNSIGNED_BYTE,c),w.i.bindTexture2d(0),w=T;break t;case"detections":for(w=r.s[a.stream],w||(w=new rn(r.i),r.s[a.stream]=w),w.data||(w.data=new w.h.DetectionListData),w.data.reset(c.length),T=0;T<c.length;++T){x=c[T];var O=w.data,D=O.setBoundingBox,_=T,H=x.la,F=new oe;if(nt(F,1,H.sa),nt(F,2,H.ta),nt(F,3,H.height),nt(F,4,H.width),nt(F,5,H.rotation),rt(F,6,H.pa),H=F.l(),D.call(O,_,H),x.ea)for(O=0;O<x.ea.length;++O){F=x.ea[O],D=w.data,_=D.addNormalizedLandmark,H=T,F=Object.assign({},F,{visibility:F.visibility?F.visibility:0});var I=new Kt;nt(I,1,F.x),nt(I,2,F.y),nt(I,3,F.z),F.visibility&&nt(I,4,F.visibility),F=I.l(),_.call(D,H,F)}if(x.ba)for(O=0;O<x.ba.length;++O)D=w.data,_=D.addClassification,H=T,F=x.ba[O],I=new Lt,nt(I,2,F.qa),F.index&&rt(I,1,F.index),F.label&&rt(I,3,F.label),F.displayName&&rt(I,4,F.displayName),F=I.l(),_.call(D,H,F)}w=w.data;break t;default:w={}}}switch(l=w,f=a.stream,a.type){case"video":i.pushTexture2d(Object.assign({},l,{stream:f,timestamp:n}));break;case"detections":m=l,m.stream=f,m.timestamp=n,i.pushDetectionList(m);break;default:throw Error("Unknown input config type: '"+a.type+"'")}}return r.j.send(i),A(p,r.I,4);case 4:i.delete(),p.h=0}})};function cn(t,e,r){var n,i,s,o,u,a,l,f,m,p,c,w,x,T;return C(function(O){switch(O.h){case 1:if(!r)return O.return(e);for(n={},i=0,s=E(Object.keys(r)),o=s.next();!o.done;o=s.next())u=o.value,a=r[u],typeof a!="string"&&a.type==="texture"&&e[a.stream]!==void 0&&++i;1<i&&(t.M=!1),l=E(Object.keys(r)),o=l.next();case 2:if(o.done){O.h=4;break}if(f=o.value,m=r[f],typeof m=="string")return x=n,T=f,A(O,hn(t,f,e[m]),14);if(p=e[m.stream],m.type==="detection_list"){if(p){for(var D=p.getRectList(),_=p.getLandmarksList(),H=p.getClassificationsList(),F=[],I=0;I<D.size();++I){var vt=Jr(D.get(I)),vn=it(vt,1),pn=it(vt,2),yn=it(vt,3),gn=it(vt,4),mn=it(vt,5,0),ue=void 0;ue=ue===void 0?0:ue,vt={la:{sa:vn,ta:pn,height:yn,width:gn,rotation:mn,pa:ee(X(vt,6),ue)},ea:xe(Qr(_.get(I)),Kt,1).map(tn),ba:qr($r(H.get(I)))},F.push(vt)}D=F}else D=[];n[f]=D,O.h=7;break}if(m.type==="proto_list"){if(p){for(D=Array(p.size()),_=0;_<p.size();_++)D[_]=p.get(_);p.delete()}else D=[];n[f]=D,O.h=7;break}if(p===void 0){O.h=3;break}if(m.type==="float_list"){n[f]=p,O.h=7;break}if(m.type==="proto"){n[f]=p,O.h=7;break}if(m.type!=="texture")throw Error("Unknown output config type: '"+m.type+"'");return c=t.v[f],c||(c=new Te(t.i,t.K),t.v[f]=c),A(O,mr(c,p,t.M),13);case 13:w=O.i,n[f]=w;case 7:m.transform&&n[f]&&(n[f]=m.transform(n[f])),O.h=3;break;case 14:x[T]=O.i;case 3:o=l.next(),O.h=2;break;case 4:return O.return(n)}})}function hn(t,e,r){var n;return C(function(i){return typeof r=="number"||r instanceof Uint8Array||r instanceof t.i.Uint8BlobList?i.return(r):r instanceof t.i.Texture2dDataOut?(n=t.v[e],n||(n=new Te(t.i,t.K),t.v[e]=n),i.return(mr(n,r,t.M))):i.return(void 0)})}function dn(t,e){for(var r=e.name||"$",n=[].concat(N(e.wants)),i=new t.i.StringList,s=E(e.wants),o=s.next();!o.done;o=s.next())i.push_back(o.value);s=t.i.PacketListener.implement({onResults:function(u){for(var a={},l=0;l<e.wants.length;++l)a[n[l]]=u.get(l);var f=t.listeners[r];f&&(t.I=cn(t,a,e.outs).then(function(m){m=f(m);for(var p=0;p<e.wants.length;++p){var c=a[n[p]];typeof c=="object"&&c.hasOwnProperty&&c.hasOwnProperty("delete")&&c.delete()}m&&(t.I=m)}))}}),t.j.attachMultiListener(i,s),i.delete()}h.onResults=function(t,e){this.listeners[e||"$"]=t},ut("Solution",ke),ut("OptionType",{BOOL:0,NUMBER:1,ua:2,0:"BOOL",1:"NUMBER",2:"STRING"});function Ar(t){switch(t===void 0&&(t=0),t){case 1:return"selfie_segmentation_landscape.tflite";default:return"selfie_segmentation.tflite"}}function xr(t){var e=this;t=t||{},this.h=new ke({locateFile:t.locateFile,files:function(r){return[{simd:!0,url:"selfie_segmentation_solution_simd_wasm_bin.js"},{simd:!1,url:"selfie_segmentation_solution_wasm_bin.js"},{data:!0,url:Ar(r.modelSelection)}]},graph:{url:"selfie_segmentation.binarypb"},listeners:[{wants:["segmentation_mask","image_transformed"],outs:{image:{type:"texture",stream:"image_transformed"},segmentationMask:{type:"texture",stream:"segmentation_mask"}}}],inputs:{image:{type:"video",stream:"input_frames_gpu"}},options:{useCpuInference:{type:0,graphOptionXref:{calculatorType:"InferenceCalculator",fieldName:"use_cpu_inference"},default:typeof window!="object"||window.navigator===void 0?!1:"iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";").includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document},selfieMode:{type:0,graphOptionXref:{calculatorType:"GlScalerCalculator",calculatorIndex:1,fieldName:"flip_horizontal"}},modelSelection:{type:1,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorModelSelection",fieldName:"int_value"},onChange:function(r){var n,i,s;return C(function(o){return o.h==1?(n=Ar(r),i="third_party/mediapipe/modules/selfie_segmentation/"+n,A(o,se(e.h,n),2)):(s=o.i,e.h.overrideFile(i,s),o.return(!0))})}}}})}h=xr.prototype,h.close=function(){return this.h.close(),Promise.resolve()},h.onResults=function(t){this.h.onResults(t)},h.initialize=function(){var t=this;return C(function(e){return A(e,t.h.initialize(),0)})},h.reset=function(){this.h.reset()},h.send=function(t){var e=this;return C(function(r){return A(r,e.h.send(t),0)})},h.setOptions=function(t){this.h.setOptions(t)},ut("SelfieSegmentation",xr),ut("VERSION","0.1.1675465747")}).call(Se);var An=SelfieSegmentation;function ae(h){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?ae=function(d){return typeof d}:ae=function(d){return d&&typeof Symbol=="function"&&d.constructor===Symbol&&d!==Symbol.prototype?"symbol":typeof d},ae(h)}function xn(h,d){if(!(h instanceof d))throw new TypeError("Cannot call a class as a function")}var bn=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],jn=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function En(h,d,v,j,b){if(typeof h=="string"&&(h=document.getElementById(h)),!h||ae(h)!=="object"||!("getContext"in h))throw new TypeError("Expecting canvas with `getContext` method in processCanvasRGB(A) calls!");var y=h.getContext("2d");try{return y.getImageData(d,v,j,b)}catch(g){throw new Error("unable to access image data: "+g)}}function Fn(h,d,v,j,b,y){if(!(isNaN(y)||y<1)){y|=0;var g=En(h,d,v,j,b);g=Pn(g,d,v,j,b,y),h.getContext("2d").putImageData(g,d,v)}}function Pn(h,d,v,j,b,y){for(var g=h.data,E=2*y+1,N=j-1,B=b-1,U=y+1,W=U*(U+1)/2,K=new jr,P=K,Et,Ft=1;Ft<E;Ft++)P=P.next=new jr,Ft===U&&(Et=P);P.next=K;for(var k=null,V=null,$=bn[y],Z=jn[y],A,ct,$t=0,S=0,ht=0;ht<b;ht++){var ot=g[S],st=g[S+1],C=g[S+2],Nt=U*ot,z=U*st,pt=U*C,ut=W*ot,yt=W*st,Pt=W*C;P=K;for(var Dt=0;Dt<U;Dt++)P.r=ot,P.g=st,P.b=C,P=P.next;for(var Q=0,Ot=0,Tt=0,dt=1;dt<U;dt++)A=S+((N<dt?N:dt)<<2),ut+=(P.r=ot=g[A])*(ct=U-dt),yt+=(P.g=st=g[A+1])*ct,Pt+=(P.b=C=g[A+2])*ct,Q+=ot,Ot+=st,Tt+=C,P=P.next;k=K,V=Et;for(var gt=0;gt<j;gt++)g[S]=ut*$>>Z,g[S+1]=yt*$>>Z,g[S+2]=Pt*$>>Z,ut-=Nt,yt-=z,Pt-=pt,Nt-=k.r,z-=k.g,pt-=k.b,A=$t+((A=gt+y+1)<N?A:N)<<2,Q+=k.r=g[A],Ot+=k.g=g[A+1],Tt+=k.b=g[A+2],ut+=Q,yt+=Ot,Pt+=Tt,k=k.next,Nt+=ot=V.r,z+=st=V.g,pt+=C=V.b,Q-=ot,Ot-=st,Tt-=C,V=V.next,S+=4;$t+=j}for(var at=0;at<j;at++){S=at<<2;var J=g[S],q=g[S+1],lt=g[S+2],kt=U*J,Ct=U*q,mt=U*lt,tt=W*J,Rt=W*q,R=W*lt;P=K;for(var L=0;L<U;L++)P.r=J,P.g=q,P.b=lt,P=P.next;for(var St=0,It=0,Mt=0,wt=1,Vt=j;wt<=y;wt++)S=Vt+at<<2,tt+=(P.r=J=g[S])*(ct=U-wt),Rt+=(P.g=q=g[S+1])*ct,R+=(P.b=lt=g[S+2])*ct,St+=J,It+=q,Mt+=lt,P=P.next,wt<B&&(Vt+=j);S=at,k=K,V=Et;for(var Ut=0;Ut<b;Ut++)A=S<<2,g[A]=tt*$>>Z,g[A+1]=Rt*$>>Z,g[A+2]=R*$>>Z,tt-=kt,Rt-=Ct,R-=mt,kt-=k.r,Ct-=k.g,mt-=k.b,A=at+((A=Ut+U)<B?A:B)*j<<2,tt+=St+=k.r=g[A],Rt+=It+=k.g=g[A+1],R+=Mt+=k.b=g[A+2],k=k.next,kt+=J=V.r,Ct+=q=V.g,mt+=lt=V.b,St-=J,It-=q,Mt-=lt,V=V.next,S+=j}return h}var jr=function h(){xn(this,h),this.r=0,this.g=0,this.b=0,this.a=0,this.next=null};function On(h,d){let v=0,j=0,b=d.width,y=d.height;const g=h.width/h.height,E=d.width/d.height;if(E<g){const N=h.height*(d.width/h.width);j=Math.round((y-N)/2),y=Math.round(N)}else if(E>g){const N=h.width*(d.height/h.height);v=Math.round((b-N)/2),b=Math.round(N)}return{x:v,y:j,width:b,height:y}}class Cn{trackProcessor;segmentation;constructor(d){this.trackProcessor=new br;const v={};d=Tn(d),v.locateFile=j=>`${d}/${j}`,this.segmentation=new An(v)}static isSupported(){return br.isSupported()}async startProcessing(d,v={}){const j=d.getSettings().width||0,b=d.getSettings().height||0,y=Fr(j,b),g=y.getContext("2d",{desynchronized:!0,willReadFrequently:!1});if(g===null)throw Error("Failed to create 2D canvas context");let E;if(v.blurRadius!==void 0&&kn()==="safari"){const B=Fr(j,b).getContext("2d",{desynchronized:!0,willReadFrequently:!0});if(B===null)throw Error("Failed to create 2D canvas context");E=B}await this.segmentation.initialize();let N=1;return v.segmentationModel&&v.segmentationModel==="selfie-general"&&(N=0),this.segmentation.setOptions({modelSelection:N}),this.segmentation.onResults(B=>{const{width:U,height:W}=B.segmentationMask;Er(U,W,y),E!==void 0&&Er(U,W,E.canvas),this.updateOffscreenCanvas(B,g,E,v)}),this.trackProcessor.startProcessing(d,async B=>(await this.segmentation.send({image:B}),y))}stopProcessing(){this.trackProcessor.stopProcessing(),this.segmentation.onResults(()=>{})}isProcessing(){return this.trackProcessor.isProcessing()}getOriginalTrack(){return this.trackProcessor.getOriginalTrack()}getProcessedTrack(){return this.trackProcessor.getProcessedTrack()}updateOffscreenCanvas(d,v,j,b){const{width:y,height:g}=d.image;v.save(),v.clearRect(0,0,y,g),v.drawImage(d.segmentationMask,0,0,y,g),v.globalCompositeOperation="source-in",v.drawImage(d.image,0,0,y,g),v.globalCompositeOperation="destination-over";let E=v;if(b.blurRadius!==void 0&&(j!==void 0?E=j:E.filter=`blur(${b.blurRadius}px)`),b.backgroundImage!==void 0){const B=(b.backgroundImageRegion||On)({width:y,height:g},b.backgroundImage);E.drawImage(b.backgroundImage,B.x,B.y,B.width,B.height,0,0,y,g)}else E.drawImage(d.image,0,0);j!==void 0&&(Fn(E.canvas,0,0,y,g,b.blurRadius),v.drawImage(E.canvas,0,0,y,g)),v.restore()}}function Er(h,d,v){(v.width!==h||v.height!==d)&&(v.width=h,v.height=d)}function Tn(h){return h.slice(-1)==="/"?h.slice(0,-1):h}function Fr(h,d){if(typeof OffscreenCanvas>"u"){const v=document.createElement("canvas");return v.width=h,v.height=d,v}else return new OffscreenCanvas(h,d)}function kn(){const h=window.navigator.userAgent.toLocaleLowerCase();return h.indexOf("edge")!==-1?"edge":h.indexOf("chrome")!==-1&&h.indexOf("edge")===-1?"chrome":h.indexOf("safari")!==-1&&h.indexOf("chrome")===-1?"safari":h.indexOf("opera")!==-1?"opera":h.indexOf("firefox")!==-1?"firefox":"unknown"}export{Cn as V};
