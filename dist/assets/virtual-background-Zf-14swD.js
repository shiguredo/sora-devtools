/**
 * @shiguredo/virtual-background
 * Virtual Background Library
 * @version: 2023.2.0
 * @author: Shiguredo Inc.
 * @license: Apache-2.0
 **//**
 * @shiguredo/video-track-processor
 * Unpublished internal utility package for video track processing
 * @version: 0.0.0
 * @author: Shiguredo Inc.
 * @license: Apache-2.0
 **/class br{trackProcessor;processedTrack;originalTrack;static isSupported(){return Ct.isSupported()||Rt.isSupported()}async startProcessing(d,p){if(this.isProcessing())throw Error("Video track processing has already started.");if(Ct.isSupported())this.trackProcessor=new Ct(d,p);else if(Rt.isSupported())this.trackProcessor=new Rt(d,p);else throw Error("Unsupported browser");return this.originalTrack=d,this.processedTrack=await this.trackProcessor.startProcessing(),this.processedTrack}stopProcessing(){this.trackProcessor!==void 0&&(this.trackProcessor.stopProcessing(),this.trackProcessor=void 0,this.originalTrack=void 0,this.processedTrack=void 0)}isProcessing(){return this.trackProcessor!==void 0}getOriginalTrack(){return this.originalTrack}getProcessedTrack(){return this.processedTrack}}class Pr{track;callback;constructor(d,p){this.track=d,this.callback=p}}class Ct extends Pr{abortController;generator;processor;constructor(d,p){super(d,p),this.abortController=new AbortController,this.generator=new MediaStreamTrackGenerator({kind:"video"}),this.processor=new MediaStreamTrackProcessor({track:this.track})}static isSupported(){return!(typeof MediaStreamTrackProcessor>"u"||typeof MediaStreamTrackGenerator>"u")}startProcessing(){const d=this.abortController.signal;return this.processor.readable.pipeThrough(new TransformStream({transform:async(p,j)=>{if(this.generator.readyState==="ended"){this.stopProcessing();return}const{timestamp:b,duration:y}=p,g=await createImageBitmap(p);p.close();const E=await this.callback(g);g.close(),j.enqueue(new VideoFrame(E,{timestamp:b,duration:y}))}}),{signal:d}).pipeTo(this.generator.writable).catch(p=>{d.aborted?console.debug("Shutting down streams after abort."):console.warn("Error from stream transform:",p),this.processor.readable.cancel(p).catch(j=>{console.warn("Failed to cancel `MediaStreamTrackProcessor`:",j)}),this.generator.writable.abort(p).catch(j=>{console.warn("Failed to abort `MediaStreamTrackGenerator`:",j)})}),Promise.resolve(this.generator)}stopProcessing(){this.abortController.abort()}}class Rt extends Pr{video;requestVideoFrameCallbackHandle;canvas;canvasCtx;constructor(d,p){super(d,p),this.video=document.createElement("video"),this.video.muted=!0,this.video.playsInline=!0,this.video.srcObject=new MediaStream([d]);const j=d.getSettings().width||0,b=d.getSettings().height||0;this.canvas=document.createElement("canvas"),this.canvas.width=j,this.canvas.height=b;const y=this.canvas.getContext("2d");if(y===null)throw Error("Failed to create 2D canvas context");this.canvasCtx=y}static isSupported(){return"requestVideoFrameCallback"in HTMLVideoElement.prototype}async startProcessing(){this.requestVideoFrameCallbackHandle=this.video.requestVideoFrameCallback(()=>{this.onFrame().catch(p=>console.warn("Error: ",p))}),await this.video.play();const d=this.canvas.captureStream();return Promise.resolve(d.getVideoTracks()[0])}stopProcessing(){this.requestVideoFrameCallbackHandle!==void 0&&(this.video.pause(),this.video.cancelVideoFrameCallback(this.requestVideoFrameCallbackHandle),this.requestVideoFrameCallbackHandle=void 0)}async onFrame(){const{videoWidth:d,videoHeight:p}=this.video;wn(d,p,this.canvas);const j=await this.callback(this.video);this.canvasCtx.drawImage(j,0,0),this.requestVideoFrameCallbackHandle=this.video.requestVideoFrameCallback(()=>{this.onFrame().catch(b=>console.warn("Error: ",b))})}}function wn(h,d,p){(p.width!==h||p.height!==d)&&(p.width=h,p.height=d)}var St=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};(function(){var h;function d(e){var t=0;return function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}}var p=typeof Object.defineProperties=="function"?Object.defineProperty:function(e,t,r){return e==Array.prototype||e==Object.prototype||(e[t]=r.value),e};function j(e){e=[typeof globalThis=="object"&&globalThis,e,typeof window=="object"&&window,typeof self=="object"&&self,typeof St=="object"&&St];for(var t=0;t<e.length;++t){var r=e[t];if(r&&r.Math==Math)return r}throw Error("Cannot find global object")}var b=j(this);function y(e,t){if(t)e:{var r=b;e=e.split(".");for(var n=0;n<e.length-1;n++){var i=e[n];if(!(i in r))break e;r=r[i]}e=e[e.length-1],n=r[e],t=t(n),t!=n&&t!=null&&p(r,e,{configurable:!0,writable:!0,value:t})}}y("Symbol",function(e){function t(s){if(this instanceof t)throw new TypeError("Symbol is not a constructor");return new r(n+(s||"")+"_"+i++,s)}function r(s,o){this.h=s,p(this,"description",{configurable:!0,writable:!0,value:o})}if(e)return e;r.prototype.toString=function(){return this.h};var n="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",i=0;return t}),y("Symbol.iterator",function(e){if(e)return e;e=Symbol("Symbol.iterator");for(var t="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),r=0;r<t.length;r++){var n=b[t[r]];typeof n=="function"&&typeof n.prototype[e]!="function"&&p(n.prototype,e,{configurable:!0,writable:!0,value:function(){return g(d(this))}})}return e});function g(e){return e={next:e},e[Symbol.iterator]=function(){return this},e}function E(e){var t=typeof Symbol<"u"&&Symbol.iterator&&e[Symbol.iterator];return t?t.call(e):{next:d(e)}}function N(e){if(!(e instanceof Array)){e=E(e);for(var t,r=[];!(t=e.next()).done;)r.push(t.value);e=r}return e}var B=typeof Object.assign=="function"?Object.assign:function(e,t){for(var r=1;r<arguments.length;r++){var n=arguments[r];if(n)for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e};y("Object.assign",function(e){return e||B});var U=typeof Object.create=="function"?Object.create:function(e){function t(){}return t.prototype=e,new t},W;if(typeof Object.setPrototypeOf=="function")W=Object.setPrototypeOf;else{var K;e:{var P={a:!0},Ee={};try{Ee.__proto__=P,K=Ee.a;break e}catch{}K=!1}W=K?function(e,t){if(e.__proto__=t,e.__proto__!==t)throw new TypeError(e+" is not extensible");return e}:null}var Fe=W;function k(e,t){if(e.prototype=U(t.prototype),e.prototype.constructor=e,Fe)Fe(e,t);else for(var r in t)if(r!="prototype")if(Object.defineProperties){var n=Object.getOwnPropertyDescriptor(t,r);n&&Object.defineProperty(e,r,n)}else e[r]=t[r];e.za=t.prototype}function V(){this.m=!1,this.j=null,this.i=void 0,this.h=1,this.v=this.s=0,this.l=null}function $(e){if(e.m)throw new TypeError("Generator is already running");e.m=!0}V.prototype.u=function(e){this.i=e};function Z(e,t){e.l={ma:t,na:!0},e.h=e.s||e.v}V.prototype.return=function(e){this.l={return:e},this.h=this.v};function A(e,t,r){return e.h=r,{value:t}}function ce(e){this.h=new V,this.i=e}function $e(e,t){$(e.h);var r=e.h.j;return r?S(e,"return"in r?r.return:function(n){return{value:n,done:!0}},t,e.h.return):(e.h.return(t),he(e))}function S(e,t,r,n){try{var i=t.call(e.h.j,r);if(!(i instanceof Object))throw new TypeError("Iterator result "+i+" is not an object");if(!i.done)return e.h.m=!1,i;var s=i.value}catch(o){return e.h.j=null,Z(e.h,o),he(e)}return e.h.j=null,n.call(e.h,s),he(e)}function he(e){for(;e.h.h;)try{var t=e.i(e.h);if(t)return e.h.m=!1,{value:t.value,done:!1}}catch(r){e.h.i=void 0,Z(e.h,r)}if(e.h.m=!1,e.h.l){if(t=e.h.l,e.h.l=null,t.na)throw t.ma;return{value:t.return,done:!0}}return{value:void 0,done:!0}}function oe(e){this.next=function(t){return $(e.h),e.h.j?t=S(e,e.h.j.next,t,e.h.u):(e.h.u(t),t=he(e)),t},this.throw=function(t){return $(e.h),e.h.j?t=S(e,e.h.j.throw,t,e.h.u):(Z(e.h,t),t=he(e)),t},this.return=function(t){return $e(e,t)},this[Symbol.iterator]=function(){return this}}function se(e){function t(n){return e.next(n)}function r(n){return e.throw(n)}return new Promise(function(n,i){function s(o){o.done?n(o.value):Promise.resolve(o.value).then(t,r).then(s,i)}s(e.next())})}function C(e){return se(new oe(new ce(e)))}y("Promise",function(e){function t(o){this.i=0,this.j=void 0,this.h=[],this.u=!1;var u=this.l();try{o(u.resolve,u.reject)}catch(f){u.reject(f)}}function r(){this.h=null}function n(o){return o instanceof t?o:new t(function(u){u(o)})}if(e)return e;r.prototype.i=function(o){if(this.h==null){this.h=[];var u=this;this.j(function(){u.m()})}this.h.push(o)};var i=b.setTimeout;r.prototype.j=function(o){i(o,0)},r.prototype.m=function(){for(;this.h&&this.h.length;){var o=this.h;this.h=[];for(var u=0;u<o.length;++u){var f=o[u];o[u]=null;try{f()}catch(a){this.l(a)}}}this.h=null},r.prototype.l=function(o){this.j(function(){throw o})},t.prototype.l=function(){function o(a){return function(l){f||(f=!0,a.call(u,l))}}var u=this,f=!1;return{resolve:o(this.I),reject:o(this.m)}},t.prototype.I=function(o){if(o===this)this.m(new TypeError("A Promise cannot resolve to itself"));else if(o instanceof t)this.L(o);else{e:switch(typeof o){case"object":var u=o!=null;break e;case"function":u=!0;break e;default:u=!1}u?this.F(o):this.s(o)}},t.prototype.F=function(o){var u=void 0;try{u=o.then}catch(f){this.m(f);return}typeof u=="function"?this.M(u,o):this.s(o)},t.prototype.m=function(o){this.v(2,o)},t.prototype.s=function(o){this.v(1,o)},t.prototype.v=function(o,u){if(this.i!=0)throw Error("Cannot settle("+o+", "+u+"): Promise already settled in state"+this.i);this.i=o,this.j=u,this.i===2&&this.K(),this.H()},t.prototype.K=function(){var o=this;i(function(){if(o.D()){var u=b.console;typeof u<"u"&&u.error(o.j)}},1)},t.prototype.D=function(){if(this.u)return!1;var o=b.CustomEvent,u=b.Event,f=b.dispatchEvent;return typeof f>"u"?!0:(typeof o=="function"?o=new o("unhandledrejection",{cancelable:!0}):typeof u=="function"?o=new u("unhandledrejection",{cancelable:!0}):(o=b.document.createEvent("CustomEvent"),o.initCustomEvent("unhandledrejection",!1,!0,o)),o.promise=this,o.reason=this.j,f(o))},t.prototype.H=function(){if(this.h!=null){for(var o=0;o<this.h.length;++o)s.i(this.h[o]);this.h=null}};var s=new r;return t.prototype.L=function(o){var u=this.l();o.T(u.resolve,u.reject)},t.prototype.M=function(o,u){var f=this.l();try{o.call(u,f.resolve,f.reject)}catch(a){f.reject(a)}},t.prototype.then=function(o,u){function f(v,c){return typeof v=="function"?function(w){try{a(v(w))}catch(x){l(x)}}:c}var a,l,m=new t(function(v,c){a=v,l=c});return this.T(f(o,a),f(u,l)),m},t.prototype.catch=function(o){return this.then(void 0,o)},t.prototype.T=function(o,u){function f(){switch(a.i){case 1:o(a.j);break;case 2:u(a.j);break;default:throw Error("Unexpected state: "+a.i)}}var a=this;this.h==null?s.i(f):this.h.push(f),this.u=!0},t.resolve=n,t.reject=function(o){return new t(function(u,f){f(o)})},t.race=function(o){return new t(function(u,f){for(var a=E(o),l=a.next();!l.done;l=a.next())n(l.value).T(u,f)})},t.all=function(o){var u=E(o),f=u.next();return f.done?n([]):new t(function(a,l){function m(w){return function(x){v[w]=x,c--,c==0&&a(v)}}var v=[],c=0;do v.push(void 0),c++,n(f.value).T(m(v.length-1),l),f=u.next();while(!f.done)})},t});function Ne(e,t){e instanceof String&&(e+="");var r=0,n=!1,i={next:function(){if(!n&&r<e.length){var s=r++;return{value:t(s,e[s]),done:!1}}return n=!0,{done:!0,value:void 0}}};return i[Symbol.iterator]=function(){return i},i}y("Array.prototype.keys",function(e){return e||function(){return Ne(this,function(t){return t})}}),y("Array.prototype.fill",function(e){return e||function(t,r,n){var i=this.length||0;for(0>r&&(r=Math.max(0,i+r)),(n==null||n>i)&&(n=i),n=Number(n),0>n&&(n=Math.max(0,i+n)),r=Number(r||0);r<n;r++)this[r]=t;return this}});function z(e){return e||Array.prototype.fill}y("Int8Array.prototype.fill",z),y("Uint8Array.prototype.fill",z),y("Uint8ClampedArray.prototype.fill",z),y("Int16Array.prototype.fill",z),y("Uint16Array.prototype.fill",z),y("Int32Array.prototype.fill",z),y("Uint32Array.prototype.fill",z),y("Float32Array.prototype.fill",z),y("Float64Array.prototype.fill",z),y("Object.is",function(e){return e||function(t,r){return t===r?t!==0||1/t===1/r:t!==t&&r!==r}}),y("Array.prototype.includes",function(e){return e||function(t,r){var n=this;n instanceof String&&(n=String(n));var i=n.length;for(r=r||0,0>r&&(r=Math.max(r+i,0));r<i;r++){var s=n[r];if(s===t||Object.is(s,t))return!0}return!1}}),y("String.prototype.includes",function(e){return e||function(t,r){if(this==null)throw new TypeError("The 'this' value for String.prototype.includes must not be null or undefined");if(t instanceof RegExp)throw new TypeError("First argument to String.prototype.includes must not be a regular expression");return this.indexOf(t,r||0)!==-1}});var ve=this||self;function ue(e,t){e=e.split(".");var r=ve;e[0]in r||typeof r.execScript>"u"||r.execScript("var "+e[0]);for(var n;e.length&&(n=e.shift());)e.length||t===void 0?r[n]&&r[n]!==Object.prototype[n]?r=r[n]:r=r[n]={}:r[n]=t}function ye(e){var t;e:{if((t=ve.navigator)&&(t=t.userAgent))break e;t=""}return t.indexOf(e)!=-1}var Pe=Array.prototype.map?function(e,t){return Array.prototype.map.call(e,t,void 0)}:function(e,t){for(var r=e.length,n=Array(r),i=typeof e=="string"?e.split(""):e,s=0;s<r;s++)s in i&&(n[s]=t.call(void 0,i[s],s,e));return n},De={},Q=null;function Oe(e){var t=e.length,r=3*t/4;r%3?r=Math.floor(r):"=.".indexOf(e[t-1])!=-1&&(r="=.".indexOf(e[t-2])!=-1?r-2:r-1);var n=new Uint8Array(r),i=0;return Te(e,function(s){n[i++]=s}),i!==r?n.subarray(0,i):n}function Te(e,t){function r(f){for(;n<e.length;){var a=e.charAt(n++),l=Q[a];if(l!=null)return l;if(!/^[\s\xa0]*$/.test(a))throw Error("Unknown base64 encoding at char: "+a)}return f}de();for(var n=0;;){var i=r(-1),s=r(0),o=r(64),u=r(64);if(u===64&&i===-1)break;t(i<<2|s>>4),o!=64&&(t(s<<4&240|o>>2),u!=64&&t(o<<6&192|u))}}function de(){if(!Q){Q={};for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),t=["+/=","+/","-_=","-_.","-_"],r=0;5>r;r++){var n=e.concat(t[r].split(""));De[r]=n;for(var i=0;i<n.length;i++){var s=n[i];Q[s]===void 0&&(Q[s]=i)}}}}var ge=typeof Uint8Array<"u",fe=!(ye("Trident")||ye("MSIE"))&&typeof ve.btoa=="function";function J(e){if(!fe){var t;t===void 0&&(t=0),de(),t=De[t];for(var r=Array(Math.floor(e.length/3)),n=t[64]||"",i=0,s=0;i<e.length-2;i+=3){var o=e[i],u=e[i+1],f=e[i+2],a=t[o>>2];o=t[(o&3)<<4|u>>4],u=t[(u&15)<<2|f>>6],f=t[f&63],r[s++]=a+o+u+f}switch(a=0,f=n,e.length-i){case 2:a=e[i+1],f=t[(a&15)<<2]||n;case 1:e=e[i],r[s]=t[e>>2]+t[(e&3)<<4|a>>4]+f+n}return r.join("")}for(t="";10240<e.length;)t+=String.fromCharCode.apply(null,e.subarray(0,10240)),e=e.subarray(10240);return t+=String.fromCharCode.apply(null,e),btoa(t)}var q=RegExp("[-_.]","g");function ae(e){switch(e){case"-":return"+";case"_":return"/";case".":return"=";default:return""}}function ke(e){if(!fe)return Oe(e);q.test(e)&&(e=e.replace(q,ae)),e=atob(e);for(var t=new Uint8Array(e.length),r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}var Ce;function me(){return Ce||(Ce=new Uint8Array(0))}var ee={},Re=typeof Uint8Array.prototype.slice=="function",R=0,L=0;function Se(e){var t=0>e;e=Math.abs(e);var r=e>>>0;e=Math.floor((e-r)/4294967296),t&&(r=E(Me(r,e)),t=r.next().value,e=r.next().value,r=t),R=r>>>0,L=e>>>0}var Ie=typeof BigInt=="function";function Me(e,t){return t=~t,e?e=~e+1:t+=1,[e,t]}function we(e,t){this.i=e>>>0,this.h=t>>>0}function Ve(e){if(!e)return Ue||(Ue=new we(0,0));if(!/^-?\d+$/.test(e))return null;if(16>e.length)Se(Number(e));else if(Ie)e=BigInt(e),R=Number(e&BigInt(4294967295))>>>0,L=Number(e>>BigInt(32)&BigInt(4294967295));else{var t=+(e[0]==="-");L=R=0;for(var r=e.length,n=t,i=(r-t)%6+t;i<=r;n=i,i+=6)n=Number(e.slice(n,i)),L*=1e6,R=1e6*R+n,4294967296<=R&&(L+=R/4294967296|0,R%=4294967296);t&&(t=E(Me(R,L)),e=t.next().value,t=t.next().value,R=e,L=t)}return new we(R,L)}var Ue;function Mt(e,t){return Error("Invalid wire type: "+e+" (at position "+t+")")}function at(){return Error("Failed to read varint, encoding is invalid.")}function Ut(e,t){return Error("Tried to read past the end of the data "+t+" > "+e)}function Ae(){throw Error("Invalid UTF8")}function Bt(e,t){return t=String.fromCharCode.apply(null,t),e==null?t:e+t}var Ze=void 0,lt,Or=typeof TextDecoder<"u",Lt,Tr=typeof TextEncoder<"u",Nt;function Dt(e){if(e!==ee)throw Error("illegal external caller")}function Ge(e,t){if(Dt(t),this.V=e,e!=null&&e.length===0)throw Error("ByteString should be constructed with non-empty values")}function ct(){return Nt||(Nt=new Ge(null,ee))}function It(e){Dt(ee);var t=e.V;return t=t==null||ge&&t!=null&&t instanceof Uint8Array?t:typeof t=="string"?ke(t):null,t==null?t:e.V=t}function kr(e){if(typeof e=="string")return{buffer:ke(e),C:!1};if(Array.isArray(e))return{buffer:new Uint8Array(e),C:!1};if(e.constructor===Uint8Array)return{buffer:e,C:!1};if(e.constructor===ArrayBuffer)return{buffer:new Uint8Array(e),C:!1};if(e.constructor===Ge)return{buffer:It(e)||me(),C:!0};if(e instanceof Uint8Array)return{buffer:new Uint8Array(e.buffer,e.byteOffset,e.byteLength),C:!1};throw Error("Type not convertible to a Uint8Array, expected a Uint8Array, an ArrayBuffer, a base64 encoded string, a ByteString or an Array of numbers")}function Vt(e,t){this.i=null,this.m=!1,this.h=this.j=this.l=0,ht(this,e,t)}function ht(e,t,r){r=r===void 0?{}:r,e.S=r.S===void 0?!1:r.S,t&&(t=kr(t),e.i=t.buffer,e.m=t.C,e.l=0,e.j=e.i.length,e.h=e.l)}Vt.prototype.reset=function(){this.h=this.l};function xe(e,t){if(e.h=t,t>e.j)throw Ut(e.j,t)}function He(e){var t=e.i,r=e.h,n=t[r++],i=n&127;if(n&128&&(n=t[r++],i|=(n&127)<<7,n&128&&(n=t[r++],i|=(n&127)<<14,n&128&&(n=t[r++],i|=(n&127)<<21,n&128&&(n=t[r++],i|=n<<28,n&128&&t[r++]&128&&t[r++]&128&&t[r++]&128&&t[r++]&128&&t[r++]&128)))))throw at();return xe(e,r),i}function Gt(e,t){if(0>t)throw Error("Tried to read a negative byte length: "+t);var r=e.h,n=r+t;if(n>e.j)throw Ut(t,e.j-r);return e.h=n,r}var Ht=[];function dt(){this.h=[]}dt.prototype.length=function(){return this.h.length},dt.prototype.end=function(){var e=this.h;return this.h=[],e};function Wt(e,t,r){for(;0<r||127<t;)e.h.push(t&127|128),t=(t>>>7|r<<25)>>>0,r>>>=7;e.h.push(t)}function be(e,t){for(;127<t;)e.h.push(t&127|128),t>>>=7;e.h.push(t)}function pt(e,t){if(Ht.length){var r=Ht.pop();ht(r,e,t),e=r}else e=new Vt(e,t);this.h=e,this.j=this.h.h,this.i=this.l=-1,this.setOptions(t)}pt.prototype.setOptions=function(e){e=e===void 0?{}:e,this.ca=e.ca===void 0?!1:e.ca},pt.prototype.reset=function(){this.h.reset(),this.j=this.h.h,this.i=this.l=-1};function zt(e){var t=e.h;if(t.h==t.j)return!1;e.j=e.h.h;var r=He(e.h)>>>0;if(t=r>>>3,r&=7,!(0<=r&&5>=r))throw Mt(r,e.j);if(1>t)throw Error("Invalid field number: "+t+" (at position "+e.j+")");return e.l=t,e.i=r,!0}function Qe(e){switch(e.i){case 0:if(e.i!=0)Qe(e);else e:{e=e.h;for(var t=e.h,r=t+10,n=e.i;t<r;)if(!(n[t++]&128)){xe(e,t);break e}throw at()}break;case 1:e=e.h,xe(e,e.h+8);break;case 2:e.i!=2?Qe(e):(t=He(e.h)>>>0,e=e.h,xe(e,e.h+t));break;case 5:e=e.h,xe(e,e.h+4);break;case 3:t=e.l;do{if(!zt(e))throw Error("Unmatched start-group tag: stream EOF");if(e.i==4){if(e.l!=t)throw Error("Unmatched end-group tag");break}Qe(e)}while(!0);break;default:throw Mt(e.i,e.j)}}var Je=[];function Cr(){this.j=[],this.i=0,this.h=new dt}function Be(e,t){t.length!==0&&(e.j.push(t),e.i+=t.length)}function Rr(e,t){if(t=t.R){Be(e,e.h.end());for(var r=0;r<t.length;r++)Be(e,It(t[r])||me())}}var le=typeof Symbol=="function"&&typeof Symbol()=="symbol"?Symbol():void 0;function je(e,t){return le?e[le]|=t:e.A!==void 0?e.A|=t:(Object.defineProperties(e,{A:{value:t,configurable:!0,writable:!0,enumerable:!1}}),t)}function _t(e,t){le?e[le]&&(e[le]&=~t):e.A!==void 0&&(e.A&=~t)}function M(e){var t;return le?t=e[le]:t=e.A,t??0}function te(e,t){le?e[le]=t:e.A!==void 0?e.A=t:Object.defineProperties(e,{A:{value:t,configurable:!0,writable:!0,enumerable:!1}})}function vt(e){return je(e,1),e}function Sr(e,t){te(t,(e|0)&-51)}function qe(e,t){te(t,(e|18)&-41)}var yt={};function et(e){return e!==null&&typeof e=="object"&&!Array.isArray(e)&&e.constructor===Object}var We,Xt=[];te(Xt,23),We=Object.freeze(Xt);function gt(e){if(M(e.o)&2)throw Error("Cannot mutate an immutable Message")}function mt(e){var t=e.length;(t=t?e[t-1]:void 0)&&et(t)?t.g=1:(t={},e.push((t.g=1,t)))}function Yt(e){var t=e.i+e.G;return e.B||(e.B=e.o[t]={})}function X(e,t){return t===-1?null:t>=e.i?e.B?e.B[t]:void 0:e.o[t+e.G]}function re(e,t,r,n){gt(e),ze(e,t,r,n)}function ze(e,t,r,n){e.j&&(e.j=void 0),t>=e.i||n?Yt(e)[t]=r:(e.o[t+e.G]=r,(e=e.B)&&t in e&&delete e[t])}function wt(e,t,r,n){var i=X(e,t);Array.isArray(i)||(i=We);var s=M(i);if(s&1||vt(i),n)s&2||je(i,2),r&1||Object.freeze(i);else{n=!(r&2);var o=s&2;r&1||!o?n&&s&16&&!o&&_t(i,16):(i=vt(Array.prototype.slice.call(i)),ze(e,t,i))}return i}function At(e,t){var r=X(e,t),n=r==null?r:typeof r=="number"||r==="NaN"||r==="Infinity"||r==="-Infinity"?Number(r):void 0;return n!=null&&n!==r&&ze(e,t,n),n}function Kt(e,t,r,n,i){e.h||(e.h={});var s=e.h[r],o=wt(e,r,3,i);if(!s){var u=o;s=[];var f=!!(M(e.o)&16);o=!!(M(u)&2);var a=u;!i&&o&&(u=Array.prototype.slice.call(u));for(var l=o,m=0;m<u.length;m++){var v=u[m],c=t,w=!1;if(w=w===void 0?!1:w,v=Array.isArray(v)?new c(v):w?new c:void 0,v!==void 0){c=v.o;var x=w=M(c);o&&(x|=2),f&&(x|=16),x!=w&&te(c,x),c=x,l=l||!!(2&c),s.push(v)}}return e.h[r]=s,f=M(u),t=f|33,t=l?t&-9:t|8,f!=t&&(l=u,Object.isFrozen(l)&&(l=Array.prototype.slice.call(l)),te(l,t),u=l),a!==u&&ze(e,r,u),(i||n&&o)&&je(s,2),n&&Object.freeze(s),s}return i||(i=Object.isFrozen(s),n&&!i?Object.freeze(s):!n&&i&&(s=Array.prototype.slice.call(s),e.h[r]=s)),s}function xt(e,t,r){var n=!!(M(e.o)&2);if(t=Kt(e,t,r,n,n),e=wt(e,r,3,n),!(n||M(e)&8)){for(n=0;n<t.length;n++){if(r=t[n],M(r.o)&2){var i=er(r,!1);i.j=r}else i=r;r!==i&&(t[n]=i,e[n]=i.o)}je(e,8)}return t}function ne(e,t,r){if(r!=null&&typeof r!="number")throw Error("Value of float/double field must be a number|null|undefined, found "+typeof r+": "+r);re(e,t,r)}function $t(e,t,r,n,i){gt(e);var s=Kt(e,r,t,!1,!1);return r=n??new r,e=wt(e,t,2,!1),i!=null?(s.splice(i,0,r),e.splice(i,0,r.o)):(s.push(r),e.push(r.o)),r.C()&&_t(e,8),r}function tt(e,t){return e??t}function ie(e,t,r){return r=r===void 0?0:r,tt(At(e,t),r)}var rt;function Mr(e){switch(typeof e){case"number":return isFinite(e)?e:String(e);case"object":if(e)if(Array.isArray(e)){if(M(e)&128)return e=Array.prototype.slice.call(e),mt(e),e}else{if(ge&&e!=null&&e instanceof Uint8Array)return J(e);if(e instanceof Ge){var t=e.V;return t==null?"":typeof t=="string"?t:e.V=J(t)}}}return e}function Zt(e,t,r,n){if(e!=null){if(Array.isArray(e))e=bt(e,t,r,n!==void 0);else if(et(e)){var i={},s;for(s in e)i[s]=Zt(e[s],t,r,n);e=i}else e=t(e,n);return e}}function bt(e,t,r,n){var i=M(e);n=n?!!(i&16):void 0,e=Array.prototype.slice.call(e);for(var s=0;s<e.length;s++)e[s]=Zt(e[s],t,r,n);return r(i,e),e}function Ur(e){return e.ja===yt?e.toJSON():Mr(e)}function Br(e,t){e&128&&mt(t)}function Qt(e,t,r){if(r=r===void 0?qe:r,e!=null){if(ge&&e instanceof Uint8Array)return e.length?new Ge(new Uint8Array(e),ee):ct();if(Array.isArray(e)){var n=M(e);return n&2?e:t&&!(n&32)&&(n&16||n===0)?(te(e,n|2),e):(e=bt(e,Qt,n&4?qe:r,!0),t=M(e),t&4&&t&2&&Object.freeze(e),e)}return e.ja===yt?qt(e):e}}function Jt(e,t,r,n,i,s,o){if(e=e.h&&e.h[r]){if(n=M(e),n&2?n=e:(s=Pe(e,qt),qe(n,s),Object.freeze(s),n=s),gt(t),o=n==null?We:vt([]),n!=null){for(s=!!n.length,e=0;e<n.length;e++){var u=n[e];s=s&&!(M(u.o)&2),o[e]=u.o}s=(s?8:0)|1,e=M(o),(e&s)!==s&&(Object.isFrozen(o)&&(o=Array.prototype.slice.call(o)),te(o,e|s)),t.h||(t.h={}),t.h[r]=n}else t.h&&(t.h[r]=void 0);ze(t,r,o,i)}else re(t,r,Qt(n,s,o),i)}function qt(e){return M(e.o)&2||(e=er(e,!0),je(e.o,2)),e}function er(e,t){var r=e.o,n=[];je(n,16);var i=e.constructor.h;if(i&&n.push(i),i=e.B,i){n.length=r.length,n.fill(void 0,n.length,r.length);var s={};n[n.length-1]=s}M(r)&128&&mt(n),t=t||e.C()?qe:Sr,s=e.constructor,rt=n,n=new s(n),rt=void 0,e.R&&(n.R=e.R.slice()),s=!!(M(r)&16);for(var o=i?r.length-1:r.length,u=0;u<o;u++)Jt(e,n,u-e.G,r[u],!1,s,t);if(i)for(var f in i)Jt(e,n,+f,i[f],!0,s,t);return n}function G(e,t,r){e==null&&(e=rt),rt=void 0;var n=this.constructor.i||0,i=0<n,s=this.constructor.h,o=!1;if(e==null){e=s?[s]:[];var u=48,f=!0;i&&(n=0,u|=128),te(e,u)}else{if(!Array.isArray(e)||s&&s!==e[0])throw Error();var a=u=je(e,0);if((f=(16&a)!==0)&&((o=(32&a)!==0)||(a|=32)),i){if(128&a)n=0;else if(0<e.length){var l=e[e.length-1];if(et(l)&&"g"in l){n=0,a|=128,delete l.g;var m=!0,v;for(v in l){m=!1;break}m&&e.pop()}}}else if(128&a)throw Error();u!==a&&te(e,a)}this.G=(s?0:-1)-n,this.h=void 0,this.o=e;e:{if(s=this.o.length,n=s-1,s&&(s=this.o[n],et(s))){this.B=s,this.i=n-this.G;break e}t!==void 0&&-1<t?(this.i=Math.max(t,n+1-this.G),this.B=void 0):this.i=Number.MAX_VALUE}if(!i&&this.B&&"g"in this.B)throw Error('Unexpected "g" flag in sparse object of message that is not a group type.');if(r){t=f&&!o&&!0,i=this.i;var c;for(f=0;f<r.length;f++)o=r[f],o<i?(o+=this.G,(n=e[o])?tr(n,t):e[o]=We):(c||(c=Yt(this)),(n=c[o])?tr(n,t):c[o]=We)}}G.prototype.toJSON=function(){return bt(this.o,Ur,Br)},G.prototype.C=function(){return!!(M(this.o)&2)};function tr(e,t){if(Array.isArray(e)){var r=M(e),n=1;!t||r&2||(n|=16),(r&n)!==n&&te(e,r|n)}}G.prototype.ja=yt,G.prototype.toString=function(){return this.o.toString()};function rr(e,t,r){if(r){var n={},i;for(i in r){var s=r[i],o=s.ra;o||(n.J=s.xa||s.oa.W,s.ia?(n.aa=ur(s.ia),o=function(u){return function(f,a,l){return u.J(f,a,l,u.aa)}}(n)):s.ka?(n.Z=fr(s.da.P,s.ka),o=function(u){return function(f,a,l){return u.J(f,a,l,u.Z)}}(n)):o=n.J,s.ra=o),o(t,e,s.da),n={J:n.J,aa:n.aa,Z:n.Z}}}Rr(t,e)}var nt=Symbol();function nr(e,t,r){return e[nt]||(e[nt]=function(n,i){return t(n,i,r)})}function ir(e){var t=e[nt];if(!t){var r=Et(e);t=function(n,i){return ar(n,i,r)},e[nt]=t}return t}function Lr(e){var t=e.ia;if(t)return ir(t);if(t=e.wa)return nr(e.da.P,t,e.ka)}function Nr(e){var t=Lr(e),r=e.da,n=e.oa.U;return t?function(i,s){return n(i,s,r,t)}:function(i,s){return n(i,s,r)}}function or(e,t){var r=e[t];return typeof r=="function"&&r.length===0&&(r=r(),e[t]=r),Array.isArray(r)&&(Xe in r||_e in r||0<r.length&&typeof r[0]=="function")?r:void 0}function sr(e,t,r,n,i,s){t.P=e[0];var o=1;if(e.length>o&&typeof e[o]!="number"){var u=e[o++];r(t,u)}for(;o<e.length;){r=e[o++];for(var f=o+1;f<e.length&&typeof e[f]!="number";)f++;switch(u=e[o++],f-=o,f){case 0:n(t,r,u);break;case 1:(f=or(e,o))?(o++,i(t,r,u,f)):n(t,r,u,e[o++]);break;case 2:f=o++,f=or(e,f),i(t,r,u,f,e[o++]);break;case 3:s(t,r,u,e[o++],e[o++],e[o++]);break;case 4:s(t,r,u,e[o++],e[o++],e[o++],e[o++]);break;default:throw Error("unexpected number of binary field arguments: "+f)}}return t}var it=Symbol();function ur(e){var t=e[it];if(!t){var r=jt(e);t=function(n,i){return lr(n,i,r)},e[it]=t}return t}function fr(e,t){var r=e[it];return r||(r=function(n,i){return rr(n,i,t)},e[it]=r),r}var _e=Symbol();function Dr(e,t){e.push(t)}function Ir(e,t,r){e.push(t,r.W)}function Vr(e,t,r,n){var i=ur(n),s=jt(n).P,o=r.W;e.push(t,function(u,f,a){return o(u,f,a,s,i)})}function Gr(e,t,r,n,i,s){var o=fr(n,s),u=r.W;e.push(t,function(f,a,l){return u(f,a,l,n,o)})}function jt(e){var t=e[_e];return t||(t=sr(e,e[_e]=[],Dr,Ir,Vr,Gr),Xe in e&&_e in e&&(e.length=0),t)}var Xe=Symbol();function Hr(e,t){e[0]=t}function Wr(e,t,r,n){var i=r.U;e[t]=n?function(s,o,u){return i(s,o,u,n)}:i}function zr(e,t,r,n,i){var s=r.U,o=ir(n),u=Et(n).P;e[t]=function(f,a,l){return s(f,a,l,u,o,i)}}function _r(e,t,r,n,i,s,o){var u=r.U,f=nr(n,i,s);e[t]=function(a,l,m){return u(a,l,m,n,f,o)}}function Et(e){var t=e[Xe];return t||(t=sr(e,e[Xe]={},Hr,Wr,zr,_r),Xe in e&&_e in e&&(e.length=0),t)}function ar(e,t,r){for(;zt(t)&&t.i!=4;){var n=t.l,i=r[n];if(!i){var s=r[0];s&&(s=s[n])&&(i=r[n]=Nr(s))}if(!i||!i(t,e,n)){i=t,n=e,s=i.j,Qe(i);var o=i;if(!o.ca){if(i=o.h.h-s,o.h.h=s,o=o.h,i==0)i=ct();else{if(s=Gt(o,i),o.S&&o.m)i=o.i.subarray(s,s+i);else{o=o.i;var u=s;i=s+i,i=u===i?me():Re?o.slice(u,i):new Uint8Array(o.subarray(u,i))}i=i.length==0?ct():new Ge(i,ee)}(s=n.R)?s.push(i):n.R=[i]}}}return e}function lr(e,t,r){for(var n=r.length,i=n%2==1,s=i?1:0;s<n;s+=2)(0,r[s+1])(t,e,r[s]);rr(e,t,i?r[0]:void 0)}function Ye(e,t){return{U:e,W:t}}var Y=Ye(function(e,t,r){if(e.i!==5)return!1;e=e.h;var n=e.i,i=e.h,s=n[i],o=n[i+1],u=n[i+2];return n=n[i+3],xe(e,e.h+4),o=(s<<0|o<<8|u<<16|n<<24)>>>0,e=2*(o>>31)+1,s=o>>>23&255,o&=8388607,re(t,r,s==255?o?NaN:1/0*e:s==0?e*Math.pow(2,-149)*o:e*Math.pow(2,s-150)*(o+Math.pow(2,23))),!0},function(e,t,r){if(t=At(t,r),t!=null){be(e.h,8*r+5),e=e.h;var n=+t;n===0?0<1/n?R=L=0:(L=0,R=2147483648):isNaN(n)?(L=0,R=2147483647):(n=(r=0>n?-2147483648:0)?-n:n,34028234663852886e22<n?(L=0,R=(r|2139095040)>>>0):11754943508222875e-54>n?(n=Math.round(n/Math.pow(2,-149)),L=0,R=(r|n)>>>0):(t=Math.floor(Math.log(n)/Math.LN2),n*=Math.pow(2,-t),n=Math.round(8388608*n),16777216<=n&&++t,L=0,R=(r|t+127<<23|n&8388607)>>>0)),r=R,e.h.push(r>>>0&255),e.h.push(r>>>8&255),e.h.push(r>>>16&255),e.h.push(r>>>24&255)}}),Xr=Ye(function(e,t,r){if(e.i!==0)return!1;var n=e.h,i=0,s=e=0,o=n.i,u=n.h;do{var f=o[u++];i|=(f&127)<<s,s+=7}while(32>s&&f&128);for(32<s&&(e|=(f&127)>>4),s=3;32>s&&f&128;s+=7)f=o[u++],e|=(f&127)<<s;if(xe(n,u),128>f)n=i>>>0,f=e>>>0,(e=f&2147483648)&&(n=~n+1>>>0,f=~f>>>0,n==0&&(f=f+1>>>0)),n=4294967296*f+(n>>>0);else throw at();return re(t,r,e?-n:n),!0},function(e,t,r){t=X(t,r),t!=null&&(typeof t=="string"&&Ve(t),t!=null&&(be(e.h,8*r),typeof t=="number"?(e=e.h,Se(t),Wt(e,R,L)):(r=Ve(t),Wt(e.h,r.i,r.h))))}),Yr=Ye(function(e,t,r){return e.i!==0?!1:(re(t,r,He(e.h)),!0)},function(e,t,r){if(t=X(t,r),t!=null&&t!=null)if(be(e.h,8*r),e=e.h,r=t,0<=r)be(e,r);else{for(t=0;9>t;t++)e.h.push(r&127|128),r>>=7;e.h.push(1)}}),cr=Ye(function(e,t,r){if(e.i!==2)return!1;var n=He(e.h)>>>0;e=e.h;var i=Gt(e,n);if(e=e.i,Or){var s=e,o;(o=lt)||(o=lt=new TextDecoder("utf-8",{fatal:!0})),e=i+n,s=i===0&&e===s.length?s:s.subarray(i,e);try{var u=o.decode(s)}catch(m){if(Ze===void 0){try{o.decode(new Uint8Array([128]))}catch{}try{o.decode(new Uint8Array([97])),Ze=!0}catch{Ze=!1}}throw!Ze&&(lt=void 0),m}}else{u=i,n=u+n,i=[];for(var f=null,a,l;u<n;)a=e[u++],128>a?i.push(a):224>a?u>=n?Ae():(l=e[u++],194>a||(l&192)!==128?(u--,Ae()):i.push((a&31)<<6|l&63)):240>a?u>=n-1?Ae():(l=e[u++],(l&192)!==128||a===224&&160>l||a===237&&160<=l||((s=e[u++])&192)!==128?(u--,Ae()):i.push((a&15)<<12|(l&63)<<6|s&63)):244>=a?u>=n-2?Ae():(l=e[u++],(l&192)!==128||(a<<28)+(l-144)>>30||((s=e[u++])&192)!==128||((o=e[u++])&192)!==128?(u--,Ae()):(a=(a&7)<<18|(l&63)<<12|(s&63)<<6|o&63,a-=65536,i.push((a>>10&1023)+55296,(a&1023)+56320))):Ae(),8192<=i.length&&(f=Bt(f,i),i.length=0);u=Bt(f,i)}return re(t,r,u),!0},function(e,t,r){if(t=X(t,r),t!=null){var n=!1;if(n=n===void 0?!1:n,Tr){if(n&&/(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])/.test(t))throw Error("Found an unpaired surrogate");t=(Lt||(Lt=new TextEncoder)).encode(t)}else{for(var i=0,s=new Uint8Array(3*t.length),o=0;o<t.length;o++){var u=t.charCodeAt(o);if(128>u)s[i++]=u;else{if(2048>u)s[i++]=u>>6|192;else{if(55296<=u&&57343>=u){if(56319>=u&&o<t.length){var f=t.charCodeAt(++o);if(56320<=f&&57343>=f){u=1024*(u-55296)+f-56320+65536,s[i++]=u>>18|240,s[i++]=u>>12&63|128,s[i++]=u>>6&63|128,s[i++]=u&63|128;continue}else o--}if(n)throw Error("Found an unpaired surrogate");u=65533}s[i++]=u>>12|224,s[i++]=u>>6&63|128}s[i++]=u&63|128}}t=i===s.length?s:s.subarray(0,i)}be(e.h,8*r+2),be(e.h,t.length),Be(e,e.h.end()),Be(e,t)}}),hr=Ye(function(e,t,r,n,i){if(e.i!==2)return!1;t=$t(t,r,n),r=e.h.j,n=He(e.h)>>>0;var s=e.h.h+n,o=s-r;if(0>=o&&(e.h.j=s,i(t,e,void 0,void 0,void 0),o=s-e.h.h),o)throw Error("Message parsing ended unexpectedly. Expected to read "+(n+" bytes, instead read "+(n-o)+" bytes, either the data ended unexpectedly or the message misreported its own length"));return e.h.h=s,e.h.j=r,!0},function(e,t,r,n,i){if(t=xt(t,n,r),t!=null)for(n=0;n<t.length;n++){var s=e;be(s.h,8*r+2);var o=s.h.end();Be(s,o),o.push(s.i),s=o,i(t[n],e),o=e;var u=s.pop();for(u=o.i+o.h.length()-u;127<u;)s.push(u&127|128),u>>>=7,o.i++;s.push(u),o.i++}});function Ft(e){return function(t,r){e:{if(Je.length){var n=Je.pop();n.setOptions(r),ht(n.h,t,r),t=n}else t=new pt(t,r);try{var i=Et(e),s=ar(new i.P,t,i);break e}finally{i=t.h,i.i=null,i.m=!1,i.l=0,i.j=0,i.h=0,i.S=!1,t.l=-1,t.i=-1,100>Je.length&&Je.push(t)}s=void 0}return s}}function Pt(e){return function(){var t=new Cr;lr(this,t,jt(e)),Be(t,t.h.end());for(var r=new Uint8Array(t.i),n=t.j,i=n.length,s=0,o=0;o<i;o++){var u=n[o];r.set(u,s),s+=u.length}return t.j=[r],r}}function Le(e){G.call(this,e)}k(Le,G);var dr=[Le,1,Yr,2,Y,3,cr,4,cr];Le.prototype.l=Pt(dr);function Ot(e){G.call(this,e,-1,Kr)}k(Ot,G),Ot.prototype.addClassification=function(e,t){return $t(this,1,Le,e,t),this};var Kr=[1],$r=Ft([Ot,1,hr,dr]);function Ke(e){G.call(this,e)}k(Ke,G);var pr=[Ke,1,Y,2,Y,3,Y,4,Y,5,Y];Ke.prototype.l=Pt(pr);function vr(e){G.call(this,e,-1,Zr)}k(vr,G);var Zr=[1],Qr=Ft([vr,1,hr,pr]);function ot(e){G.call(this,e)}k(ot,G);var yr=[ot,1,Y,2,Y,3,Y,4,Y,5,Y,6,Xr],Jr=Ft(yr);ot.prototype.l=Pt(yr);function gr(e,t,r){if(r=e.createShader(r===0?e.VERTEX_SHADER:e.FRAGMENT_SHADER),e.shaderSource(r,t),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS))throw Error(`Could not compile WebGL shader.

`+e.getShaderInfoLog(r));return r}function qr(e){return xt(e,Le,1).map(function(t){var r=X(t,1);return{index:r??0,qa:ie(t,2),label:X(t,3)!=null?tt(X(t,3),""):void 0,displayName:X(t,4)!=null?tt(X(t,4),""):void 0}})}function en(e){return{x:ie(e,1),y:ie(e,2),z:ie(e,3),visibility:At(e,4)!=null?ie(e,4):void 0}}function Tt(e,t){this.i=e,this.h=t,this.m=0}function mr(e,t,r){return tn(e,t),typeof e.h.canvas.transferToImageBitmap=="function"?Promise.resolve(e.h.canvas.transferToImageBitmap()):r?Promise.resolve(e.h.canvas):typeof createImageBitmap=="function"?createImageBitmap(e.h.canvas):(e.j===void 0&&(e.j=document.createElement("canvas")),new Promise(function(n){e.j.height=e.h.canvas.height,e.j.width=e.h.canvas.width,e.j.getContext("2d",{}).drawImage(e.h.canvas,0,0,e.h.canvas.width,e.h.canvas.height),n(e.j)}))}function tn(e,t){var r=e.h;if(e.s===void 0){var n=gr(r,`
  attribute vec2 aVertex;
  attribute vec2 aTex;
  varying vec2 vTex;
  void main(void) {
    gl_Position = vec4(aVertex, 0.0, 1.0);
    vTex = aTex;
  }`,0),i=gr(r,`
  precision mediump float;
  varying vec2 vTex;
  uniform sampler2D sampler0;
  void main(){
    gl_FragColor = texture2D(sampler0, vTex);
  }`,1),s=r.createProgram();if(r.attachShader(s,n),r.attachShader(s,i),r.linkProgram(s),!r.getProgramParameter(s,r.LINK_STATUS))throw Error(`Could not compile WebGL program.

`+r.getProgramInfoLog(s));n=e.s=s,r.useProgram(n),i=r.getUniformLocation(n,"sampler0"),e.l={O:r.getAttribLocation(n,"aVertex"),N:r.getAttribLocation(n,"aTex"),ya:i},e.v=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,e.v),r.enableVertexAttribArray(e.l.O),r.vertexAttribPointer(e.l.O,2,r.FLOAT,!1,0,0),r.bufferData(r.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,1,-1]),r.STATIC_DRAW),r.bindBuffer(r.ARRAY_BUFFER,null),e.u=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,e.u),r.enableVertexAttribArray(e.l.N),r.vertexAttribPointer(e.l.N,2,r.FLOAT,!1,0,0),r.bufferData(r.ARRAY_BUFFER,new Float32Array([0,1,0,0,1,0,1,1]),r.STATIC_DRAW),r.bindBuffer(r.ARRAY_BUFFER,null),r.uniform1i(i,0)}n=e.l,r.useProgram(e.s),r.canvas.width=t.width,r.canvas.height=t.height,r.viewport(0,0,t.width,t.height),r.activeTexture(r.TEXTURE0),e.i.bindTexture2d(t.glName),r.enableVertexAttribArray(n.O),r.bindBuffer(r.ARRAY_BUFFER,e.v),r.vertexAttribPointer(n.O,2,r.FLOAT,!1,0,0),r.enableVertexAttribArray(n.N),r.bindBuffer(r.ARRAY_BUFFER,e.u),r.vertexAttribPointer(n.N,2,r.FLOAT,!1,0,0),r.bindFramebuffer(r.DRAW_FRAMEBUFFER?r.DRAW_FRAMEBUFFER:r.FRAMEBUFFER,null),r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT),r.colorMask(!0,!0,!0,!0),r.drawArrays(r.TRIANGLE_FAN,0,4),r.disableVertexAttribArray(n.O),r.disableVertexAttribArray(n.N),r.bindBuffer(r.ARRAY_BUFFER,null),e.i.bindTexture2d(0)}function rn(e){this.h=e}var nn=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,9,1,7,0,65,0,253,15,26,11]);function on(e,t){return t+e}function wr(e,t){window[e]=t}function sn(e){var t=document.createElement("script");return t.setAttribute("src",e),t.setAttribute("crossorigin","anonymous"),new Promise(function(r){t.addEventListener("load",function(){r()},!1),t.addEventListener("error",function(){r()},!1),document.body.appendChild(t)})}function un(){return C(function(e){switch(e.h){case 1:return e.s=2,A(e,WebAssembly.instantiate(nn),4);case 4:e.h=3,e.s=0;break;case 2:return e.s=0,e.l=null,e.return(!1);case 3:return e.return(!0)}})}function kt(e){if(this.h=e,this.listeners={},this.l={},this.L={},this.s={},this.v={},this.M=this.u=this.ga=!0,this.I=Promise.resolve(),this.fa="",this.D={},this.locateFile=e&&e.locateFile||on,typeof window=="object")var t=window.location.pathname.toString().substring(0,window.location.pathname.toString().lastIndexOf("/"))+"/";else if(typeof location<"u")t=location.pathname.toString().substring(0,location.pathname.toString().lastIndexOf("/"))+"/";else throw Error("solutions can only be loaded on a web page or in a web worker");if(this.ha=t,e.options){t=E(Object.keys(e.options));for(var r=t.next();!r.done;r=t.next()){r=r.value;var n=e.options[r].default;n!==void 0&&(this.l[r]=typeof n=="function"?n():n)}}}h=kt.prototype,h.close=function(){return this.j&&this.j.delete(),Promise.resolve()};function fn(e){var t,r,n,i,s,o,u,f,a,l,m;return C(function(v){switch(v.h){case 1:return e.ga?(t=e.h.files===void 0?[]:typeof e.h.files=="function"?e.h.files(e.l):e.h.files,A(v,un(),2)):v.return();case 2:if(r=v.i,typeof window=="object")return wr("createMediapipeSolutionsWasm",{locateFile:e.locateFile}),wr("createMediapipeSolutionsPackedAssets",{locateFile:e.locateFile}),o=t.filter(function(c){return c.data!==void 0}),u=t.filter(function(c){return c.data===void 0}),f=Promise.all(o.map(function(c){var w=st(e,c.url);if(c.path!==void 0){var x=c.path;w=w.then(function(T){return e.overrideFile(x,T),Promise.resolve(T)})}return w})),a=Promise.all(u.map(function(c){return c.simd===void 0||c.simd&&r||!c.simd&&!r?sn(e.locateFile(c.url,e.ha)):Promise.resolve()})).then(function(){var c,w,x;return C(function(T){if(T.h==1)return c=window.createMediapipeSolutionsWasm,w=window.createMediapipeSolutionsPackedAssets,x=e,A(T,c(w),2);x.i=T.i,T.h=0})}),l=function(){return C(function(c){return e.h.graph&&e.h.graph.url?c=A(c,st(e,e.h.graph.url),0):(c.h=0,c=void 0),c})}(),A(v,Promise.all([a,f,l]),7);if(typeof importScripts!="function")throw Error("solutions can only be loaded on a web page or in a web worker");return n=t.filter(function(c){return c.simd===void 0||c.simd&&r||!c.simd&&!r}).map(function(c){return e.locateFile(c.url,e.ha)}),importScripts.apply(null,N(n)),i=e,A(v,createMediapipeSolutionsWasm(Module),6);case 6:i.i=v.i,e.m=new OffscreenCanvas(1,1),e.i.canvas=e.m,s=e.i.GL.createContext(e.m,{antialias:!1,alpha:!1,va:typeof WebGL2RenderingContext<"u"?2:1}),e.i.GL.makeContextCurrent(s),v.h=4;break;case 7:if(e.m=document.createElement("canvas"),m=e.m.getContext("webgl2",{}),!m&&(m=e.m.getContext("webgl",{}),!m))return alert("Failed to create WebGL canvas context when passing video frame."),v.return();e.K=m,e.i.canvas=e.m,e.i.createContext(e.m,!0,!0,{});case 4:e.j=new e.i.SolutionWasm,e.ga=!1,v.h=0}})}function an(e){var t,r,n,i,s,o,u,f;return C(function(a){if(a.h==1){if(e.h.graph&&e.h.graph.url&&e.fa===e.h.graph.url)return a.return();if(e.u=!0,!e.h.graph||!e.h.graph.url){a.h=2;return}return e.fa=e.h.graph.url,A(a,st(e,e.h.graph.url),3)}for(a.h!=2&&(t=a.i,e.j.loadGraph(t)),r=E(Object.keys(e.D)),n=r.next();!n.done;n=r.next())i=n.value,e.j.overrideFile(i,e.D[i]);if(e.D={},e.h.listeners)for(s=E(e.h.listeners),o=s.next();!o.done;o=s.next())u=o.value,dn(e,u);f=e.l,e.l={},e.setOptions(f),a.h=0})}h.reset=function(){var e=this;return C(function(t){e.j&&(e.j.reset(),e.s={},e.v={}),t.h=0})},h.setOptions=function(e,t){var r=this;if(t=t||this.h.options){for(var n=[],i=[],s={},o=E(Object.keys(e)),u=o.next();!u.done;s={X:s.X,Y:s.Y},u=o.next())if(u=u.value,!(u in this.l&&this.l[u]===e[u])){this.l[u]=e[u];var f=t[u];f!==void 0&&(f.onChange&&(s.X=f.onChange,s.Y=e[u],n.push(function(a){return function(){var l;return C(function(m){if(m.h==1)return A(m,a.X(a.Y),2);l=m.i,l===!0&&(r.u=!0),m.h=0})}}(s))),f.graphOptionXref&&(u=Object.assign({},{calculatorName:"",calculatorIndex:0},f.graphOptionXref,{valueNumber:f.type===1?e[u]:0,valueBoolean:f.type===0?e[u]:!1,valueString:f.type===2?e[u]:""}),i.push(u)))}(n.length!==0||i.length!==0)&&(this.u=!0,this.H=(this.H===void 0?[]:this.H).concat(i),this.F=(this.F===void 0?[]:this.F).concat(n))}};function ln(e){var t,r,n,i,s,o,u;return C(function(f){switch(f.h){case 1:if(!e.u)return f.return();if(!e.F){f.h=2;break}t=E(e.F),r=t.next();case 3:if(r.done){f.h=5;break}return n=r.value,A(f,n(),4);case 4:r=t.next(),f.h=3;break;case 5:e.F=void 0;case 2:if(e.H){for(i=new e.i.GraphOptionChangeRequestList,s=E(e.H),o=s.next();!o.done;o=s.next())u=o.value,i.push_back(u);e.j.changeOptions(i),i.delete(),e.H=void 0}e.u=!1,f.h=0}})}h.initialize=function(){var e=this;return C(function(t){return t.h==1?A(t,fn(e),2):t.h!=3?A(t,an(e),3):A(t,ln(e),0)})};function st(e,t){var r,n;return C(function(i){return t in e.L?i.return(e.L[t]):(r=e.locateFile(t,""),n=fetch(r).then(function(s){return s.arrayBuffer()}),e.L[t]=n,i.return(n))})}h.overrideFile=function(e,t){this.j?this.j.overrideFile(e,t):this.D[e]=t},h.clearOverriddenFiles=function(){this.D={},this.j&&this.j.clearOverriddenFiles()},h.send=function(e,t){var r=this,n,i,s,o,u,f,a,l,m;return C(function(v){switch(v.h){case 1:return r.h.inputs?(n=1e3*(t??performance.now()),A(v,r.I,2)):v.return();case 2:return A(v,r.initialize(),3);case 3:for(i=new r.i.PacketDataList,s=E(Object.keys(e)),o=s.next();!o.done;o=s.next())if(u=o.value,f=r.h.inputs[u]){e:{var c=e[u];switch(f.type){case"video":var w=r.s[f.stream];if(w||(w=new Tt(r.i,r.K),r.s[f.stream]=w),w.m===0&&(w.m=w.i.createTexture()),typeof HTMLVideoElement<"u"&&c instanceof HTMLVideoElement)var x=c.videoWidth,T=c.videoHeight;else typeof HTMLImageElement<"u"&&c instanceof HTMLImageElement?(x=c.naturalWidth,T=c.naturalHeight):(x=c.width,T=c.height);T={glName:w.m,width:x,height:T},x=w.h,x.canvas.width=T.width,x.canvas.height=T.height,x.activeTexture(x.TEXTURE0),w.i.bindTexture2d(w.m),x.texImage2D(x.TEXTURE_2D,0,x.RGBA,x.RGBA,x.UNSIGNED_BYTE,c),w.i.bindTexture2d(0),w=T;break e;case"detections":for(w=r.s[f.stream],w||(w=new rn(r.i),r.s[f.stream]=w),w.data||(w.data=new w.h.DetectionListData),w.data.reset(c.length),T=0;T<c.length;++T){x=c[T];var O=w.data,D=O.setBoundingBox,_=T,H=x.la,F=new ot;if(ne(F,1,H.sa),ne(F,2,H.ta),ne(F,3,H.height),ne(F,4,H.width),ne(F,5,H.rotation),re(F,6,H.pa),H=F.l(),D.call(O,_,H),x.ea)for(O=0;O<x.ea.length;++O){F=x.ea[O],D=w.data,_=D.addNormalizedLandmark,H=T,F=Object.assign({},F,{visibility:F.visibility?F.visibility:0});var I=new Ke;ne(I,1,F.x),ne(I,2,F.y),ne(I,3,F.z),F.visibility&&ne(I,4,F.visibility),F=I.l(),_.call(D,H,F)}if(x.ba)for(O=0;O<x.ba.length;++O)D=w.data,_=D.addClassification,H=T,F=x.ba[O],I=new Le,ne(I,2,F.qa),F.index&&re(I,1,F.index),F.label&&re(I,3,F.label),F.displayName&&re(I,4,F.displayName),F=I.l(),_.call(D,H,F)}w=w.data;break e;default:w={}}}switch(a=w,l=f.stream,f.type){case"video":i.pushTexture2d(Object.assign({},a,{stream:l,timestamp:n}));break;case"detections":m=a,m.stream=l,m.timestamp=n,i.pushDetectionList(m);break;default:throw Error("Unknown input config type: '"+f.type+"'")}}return r.j.send(i),A(v,r.I,4);case 4:i.delete(),v.h=0}})};function cn(e,t,r){var n,i,s,o,u,f,a,l,m,v,c,w,x,T;return C(function(O){switch(O.h){case 1:if(!r)return O.return(t);for(n={},i=0,s=E(Object.keys(r)),o=s.next();!o.done;o=s.next())u=o.value,f=r[u],typeof f!="string"&&f.type==="texture"&&t[f.stream]!==void 0&&++i;1<i&&(e.M=!1),a=E(Object.keys(r)),o=a.next();case 2:if(o.done){O.h=4;break}if(l=o.value,m=r[l],typeof m=="string")return x=n,T=l,A(O,hn(e,l,t[m]),14);if(v=t[m.stream],m.type==="detection_list"){if(v){for(var D=v.getRectList(),_=v.getLandmarksList(),H=v.getClassificationsList(),F=[],I=0;I<D.size();++I){var pe=Jr(D.get(I)),pn=ie(pe,1),vn=ie(pe,2),yn=ie(pe,3),gn=ie(pe,4),mn=ie(pe,5,0),ut=void 0;ut=ut===void 0?0:ut,pe={la:{sa:pn,ta:vn,height:yn,width:gn,rotation:mn,pa:tt(X(pe,6),ut)},ea:xt(Qr(_.get(I)),Ke,1).map(en),ba:qr($r(H.get(I)))},F.push(pe)}D=F}else D=[];n[l]=D,O.h=7;break}if(m.type==="proto_list"){if(v){for(D=Array(v.size()),_=0;_<v.size();_++)D[_]=v.get(_);v.delete()}else D=[];n[l]=D,O.h=7;break}if(v===void 0){O.h=3;break}if(m.type==="float_list"){n[l]=v,O.h=7;break}if(m.type==="proto"){n[l]=v,O.h=7;break}if(m.type!=="texture")throw Error("Unknown output config type: '"+m.type+"'");return c=e.v[l],c||(c=new Tt(e.i,e.K),e.v[l]=c),A(O,mr(c,v,e.M),13);case 13:w=O.i,n[l]=w;case 7:m.transform&&n[l]&&(n[l]=m.transform(n[l])),O.h=3;break;case 14:x[T]=O.i;case 3:o=a.next(),O.h=2;break;case 4:return O.return(n)}})}function hn(e,t,r){var n;return C(function(i){return typeof r=="number"||r instanceof Uint8Array||r instanceof e.i.Uint8BlobList?i.return(r):r instanceof e.i.Texture2dDataOut?(n=e.v[t],n||(n=new Tt(e.i,e.K),e.v[t]=n),i.return(mr(n,r,e.M))):i.return(void 0)})}function dn(e,t){for(var r=t.name||"$",n=[].concat(N(t.wants)),i=new e.i.StringList,s=E(t.wants),o=s.next();!o.done;o=s.next())i.push_back(o.value);s=e.i.PacketListener.implement({onResults:function(u){for(var f={},a=0;a<t.wants.length;++a)f[n[a]]=u.get(a);var l=e.listeners[r];l&&(e.I=cn(e,f,t.outs).then(function(m){m=l(m);for(var v=0;v<t.wants.length;++v){var c=f[n[v]];typeof c=="object"&&c.hasOwnProperty&&c.hasOwnProperty("delete")&&c.delete()}m&&(e.I=m)}))}}),e.j.attachMultiListener(i,s),i.delete()}h.onResults=function(e,t){this.listeners[t||"$"]=e},ue("Solution",kt),ue("OptionType",{BOOL:0,NUMBER:1,ua:2,0:"BOOL",1:"NUMBER",2:"STRING"});function Ar(e){switch(e===void 0&&(e=0),e){case 1:return"selfie_segmentation_landscape.tflite";default:return"selfie_segmentation.tflite"}}function xr(e){var t=this;e=e||{},this.h=new kt({locateFile:e.locateFile,files:function(r){return[{simd:!0,url:"selfie_segmentation_solution_simd_wasm_bin.js"},{simd:!1,url:"selfie_segmentation_solution_wasm_bin.js"},{data:!0,url:Ar(r.modelSelection)}]},graph:{url:"selfie_segmentation.binarypb"},listeners:[{wants:["segmentation_mask","image_transformed"],outs:{image:{type:"texture",stream:"image_transformed"},segmentationMask:{type:"texture",stream:"segmentation_mask"}}}],inputs:{image:{type:"video",stream:"input_frames_gpu"}},options:{useCpuInference:{type:0,graphOptionXref:{calculatorType:"InferenceCalculator",fieldName:"use_cpu_inference"},default:typeof window!="object"||window.navigator===void 0?!1:"iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";").includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document},selfieMode:{type:0,graphOptionXref:{calculatorType:"GlScalerCalculator",calculatorIndex:1,fieldName:"flip_horizontal"}},modelSelection:{type:1,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorModelSelection",fieldName:"int_value"},onChange:function(r){var n,i,s;return C(function(o){return o.h==1?(n=Ar(r),i="third_party/mediapipe/modules/selfie_segmentation/"+n,A(o,st(t.h,n),2)):(s=o.i,t.h.overrideFile(i,s),o.return(!0))})}}}})}h=xr.prototype,h.close=function(){return this.h.close(),Promise.resolve()},h.onResults=function(e){this.h.onResults(e)},h.initialize=function(){var e=this;return C(function(t){return A(t,e.h.initialize(),0)})},h.reset=function(){this.h.reset()},h.send=function(e){var t=this;return C(function(r){return A(r,t.h.send(e),0)})},h.setOptions=function(e){this.h.setOptions(e)},ue("SelfieSegmentation",xr),ue("VERSION","0.1.1675465747")}).call(St);var An=SelfieSegmentation;function ft(h){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?ft=function(d){return typeof d}:ft=function(d){return d&&typeof Symbol=="function"&&d.constructor===Symbol&&d!==Symbol.prototype?"symbol":typeof d},ft(h)}function xn(h,d){if(!(h instanceof d))throw new TypeError("Cannot call a class as a function")}var bn=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],jn=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function En(h,d,p,j,b){if(typeof h=="string"&&(h=document.getElementById(h)),!h||ft(h)!=="object"||!("getContext"in h))throw new TypeError("Expecting canvas with `getContext` method in processCanvasRGB(A) calls!");var y=h.getContext("2d");try{return y.getImageData(d,p,j,b)}catch(g){throw new Error("unable to access image data: "+g)}}function Fn(h,d,p,j,b,y){if(!(isNaN(y)||y<1)){y|=0;var g=En(h,d,p,j,b);g=Pn(g,d,p,j,b,y),h.getContext("2d").putImageData(g,d,p)}}function Pn(h,d,p,j,b,y){for(var g=h.data,E=2*y+1,N=j-1,B=b-1,U=y+1,W=U*(U+1)/2,K=new jr,P=K,Ee,Fe=1;Fe<E;Fe++)P=P.next=new jr,Fe===U&&(Ee=P);P.next=K;for(var k=null,V=null,$=bn[y],Z=jn[y],A,ce,$e=0,S=0,he=0;he<b;he++){var oe=g[S],se=g[S+1],C=g[S+2],Ne=U*oe,z=U*se,ve=U*C,ue=W*oe,ye=W*se,Pe=W*C;P=K;for(var De=0;De<U;De++)P.r=oe,P.g=se,P.b=C,P=P.next;for(var Q=0,Oe=0,Te=0,de=1;de<U;de++)A=S+((N<de?N:de)<<2),ue+=(P.r=oe=g[A])*(ce=U-de),ye+=(P.g=se=g[A+1])*ce,Pe+=(P.b=C=g[A+2])*ce,Q+=oe,Oe+=se,Te+=C,P=P.next;k=K,V=Ee;for(var ge=0;ge<j;ge++)g[S]=ue*$>>Z,g[S+1]=ye*$>>Z,g[S+2]=Pe*$>>Z,ue-=Ne,ye-=z,Pe-=ve,Ne-=k.r,z-=k.g,ve-=k.b,A=$e+((A=ge+y+1)<N?A:N)<<2,Q+=k.r=g[A],Oe+=k.g=g[A+1],Te+=k.b=g[A+2],ue+=Q,ye+=Oe,Pe+=Te,k=k.next,Ne+=oe=V.r,z+=se=V.g,ve+=C=V.b,Q-=oe,Oe-=se,Te-=C,V=V.next,S+=4;$e+=j}for(var fe=0;fe<j;fe++){S=fe<<2;var J=g[S],q=g[S+1],ae=g[S+2],ke=U*J,Ce=U*q,me=U*ae,ee=W*J,Re=W*q,R=W*ae;P=K;for(var L=0;L<U;L++)P.r=J,P.g=q,P.b=ae,P=P.next;for(var Se=0,Ie=0,Me=0,we=1,Ve=j;we<=y;we++)S=Ve+fe<<2,ee+=(P.r=J=g[S])*(ce=U-we),Re+=(P.g=q=g[S+1])*ce,R+=(P.b=ae=g[S+2])*ce,Se+=J,Ie+=q,Me+=ae,P=P.next,we<B&&(Ve+=j);S=fe,k=K,V=Ee;for(var Ue=0;Ue<b;Ue++)A=S<<2,g[A]=ee*$>>Z,g[A+1]=Re*$>>Z,g[A+2]=R*$>>Z,ee-=ke,Re-=Ce,R-=me,ke-=k.r,Ce-=k.g,me-=k.b,A=fe+((A=Ue+U)<B?A:B)*j<<2,ee+=Se+=k.r=g[A],Re+=Ie+=k.g=g[A+1],R+=Me+=k.b=g[A+2],k=k.next,ke+=J=V.r,Ce+=q=V.g,me+=ae=V.b,Se-=J,Ie-=q,Me-=ae,V=V.next,S+=j}return h}var jr=function h(){xn(this,h),this.r=0,this.g=0,this.b=0,this.a=0,this.next=null};function On(h,d){let p=0,j=0,b=d.width,y=d.height;const g=h.width/h.height,E=d.width/d.height;if(E<g){const N=h.height*(d.width/h.width);j=Math.round((y-N)/2),y=Math.round(N)}else if(E>g){const N=h.width*(d.height/h.height);p=Math.round((b-N)/2),b=Math.round(N)}return{x:p,y:j,width:b,height:y}}class Cn{trackProcessor;segmentation;constructor(d){this.trackProcessor=new br;const p={};d=Tn(d),p.locateFile=j=>`${d}/${j}`,this.segmentation=new An(p)}static isSupported(){return br.isSupported()}async startProcessing(d,p={}){const j=d.getSettings().width||0,b=d.getSettings().height||0,y=Fr(j,b),g=y.getContext("2d",{desynchronized:!0,willReadFrequently:!1});if(g===null)throw Error("Failed to create 2D canvas context");let E;if(p.blurRadius!==void 0&&kn()==="safari"){const B=Fr(j,b).getContext("2d",{desynchronized:!0,willReadFrequently:!0});if(B===null)throw Error("Failed to create 2D canvas context");E=B}await this.segmentation.initialize();let N=1;return p.segmentationModel&&p.segmentationModel==="selfie-general"&&(N=0),this.segmentation.setOptions({modelSelection:N}),this.segmentation.onResults(B=>{const{width:U,height:W}=B.segmentationMask;Er(U,W,y),E!==void 0&&Er(U,W,E.canvas),this.updateOffscreenCanvas(B,g,E,p)}),this.trackProcessor.startProcessing(d,async B=>(await this.segmentation.send({image:B}),y))}stopProcessing(){this.trackProcessor.stopProcessing(),this.segmentation.onResults(()=>{})}isProcessing(){return this.trackProcessor.isProcessing()}getOriginalTrack(){return this.trackProcessor.getOriginalTrack()}getProcessedTrack(){return this.trackProcessor.getProcessedTrack()}updateOffscreenCanvas(d,p,j,b){const{width:y,height:g}=d.image;p.save(),p.clearRect(0,0,y,g),p.drawImage(d.segmentationMask,0,0,y,g),p.globalCompositeOperation="source-in",p.drawImage(d.image,0,0,y,g),p.globalCompositeOperation="destination-over";let E=p;if(b.blurRadius!==void 0&&(j!==void 0?E=j:E.filter=`blur(${b.blurRadius}px)`),b.backgroundImage!==void 0){const B=(b.backgroundImageRegion||On)({width:y,height:g},b.backgroundImage);E.drawImage(b.backgroundImage,B.x,B.y,B.width,B.height,0,0,y,g)}else E.drawImage(d.image,0,0);j!==void 0&&(Fn(E.canvas,0,0,y,g,b.blurRadius),p.drawImage(E.canvas,0,0,y,g)),p.restore()}}function Er(h,d,p){(p.width!==h||p.height!==d)&&(p.width=h,p.height=d)}function Tn(h){return h.slice(-1)==="/"?h.slice(0,-1):h}function Fr(h,d){if(typeof OffscreenCanvas>"u"){const p=document.createElement("canvas");return p.width=h,p.height=d,p}else return new OffscreenCanvas(h,d)}function kn(){const h=window.navigator.userAgent.toLocaleLowerCase();return h.indexOf("edge")!==-1?"edge":h.indexOf("chrome")!==-1&&h.indexOf("edge")===-1?"chrome":h.indexOf("safari")!==-1&&h.indexOf("chrome")===-1?"safari":h.indexOf("opera")!==-1?"opera":h.indexOf("firefox")!==-1?"firefox":"unknown"}export{Cn as V};
